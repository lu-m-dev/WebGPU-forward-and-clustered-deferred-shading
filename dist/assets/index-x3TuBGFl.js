(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var stats_min$1={exports:{}},stats_min=stats_min$1.exports,hasRequiredStats_min;function requireStats_min(){return hasRequiredStats_min||(hasRequiredStats_min=1,(function(t,e){(function(n,r){t.exports=r()})(stats_min,function(){var n=function(){function r(G){return c.appendChild(G.dom),G}function s(G){for(var P=0;P<c.children.length;P++)c.children[P].style.display=P===G?"block":"none";o=G}var o=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(G){G.preventDefault(),s(++o%c.children.length)},!1);var d=(performance||Date).now(),p=d,T=0,I=r(new n.Panel("FPS","#0ff","#002")),D=r(new n.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var x=r(new n.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:c,addPanel:r,showPanel:s,begin:function(){d=(performance||Date).now()},end:function(){T++;var G=(performance||Date).now();if(D.update(G-d,200),G>p+1e3&&(I.update(1e3*T/(G-p),100),p=G,T=0,x)){var P=performance.memory;x.update(P.usedJSHeapSize/1048576,P.jsHeapSizeLimit/1048576)}return G},update:function(){d=this.end()},domElement:c,setMode:s}};return n.Panel=function(r,s,o){var c=1/0,d=0,p=Math.round,T=p(window.devicePixelRatio||1),I=80*T,D=48*T,x=3*T,G=2*T,P=3*T,U=15*T,H=74*T,X=30*T,j=document.createElement("canvas");j.width=I,j.height=D,j.style.cssText="width:80px;height:48px";var K=j.getContext("2d");return K.font="bold "+9*T+"px Helvetica,Arial,sans-serif",K.textBaseline="top",K.fillStyle=o,K.fillRect(0,0,I,D),K.fillStyle=s,K.fillText(r,x,G),K.fillRect(P,U,H,X),K.fillStyle=o,K.globalAlpha=.9,K.fillRect(P,U,H,X),{dom:j,update:function(q,te){c=Math.min(c,q),d=Math.max(d,q),K.fillStyle=o,K.globalAlpha=1,K.fillRect(0,0,I,U),K.fillStyle=s,K.fillText(p(q)+" "+r+" ("+p(c)+"-"+p(d)+")",x,G),K.drawImage(j,P+T,U,H-T,X,P,U,H-T,X),K.fillRect(P+H-T,U,T,X),K.fillStyle=o,K.globalAlpha=.9,K.fillRect(P+H-T,U,T,p((1-q/te)*X))}}},n})})(stats_min$1)),stats_min$1.exports}var stats_minExports=requireStats_min();const Stats=getDefaultExportFromCjs(stats_minExports);function ___$insertStyle(t){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}function colorToString(t,e){var n=t.__state.conversionName.toString(),r=Math.round(t.r),s=Math.round(t.g),o=Math.round(t.b),c=t.a,d=Math.round(t.h),p=t.s.toFixed(1),T=t.v.toFixed(1);if(e||n==="THREE_CHAR_HEX"||n==="SIX_CHAR_HEX"){for(var I=t.hex.toString(16);I.length<6;)I="0"+I;return"#"+I}else{if(n==="CSS_RGB")return"rgb("+r+","+s+","+o+")";if(n==="CSS_RGBA")return"rgba("+r+","+s+","+o+","+c+")";if(n==="HEX")return"0x"+t.hex.toString(16);if(n==="RGB_ARRAY")return"["+r+","+s+","+o+"]";if(n==="RGBA_ARRAY")return"["+r+","+s+","+o+","+c+"]";if(n==="RGB_OBJ")return"{r:"+r+",g:"+s+",b:"+o+"}";if(n==="RGBA_OBJ")return"{r:"+r+",g:"+s+",b:"+o+",a:"+c+"}";if(n==="HSV_OBJ")return"{h:"+d+",s:"+p+",v:"+T+"}";if(n==="HSVA_OBJ")return"{h:"+d+",s:"+p+",v:"+T+",a:"+c+"}"}return"unknown format"}var ARR_EACH=Array.prototype.forEach,ARR_SLICE=Array.prototype.slice,Common={BREAK:{},extend:function(e){return this.each(ARR_SLICE.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(n[s])||(e[s]=n[s])}.bind(this))},this),e},defaults:function(e){return this.each(ARR_SLICE.call(arguments,1),function(n){var r=this.isObject(n)?Object.keys(n):[];r.forEach(function(s){this.isUndefined(e[s])&&(e[s]=n[s])}.bind(this))},this),e},compose:function(){var e=ARR_SLICE.call(arguments);return function(){for(var n=ARR_SLICE.call(arguments),r=e.length-1;r>=0;r--)n=[e[r].apply(this,n)];return n[0]}},each:function(e,n,r){if(e){if(ARR_EACH&&e.forEach&&e.forEach===ARR_EACH)e.forEach(n,r);else if(e.length===e.length+0){var s=void 0,o=void 0;for(s=0,o=e.length;s<o;s++)if(s in e&&n.call(r,e[s],s)===this.BREAK)return}else for(var c in e)if(n.call(r,e[c],c)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,n,r){var s=void 0;return function(){var o=this,c=arguments;function d(){s=null,r||e.apply(o,c)}var p=r||!s;clearTimeout(s),s=setTimeout(d,n),p&&e.apply(o,c)}},toArray:function(e){return e.toArray?e.toArray():ARR_SLICE.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:(function(t){function e(n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e})(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},INTERPRETATIONS=[{litmus:Common.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString()+n[1].toString()+n[2].toString()+n[2].toString()+n[3].toString()+n[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function(e){var n=e.match(/^#([A-F0-9]{6})$/i);return n===null?!1:{space:"HEX",hex:parseInt("0x"+n[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function(e){var n=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3])}},write:colorToString},CSS_RGBA:{read:function(e){var n=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return n===null?!1:{space:"RGB",r:parseFloat(n[1]),g:parseFloat(n[2]),b:parseFloat(n[3]),a:parseFloat(n[4])}},write:colorToString}}},{litmus:Common.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:Common.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:Common.isObject,conversions:{RGBA_OBJ:{read:function(e){return Common.isNumber(e.r)&&Common.isNumber(e.g)&&Common.isNumber(e.b)&&Common.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return Common.isNumber(e.r)&&Common.isNumber(e.g)&&Common.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return Common.isNumber(e.h)&&Common.isNumber(e.s)&&Common.isNumber(e.v)&&Common.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return Common.isNumber(e.h)&&Common.isNumber(e.s)&&Common.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],result=void 0,toReturn=void 0,interpret=function(){toReturn=!1;var e=arguments.length>1?Common.toArray(arguments):arguments[0];return Common.each(INTERPRETATIONS,function(n){if(n.litmus(e))return Common.each(n.conversions,function(r,s){if(result=r.read(e),toReturn===!1&&result!==!1)return toReturn=result,result.conversionName=s,result.conversion=r,Common.BREAK}),Common.BREAK}),toReturn},tmpComponent=void 0,ColorMath={hsv_to_rgb:function(e,n,r){var s=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),c=r*(1-n),d=r*(1-o*n),p=r*(1-(1-o)*n),T=[[r,p,c],[d,r,c],[c,r,p],[c,d,r],[p,c,r],[r,c,d]][s];return{r:T[0]*255,g:T[1]*255,b:T[2]*255}},rgb_to_hsv:function(e,n,r){var s=Math.min(e,n,r),o=Math.max(e,n,r),c=o-s,d=void 0,p=void 0;if(o!==0)p=c/o;else return{h:NaN,s:0,v:0};return e===o?d=(n-r)/c:n===o?d=2+(r-e)/c:d=4+(e-n)/c,d/=6,d<0&&(d+=1),{h:d*360,s:p,v:o/255}},rgb_to_hex:function(e,n,r){var s=this.hex_with_component(0,2,e);return s=this.hex_with_component(s,1,n),s=this.hex_with_component(s,0,r),s},component_from_hex:function(e,n){return e>>n*8&255},hex_with_component:function(e,n,r){return r<<(tmpComponent=n*8)|e&~(255<<tmpComponent)}},_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=(function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}})(),get=function t(e,n,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(s===void 0){var o=Object.getPrototypeOf(e);return o===null?void 0:t(o,n,r)}else{if("value"in s)return s.value;var c=s.get;return c===void 0?void 0:c.call(r)}},inherits=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},Color=(function(){function t(){if(classCallCheck(this,t),this.__state=interpret.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return createClass(t,[{key:"toString",value:function(){return colorToString(this)}},{key:"toHexString",value:function(){return colorToString(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t})();function defineRGBComponent(t,e,n){Object.defineProperty(t,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(Color.recalculateRGB(this,e,n),this.__state[e])},set:function(s){this.__state.space!=="RGB"&&(Color.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=s}})}function defineHSVComponent(t,e){Object.defineProperty(t,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(Color.recalculateHSV(this),this.__state[e])},set:function(r){this.__state.space!=="HSV"&&(Color.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=r}})}Color.recalculateRGB=function(t,e,n){if(t.__state.space==="HEX")t.__state[e]=ColorMath.component_from_hex(t.__state.hex,n);else if(t.__state.space==="HSV")Common.extend(t.__state,ColorMath.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v));else throw new Error("Corrupted color state")};Color.recalculateHSV=function(t){var e=ColorMath.rgb_to_hsv(t.r,t.g,t.b);Common.extend(t.__state,{s:e.s,v:e.v}),Common.isNaN(e.h)?Common.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h};Color.COMPONENTS=["r","g","b","h","s","v","hex","a"];defineRGBComponent(Color.prototype,"r",2);defineRGBComponent(Color.prototype,"g",1);defineRGBComponent(Color.prototype,"b",0);defineHSVComponent(Color.prototype,"h");defineHSVComponent(Color.prototype,"s");defineHSVComponent(Color.prototype,"v");Object.defineProperty(Color.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(Color.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ColorMath.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Controller=(function(){function t(e,n){classCallCheck(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return createClass(t,[{key:"onChange",value:function(n){return this.__onChange=n,this}},{key:"onFinishChange",value:function(n){return this.__onFinishChange=n,this}},{key:"setValue",value:function(n){return this.object[this.property]=n,this.__onChange&&this.__onChange.call(this,n),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t})(),EVENT_MAP={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},EVENT_MAP_INV={};Common.each(EVENT_MAP,function(t,e){Common.each(t,function(n){EVENT_MAP_INV[n]=e})});var CSS_VALUE_PIXELS=/(\d+(\.\d+)?)px/;function cssValueToPixels(t){if(t==="0"||Common.isUndefined(t))return 0;var e=t.match(CSS_VALUE_PIXELS);return Common.isNull(e)?0:parseFloat(e[1])}var dom={makeSelectable:function(e,n){e===void 0||e.style===void 0||(e.onselectstart=n?function(){return!1}:function(){},e.style.MozUserSelect=n?"auto":"none",e.style.KhtmlUserSelect=n?"auto":"none",e.unselectable=n?"on":"off")},makeFullscreen:function(e,n,r){var s=r,o=n;Common.isUndefined(o)&&(o=!0),Common.isUndefined(s)&&(s=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),s&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,n,r,s){var o=r||{},c=EVENT_MAP_INV[n];if(!c)throw new Error("Event type "+n+" not supported.");var d=document.createEvent(c);switch(c){case"MouseEvents":{var p=o.x||o.clientX||0,T=o.y||o.clientY||0;d.initMouseEvent(n,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,p,T,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var I=d.initKeyboardEvent||d.initKeyEvent;Common.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),I(n,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break}default:{d.initEvent(n,o.bubbles||!1,o.cancelable||!0);break}}Common.defaults(d,s),e.dispatchEvent(d)},bind:function(e,n,r,s){var o=s||!1;return e.addEventListener?e.addEventListener(n,r,o):e.attachEvent&&e.attachEvent("on"+n,r),dom},unbind:function(e,n,r,s){var o=s||!1;return e.removeEventListener?e.removeEventListener(n,r,o):e.detachEvent&&e.detachEvent("on"+n,r),dom},addClass:function(e,n){if(e.className===void 0)e.className=n;else if(e.className!==n){var r=e.className.split(/ +/);r.indexOf(n)===-1&&(r.push(n),e.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return dom},removeClass:function(e,n){if(n)if(e.className===n)e.removeAttribute("class");else{var r=e.className.split(/ +/),s=r.indexOf(n);s!==-1&&(r.splice(s,1),e.className=r.join(" "))}else e.className=void 0;return dom},hasClass:function(e,n){return new RegExp("(?:^|\\s+)"+n+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var n=getComputedStyle(e);return cssValueToPixels(n["border-left-width"])+cssValueToPixels(n["border-right-width"])+cssValueToPixels(n["padding-left"])+cssValueToPixels(n["padding-right"])+cssValueToPixels(n.width)},getHeight:function(e){var n=getComputedStyle(e);return cssValueToPixels(n["border-top-width"])+cssValueToPixels(n["border-bottom-width"])+cssValueToPixels(n["padding-top"])+cssValueToPixels(n["padding-bottom"])+cssValueToPixels(n.height)},getOffset:function(e){var n=e,r={left:0,top:0};if(n.offsetParent)do r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;while(n);return r},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},BooleanController=(function(t){inherits(e,t);function e(n,r){classCallCheck(this,e);var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s;s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox");function c(){o.setValue(!o.__prev)}return dom.bind(s.__checkbox,"change",c,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return createClass(e,[{key:"setValue",value:function(r){var s=get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),s}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(Controller),OptionController=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=s,d=o;if(o.__select=document.createElement("select"),Common.isArray(c)){var p={};Common.each(c,function(T){p[T]=T}),c=p}return Common.each(c,function(T,I){var D=document.createElement("option");D.innerHTML=I,D.setAttribute("value",T),d.__select.appendChild(D)}),o.updateDisplay(),dom.bind(o.__select,"change",function(){var T=this.options[this.selectedIndex].value;d.setValue(T)}),o.domElement.appendChild(o.__select),o}return createClass(e,[{key:"setValue",value:function(r){var s=get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),s}},{key:"updateDisplay",value:function(){return dom.isActive(this.__select)?this:(this.__select.value=this.getValue(),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e})(Controller),StringController=(function(t){inherits(e,t);function e(n,r){classCallCheck(this,e);var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),o=s;function c(){o.setValue(o.__input.value)}function d(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),dom.bind(s.__input,"keyup",c),dom.bind(s.__input,"change",c),dom.bind(s.__input,"blur",d),dom.bind(s.__input,"keydown",function(p){p.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return createClass(e,[{key:"updateDisplay",value:function(){return dom.isActive(this.__input)||(this.__input.value=this.getValue()),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(Controller);function numDecimals(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var NumberController=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=s||{};return o.__min=c.min,o.__max=c.max,o.__step=c.step,Common.isUndefined(o.__step)?o.initialValue===0?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=numDecimals(o.__impliedStep),o}return createClass(e,[{key:"setValue",value:function(r){var s=r;return this.__min!==void 0&&s<this.__min?s=this.__min:this.__max!==void 0&&s>this.__max&&(s=this.__max),this.__step!==void 0&&s%this.__step!==0&&(s=Math.round(s/this.__step)*this.__step),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,s)}},{key:"min",value:function(r){return this.__min=r,this}},{key:"max",value:function(r){return this.__max=r,this}},{key:"step",value:function(r){return this.__step=r,this.__impliedStep=r,this.__precision=numDecimals(r),this}}]),e})(Controller);function roundToDecimal(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}var NumberControllerBox=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,s));o.__truncationSuspended=!1;var c=o,d=void 0;function p(){var P=parseFloat(c.__input.value);Common.isNaN(P)||c.setValue(P)}function T(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function I(){T()}function D(P){var U=d-P.clientY;c.setValue(c.getValue()+U*c.__impliedStep),d=P.clientY}function x(){dom.unbind(window,"mousemove",D),dom.unbind(window,"mouseup",x),T()}function G(P){dom.bind(window,"mousemove",D),dom.bind(window,"mouseup",x),d=P.clientY}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),dom.bind(o.__input,"change",p),dom.bind(o.__input,"blur",I),dom.bind(o.__input,"mousedown",G),dom.bind(o.__input,"keydown",function(P){P.keyCode===13&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1,T())}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return createClass(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():roundToDecimal(this.getValue(),this.__precision),get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(NumberController);function map(t,e,n,r,s){return r+(s-r)*((t-e)/(n-e))}var NumberControllerSlider=(function(t){inherits(e,t);function e(n,r,s,o,c){classCallCheck(this,e);var d=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r,{min:s,max:o,step:c})),p=d;d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),dom.bind(d.__background,"mousedown",T),dom.bind(d.__background,"touchstart",x),dom.addClass(d.__background,"slider"),dom.addClass(d.__foreground,"slider-fg");function T(U){document.activeElement.blur(),dom.bind(window,"mousemove",I),dom.bind(window,"mouseup",D),I(U)}function I(U){U.preventDefault();var H=p.__background.getBoundingClientRect();return p.setValue(map(U.clientX,H.left,H.right,p.__min,p.__max)),!1}function D(){dom.unbind(window,"mousemove",I),dom.unbind(window,"mouseup",D),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}function x(U){U.touches.length===1&&(dom.bind(window,"touchmove",G),dom.bind(window,"touchend",P),G(U))}function G(U){var H=U.touches[0].clientX,X=p.__background.getBoundingClientRect();p.setValue(map(H,X.left,X.right,p.__min,p.__max))}function P(){dom.unbind(window,"touchmove",G),dom.unbind(window,"touchend",P),p.__onFinishChange&&p.__onFinishChange.call(p,p.getValue())}return d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return createClass(e,[{key:"updateDisplay",value:function(){var r=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=r*100+"%",get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e})(NumberController),FunctionController=(function(t){inherits(e,t);function e(n,r,s){classCallCheck(this,e);var o=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r)),c=o;return o.__button=document.createElement("div"),o.__button.innerHTML=s===void 0?"Fire":s,dom.bind(o.__button,"click",function(d){return d.preventDefault(),c.fire(),!1}),dom.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return createClass(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e})(Controller),ColorController=(function(t){inherits(e,t);function e(n,r){classCallCheck(this,e);var s=possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,r));s.__color=new Color(s.getValue()),s.__temp=new Color(0);var o=s;s.domElement=document.createElement("div"),dom.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",dom.bind(s.__input,"keydown",function(U){U.keyCode===13&&D.call(this)}),dom.bind(s.__input,"blur",D),dom.bind(s.__selector,"mousedown",function(){dom.addClass(this,"drag").bind(window,"mouseup",function(){dom.removeClass(o.__selector,"drag")})}),dom.bind(s.__selector,"touchstart",function(){dom.addClass(this,"drag").bind(window,"touchend",function(){dom.removeClass(o.__selector,"drag")})});var c=document.createElement("div");Common.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Common.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Common.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Common.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Common.extend(c.style,{width:"100%",height:"100%",background:"none"}),linearGradient(c,"top","rgba(0,0,0,0)","#000"),Common.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hueGradient(s.__hue_field),Common.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),dom.bind(s.__saturation_field,"mousedown",d),dom.bind(s.__saturation_field,"touchstart",d),dom.bind(s.__field_knob,"mousedown",d),dom.bind(s.__field_knob,"touchstart",d),dom.bind(s.__hue_field,"mousedown",p),dom.bind(s.__hue_field,"touchstart",p);function d(U){G(U),dom.bind(window,"mousemove",G),dom.bind(window,"touchmove",G),dom.bind(window,"mouseup",T),dom.bind(window,"touchend",T)}function p(U){P(U),dom.bind(window,"mousemove",P),dom.bind(window,"touchmove",P),dom.bind(window,"mouseup",I),dom.bind(window,"touchend",I)}function T(){dom.unbind(window,"mousemove",G),dom.unbind(window,"touchmove",G),dom.unbind(window,"mouseup",T),dom.unbind(window,"touchend",T),x()}function I(){dom.unbind(window,"mousemove",P),dom.unbind(window,"touchmove",P),dom.unbind(window,"mouseup",I),dom.unbind(window,"touchend",I),x()}function D(){var U=interpret(this.value);U!==!1?(o.__color.__state=U,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function x(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}s.__saturation_field.appendChild(c),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay();function G(U){U.type.indexOf("touch")===-1&&U.preventDefault();var H=o.__saturation_field.getBoundingClientRect(),X=U.touches&&U.touches[0]||U,j=X.clientX,K=X.clientY,q=(j-H.left)/(H.right-H.left),te=1-(K-H.top)/(H.bottom-H.top);return te>1?te=1:te<0&&(te=0),q>1?q=1:q<0&&(q=0),o.__color.v=te,o.__color.s=q,o.setValue(o.__color.toOriginal()),!1}function P(U){U.type.indexOf("touch")===-1&&U.preventDefault();var H=o.__hue_field.getBoundingClientRect(),X=U.touches&&U.touches[0]||U,j=X.clientY,K=1-(j-H.top)/(H.bottom-H.top);return K>1?K=1:K<0&&(K=0),o.__color.h=K*360,o.setValue(o.__color.toOriginal()),!1}return s}return createClass(e,[{key:"updateDisplay",value:function(){var r=interpret(this.getValue());if(r!==!1){var s=!1;Common.each(Color.COMPONENTS,function(d){if(!Common.isUndefined(r[d])&&!Common.isUndefined(this.__color.__state[d])&&r[d]!==this.__color.__state[d])return s=!0,{}},this),s&&Common.extend(this.__color.__state,r)}Common.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,c=255-o;Common.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Common.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+c+","+c+","+c+",.7)"})}}]),e})(Controller),vendors=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(t,e,n,r){t.style.background="",Common.each(vendors,function(s){t.style.cssText+="background: "+s+"linear-gradient("+e+", "+n+" 0%, "+r+" 100%); "})}function hueGradient(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var css={load:function(e,n){var r=n||document,s=r.createElement("link");s.type="text/css",s.rel="stylesheet",s.href=e,r.getElementsByTagName("head")[0].appendChild(s)},inject:function(e,n){var r=n||document,s=document.createElement("style");s.type="text/css",s.innerHTML=e;var o=r.getElementsByTagName("head")[0];try{o.appendChild(s)}catch{}}},saveDialogContents=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,ControllerFactory=function(e,n){var r=e[n];return Common.isArray(arguments[2])||Common.isObject(arguments[2])?new OptionController(e,n,arguments[2]):Common.isNumber(r)?Common.isNumber(arguments[2])&&Common.isNumber(arguments[3])?Common.isNumber(arguments[4])?new NumberControllerSlider(e,n,arguments[2],arguments[3],arguments[4]):new NumberControllerSlider(e,n,arguments[2],arguments[3]):Common.isNumber(arguments[4])?new NumberControllerBox(e,n,{min:arguments[2],max:arguments[3],step:arguments[4]}):new NumberControllerBox(e,n,{min:arguments[2],max:arguments[3]}):Common.isString(r)?new StringController(e,n):Common.isFunction(r)?new FunctionController(e,n,""):Common.isBoolean(r)?new BooleanController(e,n):null};function requestAnimationFrame$1(t){setTimeout(t,1e3/60)}var requestAnimationFrame$1$1=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||requestAnimationFrame$1,CenteredDiv=(function(){function t(){classCallCheck(this,t),this.backgroundElement=document.createElement("div"),Common.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),dom.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Common.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;dom.bind(this.backgroundElement,"click",function(){e.hide()})}return createClass(t,[{key:"show",value:function(){var n=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Common.defer(function(){n.backgroundElement.style.opacity=1,n.domElement.style.opacity=1,n.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var n=this,r=function s(){n.domElement.style.display="none",n.backgroundElement.style.display="none",dom.unbind(n.domElement,"webkitTransitionEnd",s),dom.unbind(n.domElement,"transitionend",s),dom.unbind(n.domElement,"oTransitionEnd",s)};dom.bind(this.domElement,"webkitTransitionEnd",r),dom.bind(this.domElement,"transitionend",r),dom.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-dom.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-dom.getHeight(this.domElement)/2+"px"}}]),t})(),styleSheet=___$insertStyle(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);css.inject(styleSheet);var CSS_NAMESPACE="dg",HIDE_KEY_CODE=72,CLOSE_BUTTON_HEIGHT=20,DEFAULT_DEFAULT_PRESET_NAME="Default",SUPPORTS_LOCAL_STORAGE=(function(){try{return!!window.localStorage}catch{return!1}})(),SAVE_DIALOGUE=void 0,autoPlaceVirgin=!0,autoPlaceContainer=void 0,hide=!1,hideableGuis=[],GUI=function t(e){var n=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),dom.addClass(this.domElement,CSS_NAMESPACE),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=Common.defaults(r,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),r=Common.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),Common.isUndefined(r.load)?r.load={preset:DEFAULT_DEFAULT_PRESET_NAME}:r.preset&&(r.load.preset=r.preset),Common.isUndefined(r.parent)&&r.hideable&&hideableGuis.push(this),r.resizable=Common.isUndefined(r.parent)&&r.resizable,r.autoPlace&&Common.isUndefined(r.scrollable)&&(r.scrollable=!0);var s=SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(this,"isLocal"))==="true",o=void 0,c=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(x){n.parent?n.getRoot().preset=x:r.load.preset=x,setPresetSelectIndex(this),n.revert()}},width:{get:function(){return r.width},set:function(x){r.width=x,setWidth(n,x)}},name:{get:function(){return r.name},set:function(x){r.name=x,c&&(c.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(x){r.closed=x,r.closed?dom.addClass(n.__ul,t.CLASS_CLOSED):dom.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=x?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return s},set:function(x){SUPPORTS_LOCAL_STORAGE&&(s=x,x?dom.bind(window,"unload",o):dom.unbind(window,"unload",o),localStorage.setItem(getLocalStorageHash(n,"isLocal"),x))}}}),Common.isUndefined(r.parent)){if(this.closed=r.closed||!1,dom.addClass(this.domElement,t.CLASS_MAIN),dom.makeSelectable(this.domElement,!1),SUPPORTS_LOCAL_STORAGE&&s){n.useLocalStorage=!0;var d=localStorage.getItem(getLocalStorageHash(this,"gui"));d&&(r.load=JSON.parse(d))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,dom.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),r.closeOnTop?(dom.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(dom.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),dom.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{r.closed===void 0&&(r.closed=!0);var p=document.createTextNode(r.name);dom.addClass(p,"controller-name"),c=addRow(n,p);var T=function(x){return x.preventDefault(),n.closed=!n.closed,!1};dom.addClass(this.__ul,t.CLASS_CLOSED),dom.addClass(c,"title"),dom.bind(c,"click",T),r.closed||(this.closed=!1)}r.autoPlace&&(Common.isUndefined(r.parent)&&(autoPlaceVirgin&&(autoPlaceContainer=document.createElement("div"),dom.addClass(autoPlaceContainer,CSS_NAMESPACE),dom.addClass(autoPlaceContainer,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(autoPlaceContainer),autoPlaceVirgin=!1),autoPlaceContainer.appendChild(this.domElement),dom.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||setWidth(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},dom.bind(window,"resize",this.__resizeHandler),dom.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),dom.bind(this.__ul,"transitionend",this.__resizeHandler),dom.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&addResizeHandle(this),o=function(){SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(n,"isLocal"))==="true"&&localStorage.setItem(getLocalStorageHash(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o;function I(){var D=n.getRoot();D.width+=1,Common.defer(function(){D.width-=1})}r.parent||I()};GUI.toggleHide=function(){hide=!hide,Common.each(hideableGuis,function(t){t.domElement.style.display=hide?"none":""})};GUI.CLASS_AUTO_PLACE="a";GUI.CLASS_AUTO_PLACE_CONTAINER="ac";GUI.CLASS_MAIN="main";GUI.CLASS_CONTROLLER_ROW="cr";GUI.CLASS_TOO_TALL="taller-than-window";GUI.CLASS_CLOSED="closed";GUI.CLASS_CLOSE_BUTTON="close-button";GUI.CLASS_CLOSE_TOP="close-top";GUI.CLASS_CLOSE_BOTTOM="close-bottom";GUI.CLASS_DRAG="drag";GUI.DEFAULT_WIDTH=245;GUI.TEXT_CLOSED="Close Controls";GUI.TEXT_OPEN="Open Controls";GUI._keydownHandler=function(t){document.activeElement.type!=="text"&&(t.which===HIDE_KEY_CODE||t.keyCode===HIDE_KEY_CODE)&&GUI.toggleHide()};dom.bind(window,"keydown",GUI._keydownHandler,!1);Common.extend(GUI.prototype,{add:function(e,n){return _add(this,e,n,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,n){return _add(this,e,n,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var n=this;Common.defer(function(){n.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&autoPlaceContainer.removeChild(this.domElement);var e=this;Common.each(this.__folders,function(n){e.removeFolder(n)}),dom.unbind(window,"keydown",GUI._keydownHandler,!1),removeListeners(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var n={name:e,parent:this};n.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(n.closed=this.load.folders[e].closed,n.load=this.load.folders[e]);var r=new GUI(n);this.__folders[e]=r;var s=addRow(this,r.domElement);return dom.addClass(s,"folder"),r},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],removeListeners(e);var n=this;Common.each(e.__folders,function(r){e.removeFolder(r)}),Common.defer(function(){n.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var n=dom.getOffset(e.__ul).top,r=0;Common.each(e.__ul.childNodes,function(s){e.autoPlace&&s===e.__save_row||(r+=dom.getHeight(s))}),window.innerHeight-n-CLOSE_BUTTON_HEIGHT<r?(dom.addClass(e.domElement,GUI.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-n-CLOSE_BUTTON_HEIGHT+"px"):(dom.removeClass(e.domElement,GUI.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&Common.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:Common.debounce(function(){this.onResize()},50),remember:function(){if(Common.isUndefined(SAVE_DIALOGUE)&&(SAVE_DIALOGUE=new CenteredDiv,SAVE_DIALOGUE.domElement.innerHTML=saveDialogContents),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;Common.each(Array.prototype.slice.call(arguments),function(n){e.__rememberedObjects.length===0&&addSaveMenu(e),e.__rememberedObjects.indexOf(n)===-1&&e.__rememberedObjects.push(n)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=getCurrentPreset(this)),e.folders={},Common.each(this.__folders,function(n,r){e.folders[r]=n.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME]=getCurrentPreset(this,!0)),this.load.remembered[e]=getCurrentPreset(this),this.preset=e,addPresetOption(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){Common.each(this.__controllers,function(n){this.getRoot().load.remembered?recallSavedValue(e||this.getRoot(),n):n.setValue(n.initialValue),n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())},this),Common.each(this.__folders,function(n){n.revert(n)}),e||markPresetModified(this.getRoot(),!1)},listen:function(e){var n=this.__listening.length===0;this.__listening.push(e),n&&updateDisplays(this.__listening)},updateDisplay:function(){Common.each(this.__controllers,function(e){e.updateDisplay()}),Common.each(this.__folders,function(e){e.updateDisplay()})}});function addRow(t,e,n){var r=document.createElement("li");return e&&r.appendChild(e),n?t.__ul.insertBefore(r,n):t.__ul.appendChild(r),t.onResize(),r}function removeListeners(t){dom.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&dom.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function markPresetModified(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];e?n.innerHTML=n.value+"*":n.innerHTML=n.value}function augmentController(t,e,n){if(n.__li=e,n.__gui=t,Common.extend(n,{options:function(c){if(arguments.length>1){var d=n.__li.nextElementSibling;return n.remove(),_add(t,n.object,n.property,{before:d,factoryArgs:[Common.toArray(arguments)]})}if(Common.isArray(c)||Common.isObject(c)){var p=n.__li.nextElementSibling;return n.remove(),_add(t,n.object,n.property,{before:p,factoryArgs:[c]})}},name:function(c){return n.__li.firstElementChild.firstElementChild.innerHTML=c,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof NumberControllerSlider){var r=new NumberControllerBox(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});Common.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(o){var c=n[o],d=r[o];n[o]=r[o]=function(){var p=Array.prototype.slice.call(arguments);return d.apply(r,p),c.apply(n,p)}}),dom.addClass(e,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof NumberControllerBox){var s=function(c){if(Common.isNumber(n.__min)&&Common.isNumber(n.__max)){var d=n.__li.firstElementChild.firstElementChild.innerHTML,p=n.__gui.__listening.indexOf(n)>-1;n.remove();var T=_add(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return T.name(d),p&&T.listen(),T}return c};n.min=Common.compose(s,n.min),n.max=Common.compose(s,n.max)}else n instanceof BooleanController?(dom.bind(e,"click",function(){dom.fakeEvent(n.__checkbox,"click")}),dom.bind(n.__checkbox,"click",function(o){o.stopPropagation()})):n instanceof FunctionController?(dom.bind(e,"click",function(){dom.fakeEvent(n.__button,"click")}),dom.bind(e,"mouseover",function(){dom.addClass(n.__button,"hover")}),dom.bind(e,"mouseout",function(){dom.removeClass(n.__button,"hover")})):n instanceof ColorController&&(dom.addClass(e,"color"),n.updateDisplay=Common.compose(function(o){return e.style.borderLeftColor=n.__color.toString(),o},n.updateDisplay),n.updateDisplay());n.setValue=Common.compose(function(o){return t.getRoot().__preset_select&&n.isModified()&&markPresetModified(t.getRoot(),!0),o},n.setValue)}function recallSavedValue(t,e){var n=t.getRoot(),r=n.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=n.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},n.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,c=void 0;if(o[t.preset])c=o[t.preset];else if(o[DEFAULT_DEFAULT_PRESET_NAME])c=o[DEFAULT_DEFAULT_PRESET_NAME];else return;if(c[r]&&c[r][e.property]!==void 0){var d=c[r][e.property];e.initialValue=d,e.setValue(d)}}}}function _add(t,e,n,r){if(e[n]===void 0)throw new Error('Object "'+e+'" has no property "'+n+'"');var s=void 0;if(r.color)s=new ColorController(e,n);else{var o=[e,n].concat(r.factoryArgs);s=ControllerFactory.apply(t,o)}r.before instanceof Controller&&(r.before=r.before.__li),recallSavedValue(t,s),dom.addClass(s.domElement,"c");var c=document.createElement("span");dom.addClass(c,"property-name"),c.innerHTML=s.property;var d=document.createElement("div");d.appendChild(c),d.appendChild(s.domElement);var p=addRow(t,d,r.before);return dom.addClass(p,GUI.CLASS_CONTROLLER_ROW),s instanceof ColorController?dom.addClass(p,"color"):dom.addClass(p,_typeof(s.getValue())),augmentController(t,p,s),t.__controllers.push(s),s}function getLocalStorageHash(t,e){return document.location.href+"."+e}function addPresetOption(t,e,n){var r=document.createElement("option");r.innerHTML=e,r.value=e,t.__preset_select.appendChild(r),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function showHideExplain(t,e){e.style.display=t.useLocalStorage?"block":"none"}function addSaveMenu(t){var e=t.__save_row=document.createElement("li");dom.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),dom.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",dom.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",dom.addClass(r,"button"),dom.addClass(r,"save");var s=document.createElement("span");s.innerHTML="New",dom.addClass(s,"button"),dom.addClass(s,"save-as");var o=document.createElement("span");o.innerHTML="Revert",dom.addClass(o,"button"),dom.addClass(o,"revert");var c=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?Common.each(t.load.remembered,function(D,x){addPresetOption(t,x,x===t.preset)}):addPresetOption(t,DEFAULT_DEFAULT_PRESET_NAME,!1),dom.bind(c,"change",function(){for(var D=0;D<t.__preset_select.length;D++)t.__preset_select[D].innerHTML=t.__preset_select[D].value;t.preset=this.value}),e.appendChild(c),e.appendChild(n),e.appendChild(r),e.appendChild(s),e.appendChild(o),SUPPORTS_LOCAL_STORAGE){var d=document.getElementById("dg-local-explain"),p=document.getElementById("dg-local-storage"),T=document.getElementById("dg-save-locally");T.style.display="block",localStorage.getItem(getLocalStorageHash(t,"isLocal"))==="true"&&p.setAttribute("checked","checked"),showHideExplain(t,d),dom.bind(p,"change",function(){t.useLocalStorage=!t.useLocalStorage,showHideExplain(t,d)})}var I=document.getElementById("dg-new-constructor");dom.bind(I,"keydown",function(D){D.metaKey&&(D.which===67||D.keyCode===67)&&SAVE_DIALOGUE.hide()}),dom.bind(n,"click",function(){I.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),SAVE_DIALOGUE.show(),I.focus(),I.select()}),dom.bind(r,"click",function(){t.save()}),dom.bind(s,"click",function(){var D=prompt("Enter a new preset name.");D&&t.saveAs(D)}),dom.bind(o,"click",function(){t.revert()})}function addResizeHandle(t){var e=void 0;t.__resize_handle=document.createElement("div"),Common.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function n(o){return o.preventDefault(),t.width+=e-o.clientX,t.onResize(),e=o.clientX,!1}function r(){dom.removeClass(t.__closeButton,GUI.CLASS_DRAG),dom.unbind(window,"mousemove",n),dom.unbind(window,"mouseup",r)}function s(o){return o.preventDefault(),e=o.clientX,dom.addClass(t.__closeButton,GUI.CLASS_DRAG),dom.bind(window,"mousemove",n),dom.bind(window,"mouseup",r),!1}dom.bind(t.__resize_handle,"mousedown",s),dom.bind(t.__closeButton,"mousedown",s),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function setWidth(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function getCurrentPreset(t,e){var n={};return Common.each(t.__rememberedObjects,function(r,s){var o={},c=t.__rememberedObjectIndecesToControllers[s];Common.each(c,function(d,p){o[p]=e?d.initialValue:d.getValue()}),n[s]=o}),n}function setPresetSelectIndex(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function updateDisplays(t){t.length!==0&&requestAnimationFrame$1$1.call(window,function(){updateDisplays(t)}),Common.each(t,function(e){e.updateDisplay()})}var GUI$1=GUI,canvas,canvasFormat,context,device,aspectRatio;const fovYDegrees=45;var modelBindGroupLayout,materialBindGroupLayout;async function initWebGPU(){canvas=document.getElementById("mainCanvas");const t=window.devicePixelRatio;if(canvas.width=canvas.clientWidth*t,canvas.height=canvas.clientHeight*t,aspectRatio=canvas.width/canvas.height,!navigator.gpu){let n=document.createElement("h1");throw n.textContent="This browser doesn't support WebGPU! Try using Google Chrome.",n.style.paddingLeft="0.4em",document.body.innerHTML="",document.body.appendChild(n),new Error("WebGPU not supported on this browser")}const e=await navigator.gpu.requestAdapter();if(!e)throw new Error("no appropriate GPUAdapter found");device=await e.requestDevice(),context=canvas.getContext("webgpu"),canvasFormat=navigator.gpu.getPreferredCanvasFormat(),context.configure({device,format:canvasFormat}),console.log("WebGPU init successsful"),modelBindGroupLayout=device.createBindGroupLayout({label:"model bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),materialBindGroupLayout=device.createBindGroupLayout({label:"material bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{}}]})}const vertexBufferLayout={arrayStride:32,attributes:[{format:"float32x3",offset:0,shaderLocation:0},{format:"float32x3",offset:12,shaderLocation:1},{format:"float32x2",offset:24,shaderLocation:2}]};class Renderer{scene;lights;camera;stats;prevTime=0;frameRequestId;constructor(e){this.scene=e.scene,this.lights=e.lights,this.camera=e.camera,this.stats=e.stats,this.frameRequestId=requestAnimationFrame(n=>this.onFrame(n))}stop(){cancelAnimationFrame(this.frameRequestId)}onFrame(e){this.prevTime==0&&(this.prevTime=e);let n=e-this.prevTime;this.camera.onFrame(n),this.lights.onFrame(e),this.stats.begin(),this.draw(),this.stats.end(),this.prevTime=e,this.frameRequestId=requestAnimationFrame(r=>this.onFrame(r))}}const commonRaw=`// CHECKITOUT: code that you add here will be prepended to all shaders\r
\r
struct Light {\r
    pos: vec3f,\r
    color: vec3f\r
}\r
\r
struct LightSet {\r
    numLights: u32,\r
    lights: array<Light>\r
}\r
\r
// TODO-2: you may want to create a ClusterSet struct similar to LightSet\r
struct Cluster {\r
    minBounds: vec3f,\r
    maxBounds: vec3f,\r
    lightCount: u32,\r
    lightIndices: array<u32, \${maxLightsPerCluster}>\r
}\r
\r
struct ClusterSet {\r
    clusters: array<Cluster>\r
}\r
\r
struct CameraUniforms {\r
    // TODO-1.3: add an entry for the view proj mat (of type mat4x4f)\r
    viewProjMat: mat4x4f,\r
    invViewProjMat: mat4x4f,\r
    viewMat: mat4x4f,\r
    invProjMat: mat4x4f,\r
    cameraPos: vec3f,\r
    nearPlane: f32,\r
    farPlane: f32,\r
    screenWidth: f32,\r
    screenHeight: f32,\r
}\r
\r
// CHECKITOUT: this special attenuation function ensures lights don't affect geometry outside the maximum light radius\r
fn rangeAttenuation(distance: f32) -> f32 {\r
    return clamp(1.f - pow(distance / \${lightRadius}, 4.f), 0.f, 1.f) / (distance * distance);\r
}\r
\r
fn calculateLightContrib(light: Light, posWorld: vec3f, nor: vec3f) -> vec3f {\r
    let vecToLight = light.pos - posWorld;\r
    let distToLight = length(vecToLight);\r
\r
    let lambert = max(dot(nor, normalize(vecToLight)), 0.f);\r
    return light.color * lambert * rangeAttenuation(distToLight);\r
}\r
`,naiveVertRaw=`// CHECKITOUT: you can use this vertex shader for all of the renderers\r
\r
// TODO-1.3: add a uniform variable here for camera uniforms (of type CameraUniforms)\r
// make sure to use \${bindGroup_scene} for the group\r
@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;\r
\r
@group(\${bindGroup_model}) @binding(0) var<uniform> modelMat: mat4x4f;\r
\r
struct VertexInput\r
{\r
    @location(0) pos: vec3f,\r
    @location(1) nor: vec3f,\r
    @location(2) uv: vec2f\r
}\r
\r
struct VertexOutput\r
{\r
    @builtin(position) fragPos: vec4f,\r
    @location(0) pos: vec3f,\r
    @location(1) nor: vec3f,\r
    @location(2) uv: vec2f\r
}\r
\r
@vertex\r
fn main(in: VertexInput) -> VertexOutput\r
{\r
    let modelPos = modelMat * vec4(in.pos, 1);\r
\r
    var out: VertexOutput;\r
    out.fragPos = cameraUniforms.viewProjMat * modelPos; // TODO-1.3: replace ??? with the view proj mat from your CameraUniforms uniform variable\r
    out.pos = modelPos.xyz / modelPos.w;\r
    out.nor = in.nor;\r
    out.uv = in.uv;\r
    return out;\r
}\r
`,naiveFragRaw=`@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;\r
\r
@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;\r
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;\r
\r
struct FragmentInput\r
{\r
    @location(0) pos: vec3f,\r
    @location(1) nor: vec3f,\r
    @location(2) uv: vec2f\r
}\r
\r
@fragment\r
fn main(in: FragmentInput) -> @location(0) vec4f\r
{\r
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);\r
    if (diffuseColor.a < 0.5f) {\r
        discard;\r
    }\r
\r
    var totalLightContrib = vec3f(0, 0, 0);\r
    for (var lightIdx = 0u; lightIdx < lightSet.numLights; lightIdx++) {\r
        let light = lightSet.lights[lightIdx];\r
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));\r
    }\r
\r
    var finalColor = diffuseColor.rgb * totalLightContrib;\r
    return vec4(finalColor, 1);\r
}\r
`,forwardPlusFragRaw=`// TODO-2: implement the Forward+ fragment shader\r
\r
// See naive.fs.wgsl for basic fragment shader setup; this shader should use light clusters instead of looping over all lights\r
\r
// ------------------------------------\r
// Shading process:\r
// ------------------------------------\r
// Determine which cluster contains the current fragment.\r
// Retrieve the number of lights that affect the current fragment from the clusters data.\r
// Initialize a variable to accumulate the total light contribution for the fragment.\r
// For each light in the cluster:\r
//     Access the light's properties using its index.\r
//     Calculate the contribution of the light based on its position, the fragments position, and the surface normal.\r
//     Add the calculated contribution to the total light accumulation.\r
// Multiply the fragments diffuse color by the accumulated light contribution.\r
// Return the final color, ensuring that the alpha component is set appropriately (typically to 1).\r
\r
@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;\r
@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;\r
@group(\${bindGroup_scene}) @binding(2) var<storage, read> clusterSet: ClusterSet;\r
\r
@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;\r
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;\r
\r
struct FragmentInput\r
{\r
    @builtin(position) fragCoord: vec4f,\r
    @location(0) pos: vec3f,\r
    @location(1) nor: vec3f,\r
    @location(2) uv: vec2f\r
}\r
\r
@fragment\r
fn main(in: FragmentInput) -> @location(0) vec4f\r
{\r
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);\r
    if (diffuseColor.a < 0.5f) {\r
        discard;\r
    }\r
\r
    let clusterX = u32(in.fragCoord.x / cameraUniforms.screenWidth * f32(\${clusterWidth}));\r
    let clusterY = u32(in.fragCoord.y / cameraUniforms.screenHeight * f32(\${clusterHeight}));\r
    \r
    let viewPos = (cameraUniforms.viewMat * vec4f(in.pos, 1.0)).xyz;\r
    let viewDepth = -viewPos.z;\r
    let near = cameraUniforms.nearPlane;\r
    let far = cameraUniforms.farPlane;\r
    let clusterZ = u32(log(viewDepth / near) / log(far / near) * f32(\${clusterDepth}));\r
\r
    let clusterIndex = clusterX + clusterY * \${clusterWidth} + clusterZ * \${clusterWidth} * \${clusterHeight};\r
\r
    let cluster = &clusterSet.clusters[clusterIndex];\r
    let numLights = (*cluster).lightCount;\r
\r
    var totalLightContrib = vec3f(0, 0, 0);\r
    for (var i = 0u; i < numLights; i++) {\r
        let lightIdx = (*cluster).lightIndices[i];\r
        let light = lightSet.lights[lightIdx];\r
        totalLightContrib += calculateLightContrib(light, in.pos, normalize(in.nor));\r
    }\r
\r
    var finalColor = diffuseColor.rgb * totalLightContrib;\r
    return vec4(finalColor, 1);\r
}\r
`,clusteredDeferredFragRaw=`// TODO-3: implement the Clustered Deferred G-buffer fragment shader\r
\r
// This shader should only store G-buffer information and should not do any shading.\r
\r
@group(\${bindGroup_material}) @binding(0) var diffuseTex: texture_2d<f32>;\r
@group(\${bindGroup_material}) @binding(1) var diffuseTexSampler: sampler;\r
\r
struct FragmentInput\r
{\r
    @location(0) pos: vec3f,\r
    @location(1) nor: vec3f,\r
    @location(2) uv: vec2f\r
}\r
\r
struct GBufferOutput\r
{\r
    @location(0) position: vec4f,\r
    @location(1) normal: vec4f,\r
    @location(2) albedo: vec4f\r
}\r
\r
@fragment\r
fn main(in: FragmentInput) -> GBufferOutput\r
{\r
    let diffuseColor = textureSample(diffuseTex, diffuseTexSampler, in.uv);\r
    if (diffuseColor.a < 0.5f) {\r
        discard;\r
    }\r
\r
    var output: GBufferOutput;\r
    output.position = vec4f(in.pos, 1.0);\r
    output.normal = vec4f(normalize(in.nor), 1.0);\r
    output.albedo = diffuseColor;\r
    \r
    return output;\r
}\r
`,clusteredDeferredFullscreenVertRaw=`// TODO-3: implement the Clustered Deferred fullscreen vertex shader\r
\r
// This shader should be very simple as it does not need all of the information passed by the the naive vertex shader.\r
\r
struct VertexOutput\r
{\r
    @builtin(position) position: vec4f,\r
    @location(0) uv: vec2f\r
}\r
\r
@vertex\r
fn main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput\r
{\r
    var positions = array<vec2f, 6>(\r
        vec2f(-1.0, -1.0),\r
        vec2f(1.0, -1.0),\r
        vec2f(1.0, 1.0),\r
        vec2f(-1.0, -1.0),\r
        vec2f(1.0, 1.0),\r
        vec2f(-1.0, 1.0)\r
    );\r
\r
    var uvs = array<vec2f, 6>(\r
        vec2f(0.0, 1.0),\r
        vec2f(1.0, 1.0),\r
        vec2f(1.0, 0.0),\r
        vec2f(0.0, 1.0),\r
        vec2f(1.0, 0.0),\r
        vec2f(0.0, 0.0)\r
    );\r
\r
    var output: VertexOutput;\r
    output.position = vec4f(positions[vertexIndex], 0.0, 1.0);\r
    output.uv = uvs[vertexIndex];\r
    return output;\r
}\r
`,clusteredDeferredFullscreenFragRaw=`// TODO-3: implement the Clustered Deferred fullscreen fragment shader\r
\r
// Similar to the Forward+ fragment shader, but with vertex information coming from the G-buffer instead.\r
\r
@group(\${bindGroup_scene}) @binding(0) var<uniform> cameraUniforms: CameraUniforms;\r
@group(\${bindGroup_scene}) @binding(1) var<storage, read> lightSet: LightSet;\r
@group(\${bindGroup_scene}) @binding(2) var<storage, read> clusterSet: ClusterSet;\r
@group(\${bindGroup_scene}) @binding(3) var gBufferPosition: texture_2d<f32>;\r
@group(\${bindGroup_scene}) @binding(4) var gBufferNormal: texture_2d<f32>;\r
@group(\${bindGroup_scene}) @binding(5) var gBufferAlbedo: texture_2d<f32>;\r
\r
struct FragmentInput\r
{\r
    @builtin(position) fragCoord: vec4f,\r
    @location(0) uv: vec2f\r
}\r
\r
@fragment\r
fn main(in: FragmentInput) -> @location(0) vec4f\r
{\r
    let texCoord = vec2i(floor(in.fragCoord.xy));\r
    \r
    let position = textureLoad(gBufferPosition, texCoord, 0).xyz;\r
    let normal = textureLoad(gBufferNormal, texCoord, 0).xyz;\r
    let albedo = textureLoad(gBufferAlbedo, texCoord, 0);\r
\r
    let clusterX = u32(in.fragCoord.x / cameraUniforms.screenWidth * f32(\${clusterWidth}));\r
    let clusterY = u32(in.fragCoord.y / cameraUniforms.screenHeight * f32(\${clusterHeight}));\r
    \r
    let viewPos = (cameraUniforms.viewMat * vec4f(position, 1.0)).xyz;\r
    let viewDepth = -viewPos.z;\r
    let near = cameraUniforms.nearPlane;\r
    let far = cameraUniforms.farPlane;\r
    let clusterZ = u32(log(viewDepth / near) / log(far / near) * f32(\${clusterDepth}));\r
\r
    let clusterIndex = clusterX + clusterY * \${clusterWidth} + clusterZ * \${clusterWidth} * \${clusterHeight};\r
\r
    let cluster = &clusterSet.clusters[clusterIndex];\r
    let numLights = (*cluster).lightCount;\r
\r
    var totalLightContrib = vec3f(0, 0, 0);\r
    for (var i = 0u; i < numLights; i++) {\r
        let lightIdx = (*cluster).lightIndices[i];\r
        let light = lightSet.lights[lightIdx];\r
        totalLightContrib += calculateLightContrib(light, position, normalize(normal));\r
    }\r
\r
    var finalColor = albedo.rgb * totalLightContrib;\r
    return vec4(finalColor, 1);\r
}\r
`,moveLightsComputeRaw=`@group(\${bindGroup_scene}) @binding(0) var<storage, read_write> lightSet: LightSet;\r
@group(\${bindGroup_scene}) @binding(1) var<uniform> time: f32;\r
\r
// https://gist.github.com/munrocket/236ed5ba7e409b8bdf1ff6eca5dcdc39\r
// MIT License.  Stefan Gustavson, Munrocket\r
fn permute4(x: vec4f) -> vec4f { return ((x * 34. + 1.) * x) % vec4f(289.); }\r
fn fade2(t: vec2f) -> vec2f { return t * t * t * (t * (t * 6. - 15.) + 10.); }\r
\r
fn perlin(P: vec2f) -> f32 {\r
    var Pi: vec4f = floor(P.xyxy) + vec4f(0., 0., 1., 1.);\r
    let Pf = fract(P.xyxy) - vec4f(0., 0., 1., 1.);\r
    Pi = Pi % vec4f(289.); // To avoid truncation effects in permutation\r
    let ix = Pi.xzxz;\r
    let iy = Pi.yyww;\r
    let fx = Pf.xzxz;\r
    let fy = Pf.yyww;\r
    let i = permute4(permute4(ix) + iy);\r
    var gx: vec4f = 2. * fract(i * 0.0243902439) - 1.; // 1/41 = 0.024...\r
    let gy = abs(gx) - 0.5;\r
    let tx = floor(gx + 0.5);\r
    gx = gx - tx;\r
    var g00: vec2f = vec2f(gx.x, gy.x);\r
    var g10: vec2f = vec2f(gx.y, gy.y);\r
    var g01: vec2f = vec2f(gx.z, gy.z);\r
    var g11: vec2f = vec2f(gx.w, gy.w);\r
    let norm = 1.79284291400159 - 0.85373472095314 *\r
        vec4f(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));\r
    g00 = g00 * norm.x;\r
    g01 = g01 * norm.y;\r
    g10 = g10 * norm.z;\r
    g11 = g11 * norm.w;\r
    let n00 = dot(g00, vec2f(fx.x, fy.x));\r
    let n10 = dot(g10, vec2f(fx.y, fy.y));\r
    let n01 = dot(g01, vec2f(fx.z, fy.z));\r
    let n11 = dot(g11, vec2f(fx.w, fy.w));\r
    let fade_xy = fade2(Pf.xy);\r
    let n_x = mix(vec2f(n00, n01), vec2f(n10, n11), vec2f(fade_xy.x));\r
    let n_xy = mix(n_x.x, n_x.y, fade_xy.y);\r
    return 2.3 * n_xy;\r
}\r
\r
fn perlin3(lightIdx: u32, scaledTime: f32) -> vec3f {\r
    let seedPos = vec2f(f32(lightIdx) * 163.81f, scaledTime);\r
    return vec3f(perlin(seedPos), perlin(seedPos + 110.93), perlin(seedPos + 350.51));\r
}\r
\r
const bboxMin = vec3f(-10, 0, -5);\r
const bboxMax = vec3f(10, 8, 5);\r
\r
// CHECKITOUT: this is an example of a compute shader entry point function\r
@compute\r
@workgroup_size(\${moveLightsWorkgroupSize})\r
fn main(@builtin(global_invocation_id) globalIdx: vec3u) {\r
    let lightIdx = globalIdx.x;\r
    if (lightIdx >= lightSet.numLights) {\r
        return;\r
    }\r
\r
    let scaledTime = time / 5000.f;\r
\r
    let noise = perlin3(lightIdx, scaledTime);\r
    // perlin noise rarely reaches the extremes (-1 and 1), so scale accordingly here to ensure lights reach\r
    // the bounding box's sides\r
    let scaledNoise = (noise + 0.5) * 0.8;\r
    lightSet.lights[lightIdx].pos = mix(bboxMin, bboxMax, scaledNoise);\r
}\r
`,clusteringComputeRaw=`// TODO-2: implement the light clustering compute shader\r
\r
// ------------------------------------\r
// Calculating cluster bounds:\r
// ------------------------------------\r
// For each cluster (X, Y, Z):\r
//     - Calculate the screen-space bounds for this cluster in 2D (XY).\r
//     - Calculate the depth bounds for this cluster in Z (near and far planes).\r
//     - Convert these screen and depth bounds into view-space coordinates.\r
//     - Store the computed bounding box (AABB) for the cluster.\r
\r
// ------------------------------------\r
// Assigning lights to clusters:\r
// ------------------------------------\r
// For each cluster:\r
//     - Initialize a counter for the number of lights in this cluster.\r
\r
//     For each light:\r
//         - Check if the light intersects with the clusters bounding box (AABB).\r
//         - If it does, add the light to the cluster's light list.\r
//         - Stop adding lights if the maximum number of lights is reached.\r
\r
//     - Store the number of lights assigned to this cluster.\r
\r
@group(0) @binding(0) var<uniform> cameraUniforms: CameraUniforms;\r
@group(0) @binding(1) var<storage, read> lightSet: LightSet;\r
@group(0) @binding(2) var<storage, read_write> clusterSet: ClusterSet;\r
\r
fn cornerRayDir(ndcXY: vec2f) -> vec3f {\r
    let p = cameraUniforms.invProjMat * vec4f(ndcXY, 1.0, 1.0);\r
    let v = p.xyz / p.w;\r
    return v / v.z;\r
}\r
\r
fn sphereAABBIntersection(center: vec3f, radius: f32, minBounds: vec3f, maxBounds: vec3f) -> bool {\r
    let closestPoint = clamp(center, minBounds, maxBounds);\r
    let distance = length(center - closestPoint);\r
    return distance <= radius;\r
}\r
\r
@compute\r
@workgroup_size(\${clusteringWorkgroupSize}, \${clusteringWorkgroupSize}, \${clusteringWorkgroupSize})\r
fn main(@builtin(global_invocation_id) globalId: vec3u) {\r
    let clusterX = globalId.x;\r
    let clusterY = globalId.y;\r
    let clusterZ = globalId.z;\r
\r
    if (clusterX >= \${clusterWidth} || clusterY >= \${clusterHeight} || clusterZ >= \${clusterDepth}) {\r
        return;\r
    }\r
\r
    let clusterIndex = clusterX + clusterY * \${clusterWidth} + clusterZ * \${clusterWidth} * \${clusterHeight};\r
\r
    let minScreenX = f32(clusterX) / f32(\${clusterWidth}) * cameraUniforms.screenWidth;\r
    let maxScreenX = f32(clusterX + 1u) / f32(\${clusterWidth}) * cameraUniforms.screenWidth;\r
    let minScreenY = f32(clusterY) / f32(\${clusterHeight}) * cameraUniforms.screenHeight;\r
    let maxScreenY = f32(clusterY + 1u) / f32(\${clusterHeight}) * cameraUniforms.screenHeight;\r
\r
    let minNdcXY = vec2f(\r
        minScreenX / cameraUniforms.screenWidth * 2.0 - 1.0,\r
        (1.0 - minScreenY / cameraUniforms.screenHeight) * 2.0 - 1.0\r
    );\r
    let maxNdcXY = vec2f(\r
        maxScreenX / cameraUniforms.screenWidth * 2.0 - 1.0,\r
        (1.0 - maxScreenY / cameraUniforms.screenHeight) * 2.0 - 1.0\r
    );\r
\r
    let near = cameraUniforms.nearPlane;\r
    let far = cameraUniforms.farPlane;\r
    let nearDepth = near * pow(far / near, f32(clusterZ) / f32(\${clusterDepth}));\r
    let farDepth = near * pow(far / near, f32(clusterZ + 1u) / f32(\${clusterDepth}));\r
\r
    let ray00 = cornerRayDir(vec2f(minNdcXY.x, minNdcXY.y));\r
    let ray10 = cornerRayDir(vec2f(maxNdcXY.x, minNdcXY.y));\r
    let ray01 = cornerRayDir(vec2f(minNdcXY.x, maxNdcXY.y));\r
    let ray11 = cornerRayDir(vec2f(maxNdcXY.x, maxNdcXY.y));\r
\r
    let p00n = -ray00 * nearDepth;\r
    let p10n = -ray10 * nearDepth;\r
    let p01n = -ray01 * nearDepth;\r
    let p11n = -ray11 * nearDepth;\r
\r
    let p00f = -ray00 * farDepth;\r
    let p10f = -ray10 * farDepth;\r
    let p01f = -ray01 * farDepth;\r
    let p11f = -ray11 * farDepth;\r
\r
    let minBounds = min(min(min(p00n, p10n), min(p01n, p11n)), min(min(p00f, p10f), min(p01f, p11f)));\r
    let maxBounds = max(max(max(p00n, p10n), max(p01n, p11n)), max(max(p00f, p10f), max(p01f, p11f)));\r
\r
    clusterSet.clusters[clusterIndex].minBounds = minBounds;\r
    clusterSet.clusters[clusterIndex].maxBounds = maxBounds;\r
    clusterSet.clusters[clusterIndex].lightCount = 0u;\r
\r
    var lightCount = 0u;\r
    for (var lightIdx = 0u; lightIdx < lightSet.numLights; lightIdx++) {\r
        let light = lightSet.lights[lightIdx];\r
        let lightPosView = (cameraUniforms.viewMat * vec4f(light.pos, 1.0)).xyz;\r
\r
        if (sphereAABBIntersection(lightPosView, \${lightRadius}, minBounds, maxBounds)) {\r
            clusterSet.clusters[clusterIndex].lightIndices[lightCount] = lightIdx;\r
            lightCount++;\r
        }\r
\r
        if (lightCount >= \${maxLightsPerCluster}) {\r
            break;\r
        }\r
    }\r
\r
    clusterSet.clusters[clusterIndex].lightCount = lightCount;\r
}\r
`,constants={bindGroup_scene:0,bindGroup_model:1,bindGroup_material:2,moveLightsWorkgroupSize:128,clusterWidth:16,clusterHeight:9,clusterDepth:24,maxLightsPerCluster:1024,clusteringWorkgroupSize:4};function evalShaderRaw(raw){return eval("`"+raw.replaceAll("${","${constants.")+"`")}const commonSrc=evalShaderRaw(commonRaw);function processShaderRaw(t){return commonSrc+evalShaderRaw(t)}const naiveVertSrc=processShaderRaw(naiveVertRaw),naiveFragSrc=processShaderRaw(naiveFragRaw),forwardPlusFragSrc=processShaderRaw(forwardPlusFragRaw),clusteredDeferredFragSrc=processShaderRaw(clusteredDeferredFragRaw),clusteredDeferredFullscreenVertSrc=processShaderRaw(clusteredDeferredFullscreenVertRaw),clusteredDeferredFullscreenFragSrc=processShaderRaw(clusteredDeferredFullscreenFragRaw),moveLightsComputeSrc=processShaderRaw(moveLightsComputeRaw),clusteringComputeSrc=processShaderRaw(clusteringComputeRaw);class NaiveRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"naive pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"naive vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"naive frag shader",code:naiveFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder(),n=context.getCurrentTexture().createView(),r=e.beginRenderPass({label:"naive render pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.pipeline),r.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(s=>{r.setBindGroup(constants.bindGroup_model,s.modelBindGroup)},s=>{r.setBindGroup(constants.bindGroup_material,s.materialBindGroup)},s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.numIndices)}),r.end(),device.queue.submit([e.finish()])}}class ForwardPlusRenderer extends Renderer{sceneUniformsBindGroupLayout;sceneUniformsBindGroup;depthTexture;depthTextureView;pipeline;constructor(e){super(e),this.sceneUniformsBindGroupLayout=device.createBindGroupLayout({label:"forward+ scene uniforms bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}}]}),this.sceneUniformsBindGroup=device.createBindGroup({label:"forward+ scene uniforms bind group",layout:this.sceneUniformsBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}},{binding:2,resource:{buffer:this.lights.clusterBuffer}}]}),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT,label:"forward+ depth texture"}),this.depthTextureView=this.depthTexture.createView(),this.pipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"forward+ pipeline layout",bindGroupLayouts:[this.sceneUniformsBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"forward+ vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"forward+ frag shader",code:forwardPlusFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder();this.lights.doLightClustering(e);const n=context.getCurrentTexture().createView(),r=e.beginRenderPass({label:"forward+ render pass",colorAttachments:[{view:n,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});r.setPipeline(this.pipeline),r.setBindGroup(constants.bindGroup_scene,this.sceneUniformsBindGroup),this.scene.iterate(s=>{r.setBindGroup(constants.bindGroup_model,s.modelBindGroup)},s=>{r.setBindGroup(constants.bindGroup_material,s.materialBindGroup)},s=>{r.setVertexBuffer(0,s.vertexBuffer),r.setIndexBuffer(s.indexBuffer,"uint32"),r.drawIndexed(s.numIndices)}),r.end(),device.queue.submit([e.finish()])}}class ClusteredDeferredRenderer extends Renderer{gBufferBindGroupLayout;gBufferBindGroup;gBufferPositionTexture;gBufferPositionTextureView;gBufferNormalTexture;gBufferNormalTextureView;gBufferAlbedoTexture;gBufferAlbedoTextureView;depthTexture;depthTextureView;gBufferPipeline;fullscreenPipeline;fullscreenBindGroupLayout;fullscreenBindGroup;constructor(e){super(e),this.gBufferPositionTexture=device.createTexture({size:[canvas.width,canvas.height],format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,label:"g-buffer position texture"}),this.gBufferPositionTextureView=this.gBufferPositionTexture.createView(),this.gBufferNormalTexture=device.createTexture({size:[canvas.width,canvas.height],format:"rgba16float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,label:"g-buffer normal texture"}),this.gBufferNormalTextureView=this.gBufferNormalTexture.createView(),this.gBufferAlbedoTexture=device.createTexture({size:[canvas.width,canvas.height],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING,label:"g-buffer albedo texture"}),this.gBufferAlbedoTextureView=this.gBufferAlbedoTexture.createView(),this.depthTexture=device.createTexture({size:[canvas.width,canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT,label:"clustered deferred depth texture"}),this.depthTextureView=this.depthTexture.createView(),this.gBufferBindGroupLayout=device.createBindGroupLayout({label:"g-buffer bind group layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX,buffer:{type:"uniform"}}]}),this.gBufferBindGroup=device.createBindGroup({label:"g-buffer bind group",layout:this.gBufferBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}}]}),this.gBufferPipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"g-buffer pipeline layout",bindGroupLayouts:[this.gBufferBindGroupLayout,modelBindGroupLayout,materialBindGroupLayout]}),depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"},vertex:{module:device.createShaderModule({label:"g-buffer vert shader",code:naiveVertSrc}),buffers:[vertexBufferLayout]},fragment:{module:device.createShaderModule({label:"g-buffer frag shader",code:clusteredDeferredFragSrc}),targets:[{format:"rgba16float"},{format:"rgba16float"},{format:"rgba8unorm"}]}}),this.fullscreenBindGroupLayout=device.createBindGroupLayout({label:"fullscreen bind group layout",entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:4,visibility:GPUShaderStage.FRAGMENT,texture:{}},{binding:5,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.fullscreenBindGroup=device.createBindGroup({label:"fullscreen bind group",layout:this.fullscreenBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lights.lightSetStorageBuffer}},{binding:2,resource:{buffer:this.lights.clusterBuffer}},{binding:3,resource:this.gBufferPositionTextureView},{binding:4,resource:this.gBufferNormalTextureView},{binding:5,resource:this.gBufferAlbedoTextureView}]}),this.fullscreenPipeline=device.createRenderPipeline({layout:device.createPipelineLayout({label:"fullscreen pipeline layout",bindGroupLayouts:[this.fullscreenBindGroupLayout]}),vertex:{module:device.createShaderModule({label:"fullscreen vert shader",code:clusteredDeferredFullscreenVertSrc})},fragment:{module:device.createShaderModule({label:"fullscreen frag shader",code:clusteredDeferredFullscreenFragSrc}),targets:[{format:canvasFormat}]}})}draw(){const e=device.createCommandEncoder();this.lights.doLightClustering(e);const n=e.beginRenderPass({label:"g-buffer render pass",colorAttachments:[{view:this.gBufferPositionTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:this.gBufferNormalTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"},{view:this.gBufferAlbedoTextureView,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});n.setPipeline(this.gBufferPipeline),n.setBindGroup(constants.bindGroup_scene,this.gBufferBindGroup),this.scene.iterate(o=>{n.setBindGroup(constants.bindGroup_model,o.modelBindGroup)},o=>{n.setBindGroup(constants.bindGroup_material,o.materialBindGroup)},o=>{n.setVertexBuffer(0,o.vertexBuffer),n.setIndexBuffer(o.indexBuffer,"uint32"),n.drawIndexed(o.numIndices)}),n.end();const r=context.getCurrentTexture().createView(),s=e.beginRenderPass({label:"fullscreen render pass",colorAttachments:[{view:r,clearValue:[0,0,0,0],loadOp:"clear",storeOp:"store"}]});s.setPipeline(this.fullscreenPipeline),s.setBindGroup(constants.bindGroup_scene,this.fullscreenBindGroup),s.draw(6,1,0,0),s.end(),device.queue.submit([e.finish()])}}async function parseFromContext(t,e,n,r){return r._parse(t,e,n,r)}function assert$4(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const isBrowser$2=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),matches$1=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches$1&&parseFloat(matches$1[1]);const window_=globalThis,process_=globalThis.process||{};function isElectron(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function isBrowser$1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||isElectron()}const VERSION$6="4.1.0";function getStorage(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class LocalStorage{constructor(e,n,r="sessionStorage"){this.storage=getStorage(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function formatTime(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function leftPad(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var COLOR;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(COLOR||(COLOR={}));const BACKGROUND_INCREMENT=10;function getColor(t){return typeof t!="string"?t:(t=t.toUpperCase(),COLOR[t]||COLOR.WHITE)}function addColor(t,e,n){return!isBrowser$1&&typeof t=="string"&&(e&&(t=`\x1B[${getColor(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${getColor(n)+BACKGROUND_INCREMENT}m${t}\x1B[49m`)),t}function autobind(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),s=t;for(const o of r){const c=s[o];typeof c=="function"&&(e.find(d=>o===d)||(s[o]=c.bind(t)))}}function assert$3(t,e){if(!t)throw new Error("Assertion failed")}function getHiResTimestamp(){let t;if(isBrowser$1()&&window_.performance)t=window_?.performance?.now?.();else if("hrtime"in process_){const e=process_?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}const originalConsole={debug:isBrowser$1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},DEFAULT_LOG_CONFIGURATION={enabled:!0,level:0};function noop(){}const cache$6={},ONCE={once:!0};class Log{constructor({id:e}={id:""}){this.VERSION=VERSION$6,this._startTs=getHiResTimestamp(),this._deltaTs=getHiResTimestamp(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new LocalStorage(`__probe-${this.id}__`,DEFAULT_LOG_CONFIGURATION),this.timeStamp(`${this.id} started`),autobind(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((getHiResTimestamp()-this._startTs).toPrecision(10))}getDelta(){return Number((getHiResTimestamp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,originalConsole.warn,arguments,ONCE)}error(e){return this._getLogFunction(0,e,originalConsole.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,originalConsole.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,originalConsole.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,originalConsole.debug||originalConsole.info,arguments,ONCE)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||noop,r&&[r],{tag:getTableHeader(n)}):noop}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||noop)}group(e,n,r={collapsed:!1}){const s=normalizeArguments({logLevel:e,message:n,opts:r}),{collapsed:o}=r;return s.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||noop)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=normalizeLogLevel(e)}_getLogFunction(e,n,r,s,o){if(this._shouldLog(e)){o=normalizeArguments({logLevel:e,message:n,args:s,opts:o}),r=r||o.method,assert$3(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=getHiResTimestamp();const c=o.tag||o.message;if(o.once&&c)if(!cache$6[c])cache$6[c]=getHiResTimestamp();else return noop;return n=decorateMessage(this.id,o.message,o),r.bind(console,n,...o.args)}return noop}}Log.VERSION=VERSION$6;function normalizeLogLevel(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return assert$3(Number.isFinite(e)&&e>=0),e}function normalizeArguments(t){const{logLevel:e,message:n}=t;t.logLevel=normalizeLogLevel(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const s=typeof t.message;return assert$3(s==="string"||s==="object"),Object.assign(t,{args:r},t.opts)}function decorateMessage(t,e,n){if(typeof e=="string"){const r=n.time?leftPad(formatTime(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=addColor(e,n.color,n.background)}return e}function getTableHeader(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const VERSION$5="4.3.3",version=VERSION$5[0]>="0"&&VERSION$5[0]<="9"?`v${VERSION$5}`:"";function createLog(){const t=new Log({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=version,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const log=createLog();function mergeLoaderOptions(t,e){return mergeOptionsRecursively(t||{},e)}function mergeOptionsRecursively(t,e,n=0){if(n>3)return e;const r={...t};for(const[s,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?r[s]=mergeOptionsRecursively(r[s]||{},e[s],n+1):r[s]=e[s];return r}function registerJSModules(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function getJSModuleOrNull(t){return globalThis.loaders?.modules?.[t]||null}const NPM_TAG="latest";function getVersion(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const VERSION$4=getVersion();function assert$2(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const isBrowser=typeof process!="object"||String(process)!=="[object process]"||process.browser,isWorker=typeof importScripts=="function",isMobile=typeof window<"u"&&typeof window.orientation<"u",matches=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);class WorkerJob{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,n){this.name=e,this.workerThread=n,this.result=new Promise((r,s)=>{this._resolve=r,this._reject=s})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){assert$2(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){assert$2(this.isRunning),this.isRunning=!1,this._reject(e)}}class NodeWorker{terminate(){}}const workerURLCache=new Map;function getLoadableWorkerURL(t){assert$2(t.source&&!t.url||!t.source&&t.url);let e=workerURLCache.get(t.source||t.url);return e||(t.url&&(e=getLoadableWorkerURLFromURL(t.url),workerURLCache.set(t.url,e)),t.source&&(e=getLoadableWorkerURLFromSource(t.source),workerURLCache.set(t.source,e))),assert$2(e),e}function getLoadableWorkerURLFromURL(t){if(!t.startsWith("http"))return t;const e=buildScriptSource(t);return getLoadableWorkerURLFromSource(e)}function getLoadableWorkerURLFromSource(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function buildScriptSource(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function getTransferList(t,e=!0,n){const r=n||new Set;if(t){if(isTransferable(t))r.add(t);else if(isTransferable(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const s in t)getTransferList(t[s],e,r)}}return n===void 0?Array.from(r):[]}function isTransferable(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const NOOP=()=>{};class WorkerThread{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&isBrowser||typeof NodeWorker<"u"&&!isBrowser}constructor(e){const{name:n,source:r,url:s}=e;assert$2(r||s),this.name=n,this.source=r,this.url=s,this.onMessage=NOOP,this.onError=o=>console.log(o),this.worker=isBrowser?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=NOOP,this.onError=NOOP,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||getTransferList(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=getLoadableWorkerURL({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new NodeWorker(r,{eval:!1})}else if(this.source)e=new NodeWorker(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class WorkerPool{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return WorkerThread.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(s,o,c)=>s.done(c),r=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new WorkerJob(n.name,e);e.onMessage=s=>n.onMessage(r,s.type,s.payload),e.onError=s=>n.onError(r,s),n.onStart(r);try{await r.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!isBrowser||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new WorkerThread({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return isMobile?this.maxMobileConcurrency:this.maxConcurrency}}const DEFAULT_PROPS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class WorkerFarm{props;workerPools=new Map;static _workerFarm;static isSupported(){return WorkerThread.isSupported()}static getWorkerFarm(e={}){return WorkerFarm._workerFarm=WorkerFarm._workerFarm||new WorkerFarm({}),WorkerFarm._workerFarm.setProps(e),WorkerFarm._workerFarm}constructor(e){this.props={...DEFAULT_PROPS},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:s}=e;let o=this.workerPools.get(n);return o||(o=new WorkerPool({name:n,source:r,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function getWorkerURL(t,e={}){const n=e[t.id]||{},r=isBrowser?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let s=n.workerUrl;if(!s&&t.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(isBrowser?s=`modules/${t.module}/dist/${r}`:s=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!s){let o=t.version;o==="latest"&&(o=NPM_TAG);const c=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${t.module}${c}/dist/${r}`}return assert$2(s),s}function validateWorkerVersion(t,e=VERSION$4){assert$2(t,"no worker provided");const n=t.version;return!(!e||!n)}const loadLibraryPromises={};async function loadLibrary(t,e=null,n={},r=null){return e&&(t=getLibraryUrl(t,e,n,r)),loadLibraryPromises[t]=loadLibraryPromises[t]||loadLibraryFromFile(t),await loadLibraryPromises[t]}function getLibraryUrl(t,e,n={},r=null){if(!n.useLocalLibraries&&t.startsWith("http"))return t;r=r||t;const s=n.modules||{};return s[r]?s[r]:isBrowser?n.CDN?(assert$2(n.CDN.startsWith("http")),`${n.CDN}/${e}@${VERSION$4}/dist/libs/${r}`):isWorker?`../src/libs/${r}`:`modules/${e}/src/libs/${r}`:`modules/${e}/dist/libs/${r}`}async function loadLibraryFromFile(t){if(t.endsWith("wasm"))return await loadAsArrayBuffer(t);if(!isBrowser)try{const{requireFromFile:n}=globalThis.loaders||{};return await n?.(t)}catch(n){return console.error(n),null}if(isWorker)return importScripts(t);const e=await loadAsText(t);return loadLibraryFromString(e,t)}function loadLibraryFromString(t,e){if(!isBrowser){const{requireFromString:r}=globalThis.loaders||{};return r?.(t,e)}if(isWorker)return eval.call(globalThis,t),null;const n=document.createElement("script");n.id=e;try{n.appendChild(document.createTextNode(t))}catch{n.text=t}return document.body.appendChild(n),null}async function loadAsArrayBuffer(t){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return isBrowser||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function loadAsText(t){const{readFileAsText:e}=globalThis.loaders||{};return isBrowser||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function canParseWithWorker(t,e){return!WorkerFarm.isSupported()||!isBrowser&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function parseWithWorker(t,e,n,r,s){const o=t.id,c=getWorkerURL(t,n),p=WorkerFarm.getWorkerFarm(n).getWorkerPool({name:o,url:c});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const T=await p.startJob("process-on-worker",onMessage.bind(null,s));return T.postMessage("process",{input:e,options:n,context:r}),await(await T.result).result}async function onMessage(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:s,input:o,options:c}=r;try{const d=await t(o,c);e.postMessage("done",{id:s,result:d})}catch(d){const p=d instanceof Error?d.message:"unknown error";e.postMessage("error",{id:s,error:p})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function getFirstCharacters$1(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?getMagicString$2(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?getMagicString$2(t,0,e):""}function getMagicString$2(t,e,n){if(t.byteLength<=e+n)return"";const r=new DataView(t);let s="";for(let o=0;o<n;o++)s+=String.fromCharCode(r.getUint8(e+o));return s}function parseJSON(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${getFirstCharacters$1(t)}"`)}}function compareArrayBuffers(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),s=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0}function concatenateArrayBuffers(...t){return concatenateArrayBuffersFromArray(t)}function concatenateArrayBuffersFromArray(t){const e=t.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),n=e.reduce((o,c)=>o+c.byteLength,0),r=new Uint8Array(n);let s=0;for(const o of e)r.set(o,s),s+=o.byteLength;return r.buffer}function sliceArrayBuffer(t,e,n){const r=n!==void 0?new Uint8Array(t).subarray(e,e+n):new Uint8Array(t).subarray(e);return new Uint8Array(r).buffer}function padToNBytes(t,e){return assert$4(t>=0),assert$4(e>0),t+(e-1)&-4}function copyToArray(t,e,n){let r;if(t instanceof ArrayBuffer)r=new Uint8Array(t);else{const s=t.byteOffset,o=t.byteLength;r=new Uint8Array(t.buffer||t.arrayBuffer,s,o)}return e.set(r,n),n+padToNBytes(r.byteLength,4)}async function concatenateArrayBuffersAsync(t){const e=[];for await(const n of t)e.push(n);return concatenateArrayBuffers(...e)}let pathPrefix="";const fileAliases={};function resolvePath(t){for(const e in fileAliases)if(t.startsWith(e)){const n=fileAliases[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${pathPrefix}${t}`),t}function toArrayBuffer$1(t){return t}function isBuffer$1(t){return t&&typeof t=="object"&&t.isBuffer}function toArrayBuffer(t){if(isBuffer$1(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function filename(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function dirname(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const isBoolean=t=>typeof t=="boolean",isFunction=t=>typeof t=="function",isObject=t=>t!==null&&typeof t=="object",isPureObject=t=>isObject(t)&&t.constructor==={}.constructor,isIterable=t=>!!t&&typeof t[Symbol.iterator]=="function",isAsyncIterable=t=>t&&typeof t[Symbol.asyncIterator]=="function",isResponse=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,isBlob=t=>typeof Blob<"u"&&t instanceof Blob,isBuffer=t=>t&&typeof t=="object"&&t.isBuffer,isReadableDOMStream=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||isObject(t)&&isFunction(t.tee)&&isFunction(t.cancel)&&isFunction(t.getReader),isReadableNodeStream=t=>isObject(t)&&isFunction(t.read)&&isFunction(t.pipe)&&isBoolean(t.readable),isReadableStream=t=>isReadableDOMStream(t)||isReadableNodeStream(t);class FetchError extends Error{constructor(e,n){super(e),this.reason=n.reason,this.url=n.url,this.response=n.response}reason;url;response}const DATA_URL_PATTERN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MIME_TYPE_PATTERN=/^([-\w.]+\/[-\w.+]+)/;function compareMIMETypes(t,e){return t.toLowerCase()===e.toLowerCase()}function parseMIMEType(t){const e=MIME_TYPE_PATTERN.exec(t);return e?e[1]:t}function parseMIMETypeFromURL(t){const e=DATA_URL_PATTERN.exec(t);return e?e[1]:""}const QUERY_STRING_PATTERN=/\?.*/;function extractQueryString(t){const e=t.match(QUERY_STRING_PATTERN);return e&&e[0]}function stripQueryString(t){return t.replace(QUERY_STRING_PATTERN,"")}function shortenUrlForDisplay(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function getResourceUrl(t){return isResponse(t)?t.url:isBlob(t)?t.name||"":typeof t=="string"?t:""}function getResourceMIMEType(t){if(isResponse(t)){const e=t,n=e.headers.get("content-type")||"",r=stripQueryString(e.url);return parseMIMEType(n)||parseMIMETypeFromURL(r)}return isBlob(t)?t.type||"":typeof t=="string"?parseMIMETypeFromURL(t):""}function getResourceContentLength(t){return isResponse(t)?t.headers["content-length"]||-1:isBlob(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function makeResponse(t){if(isResponse(t))return t;const e={},n=getResourceContentLength(t);n>=0&&(e["content-length"]=String(n));const r=getResourceUrl(t),s=getResourceMIMEType(t);s&&(e["content-type"]=s);const o=await getInitialDataUrl(t);o&&(e["x-first-bytes"]=o),typeof t=="string"&&(t=new TextEncoder().encode(t));const c=new Response(t,{headers:e});return Object.defineProperty(c,"url",{value:r}),c}async function checkResponse(t){if(!t.ok)throw await getResponseError(t)}async function getResponseError(t){const e=shortenUrlForDisplay(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const s=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&s?.includes("application/json")?await t.json():await t.text()}catch{}return new FetchError(n,r)}async function getInitialDataUrl(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const s=new FileReader;s.onload=o=>r(o?.target?.result),s.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${arrayBufferToBase64(n)}`}return null}function arrayBufferToBase64(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function isNodePath(t){return!isRequestURL(t)&&!isDataURL(t)}function isRequestURL(t){return t.startsWith("http:")||t.startsWith("https:")}function isDataURL(t){return t.startsWith("data:")}async function fetchFile(t,e){if(typeof t=="string"){const n=resolvePath(t);return isNodePath(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,e):await fetch(n,e)}return await makeResponse(t)}const probeLog=new Log({id:"loaders.gl"});class NullLog{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ConsoleLog{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const DEFAULT_LOADER_OPTIONS={fetch:null,mimeType:void 0,nothrow:!1,log:new ConsoleLog,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:isBrowser$2,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},REMOVED_LOADER_OPTIONS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function getGlobalLoaderState(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function getGlobalLoaderOptions(){const t=getGlobalLoaderState();return t.globalOptions=t.globalOptions||{...DEFAULT_LOADER_OPTIONS},t.globalOptions}function normalizeOptions(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],validateOptions(t,n),normalizeOptionsInternal(e,t,r)}function validateOptions(t,e){validateOptionsObject(t,null,DEFAULT_LOADER_OPTIONS,REMOVED_LOADER_OPTIONS,e);for(const n of e){const r=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};validateOptionsObject(r,n.id,s,o,e)}}function validateOptionsObject(t,e,n,r,s){const o=e||"Top level",c=e?`${e}.`:"";for(const d in t){const p=!e&&isObject(t[d]),T=d==="baseUri"&&!e,I=d==="workerUrl"&&e;if(!(d in n)&&!T&&!I){if(d in r)probeLog.warn(`${o} loader option '${c}${d}' no longer supported, use '${r[d]}'`)();else if(!p){const D=findSimilarOption(d,s);probeLog.warn(`${o} loader option '${c}${d}' not recognized. ${D}`)()}}}}function findSimilarOption(t,e){const n=t.toLowerCase();let r="";for(const s of e)for(const o in s.options){if(t===o)return`Did you mean '${s.id}.${o}'?`;const c=o.toLowerCase();(n.startsWith(c)||c.startsWith(n))&&(r=r||`Did you mean '${s.id}.${o}'?`)}return r}function normalizeOptionsInternal(t,e,n){const s={...t.options||{}};return addUrlOptions(s,n),s.log===null&&(s.log=new NullLog),mergeNestedFields(s,getGlobalLoaderOptions()),mergeNestedFields(s,e),s}function mergeNestedFields(t,e){for(const n in e)if(n in e){const r=e[n];isPureObject(r)&&isPureObject(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function addUrlOptions(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function isLoaderObject(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function normalizeLoader(t){assert$4(t,"null loader"),assert$4(isLoaderObject(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const getGlobalLoaderRegistry=()=>{const t=getGlobalLoaderState();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function registerLoaders(t){const e=getGlobalLoaderRegistry();t=Array.isArray(t)?t:[t];for(const n of t){const r=normalizeLoader(n);e.find(s=>r===s)||e.unshift(r)}}function getRegisteredLoaders(){return getGlobalLoaderRegistry()}const EXT_PATTERN=/\.([^.]+)$/;async function selectLoader(t,e=[],n,r){if(!validHTTPResponse(t))return null;let s=selectLoaderSync(t,e,{...n,nothrow:!0},r);if(s)return s;if(isBlob(t)&&(t=await t.slice(0,10).arrayBuffer(),s=selectLoaderSync(t,e,n,r)),!s&&!n?.nothrow)throw new Error(getNoValidLoaderMessage(t));return s}function selectLoaderSync(t,e=[],n,r){if(!validHTTPResponse(t))return null;if(e&&!Array.isArray(e))return normalizeLoader(e);let s=[];e&&(s=s.concat(e)),n?.ignoreRegisteredLoaders||s.push(...getRegisteredLoaders()),normalizeLoaders(s);const o=selectLoaderInternal(t,s,n,r);if(!o&&!n?.nothrow)throw new Error(getNoValidLoaderMessage(t));return o}function selectLoaderInternal(t,e,n,r){const s=getResourceUrl(t),o=getResourceMIMEType(t),c=stripQueryString(s)||r?.url;let d=null,p="";return n?.mimeType&&(d=findLoaderByMIMEType(e,n?.mimeType),p=`match forced by supplied MIME type ${n?.mimeType}`),d=d||findLoaderByUrl(e,c),p=p||(d?`matched url ${c}`:""),d=d||findLoaderByMIMEType(e,o),p=p||(d?`matched MIME type ${o}`:""),d=d||findLoaderByInitialBytes(e,t),p=p||(d?`matched initial data ${getFirstCharacters(t)}`:""),n?.fallbackMimeType&&(d=d||findLoaderByMIMEType(e,n?.fallbackMimeType),p=p||(d?`matched fallback MIME type ${o}`:"")),p&&log.log(1,`selectLoader selected ${d?.name}: ${p}.`),d}function validHTTPResponse(t){return!(t instanceof Response&&t.status===204)}function getNoValidLoaderMessage(t){const e=getResourceUrl(t),n=getResourceMIMEType(t);let r="No valid loader found (";r+=e?`${filename(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const s=t?getFirstCharacters(t):"";return r+=s?` first bytes: "${s}"`:"first bytes: not available",r+=")",r}function normalizeLoaders(t){for(const e of t)normalizeLoader(e)}function findLoaderByUrl(t,e){const n=e&&EXT_PATTERN.exec(e),r=n&&n[1];return r?findLoaderByExtension(t,r):null}function findLoaderByExtension(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function findLoaderByMIMEType(t,e){for(const n of t)if(n.mimeTypes?.some(r=>compareMIMETypes(e,r))||compareMIMETypes(e,`application/x.${n.id}`))return n;return null}function findLoaderByInitialBytes(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(testDataAgainstText(e,n))return n}else if(ArrayBuffer.isView(e)){if(testDataAgainstBinary(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&testDataAgainstBinary(e,0,n))return n;return null}function testDataAgainstText(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function testDataAgainstBinary(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(s=>testBinary(t,e,n,s))}function testBinary(t,e,n,r){if(r instanceof ArrayBuffer)return compareArrayBuffers(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const s=getMagicString$1(t,e,r.length);return r===s;default:return!1}}function getFirstCharacters(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?getMagicString$1(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?getMagicString$1(t,0,e):""}function getMagicString$1(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let s="";for(let o=0;o<n;o++)s+=String.fromCharCode(r.getUint8(e+o));return s}const DEFAULT_CHUNK_SIZE$2=256*1024;function*makeStringIterator(t,e){const n=e?.chunkSize||DEFAULT_CHUNK_SIZE$2;let r=0;const s=new TextEncoder;for(;r<t.length;){const o=Math.min(t.length-r,n),c=t.slice(r,r+o);r+=o,yield s.encode(c)}}const DEFAULT_CHUNK_SIZE$1=256*1024;function*makeArrayBufferIterator(t,e={}){const{chunkSize:n=DEFAULT_CHUNK_SIZE$1}=e;let r=0;for(;r<t.byteLength;){const s=Math.min(t.byteLength-r,n),o=new ArrayBuffer(s),c=new Uint8Array(t,r,s);new Uint8Array(o).set(c),r+=s,yield o}}const DEFAULT_CHUNK_SIZE=1024*1024;async function*makeBlobIterator(t,e){const n=e?.chunkSize||DEFAULT_CHUNK_SIZE;let r=0;for(;r<t.size;){const s=r+n,o=await t.slice(r,s).arrayBuffer();r=s,yield o}}function makeStreamIterator(t,e){return isBrowser$2?makeBrowserStreamIterator(t,e):makeNodeStreamIterator(t)}async function*makeBrowserStreamIterator(t,e){const n=t.getReader();let r;try{for(;;){const s=r||n.read();e?._streamReadAhead&&(r=n.read());const{done:o,value:c}=await s;if(o)return;yield toArrayBuffer(c)}}catch{n.releaseLock()}}async function*makeNodeStreamIterator(t,e){for await(const n of t)yield toArrayBuffer(n)}function makeIterator(t,e){if(typeof t=="string")return makeStringIterator(t,e);if(t instanceof ArrayBuffer)return makeArrayBufferIterator(t,e);if(isBlob(t))return makeBlobIterator(t,e);if(isReadableStream(t))return makeStreamIterator(t,e);if(isResponse(t))return makeStreamIterator(t.body,e);throw new Error("makeIterator")}const ERR_DATA="Cannot convert supplied data type";function getArrayBufferOrStringFromDataSync(t,e,n){if(e.text&&typeof t=="string")return t;if(isBuffer(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const s=t.byteLength||t.length;return(t.byteOffset!==0||s!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+s)),r}throw new Error(ERR_DATA)}async function getArrayBufferOrStringFromData(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return getArrayBufferOrStringFromDataSync(t,e);if(isBlob(t)&&(t=await makeResponse(t)),isResponse(t)){const s=t;return await checkResponse(s),e.binary?await s.arrayBuffer():await s.text()}if(isReadableStream(t)&&(t=makeIterator(t,n)),isIterable(t)||isAsyncIterable(t))return concatenateArrayBuffersAsync(t);throw new Error(ERR_DATA)}function getFetchFunction(t,e){const n=getGlobalLoaderOptions(),r=t||n;return typeof r.fetch=="function"?r.fetch:isObject(r.fetch)?s=>fetchFile(s,r.fetch):e?.fetch?e?.fetch:fetchFile}function getLoaderContext(t,e,n){if(n)return n;const r={fetch:getFetchFunction(e,t),...t};if(r.url){const s=stripQueryString(r.url);r.baseUrl=s,r.queryString=extractQueryString(r.url),r.filename=filename(s),r.baseUrl=dirname(s)}return Array.isArray(r.loaders)||(r.loaders=null),r}function getLoadersFromContext(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function parse$2(t,e,n,r){e&&!Array.isArray(e)&&!isLoaderObject(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const s=getResourceUrl(t),c=getLoadersFromContext(e,r),d=await selectLoader(t,c,n);return d?(n=normalizeOptions(n,d,c,s),r=getLoaderContext({url:s,_parse:parse$2,loaders:c},n,r||null),await parseWithLoader(d,t,n,r)):null}async function parseWithLoader(t,e,n,r){if(validateWorkerVersion(t),n=mergeLoaderOptions(t.options,n),isResponse(e)){const o=e,{ok:c,redirected:d,status:p,statusText:T,type:I,url:D}=o,x=Object.fromEntries(o.headers.entries());r.response={headers:x,ok:c,redirected:d,status:p,statusText:T,type:I,url:D}}e=await getArrayBufferOrStringFromData(e,t,n);const s=t;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,n,r);if(canParseWithWorker(t,n))return await parseWithWorker(t,e,n,r,parse$2);if(s.parseText&&typeof e=="string")return await s.parseText(e,n,r);if(s.parse)return await s.parse(e,n,r);throw assert$2(!s.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function getDataTypeFromTypedArray(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function getMeshBoundingBox(t){let e=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,c=-1/0;const d=t.POSITION?t.POSITION.value:[],p=d&&d.length;for(let T=0;T<p;T+=3){const I=d[T],D=d[T+1],x=d[T+2];e=I<e?I:e,n=D<n?D:n,r=x<r?x:r,s=I>s?I:s,o=D>o?D:o,c=x>c?x:c}return[[e,n,r],[s,o,c]]}function deduceMeshField(t,e,n){const r=getDataTypeFromTypedArray(e.value),s=n||makeMeshAttributeMetadata(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:r}]},nullable:!1,metadata:s}}function makeMeshAttributeMetadata(t){const e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function load(t,e,n,r){let s,o;!Array.isArray(e)&&!isLoaderObject(e)?(s=[],o=e):(s=e,o=n);const c=getFetchFunction(o);let d=t;return typeof t=="string"&&(d=await c(t)),isBlob(t)&&(d=await c(t)),Array.isArray(s)?await parse$2(d,s,o):await parse$2(d,s,o)}const VERSION$3="4.3.3",parseImageNode=globalThis.loaders?.parseImageNode,IMAGE_SUPPORTED=typeof Image<"u",IMAGE_BITMAP_SUPPORTED=typeof ImageBitmap<"u",NODE_IMAGE_SUPPORTED=!!parseImageNode,DATA_SUPPORTED=isBrowser$2?!0:NODE_IMAGE_SUPPORTED;function isImageTypeSupported(t){switch(t){case"auto":return IMAGE_BITMAP_SUPPORTED||IMAGE_SUPPORTED||DATA_SUPPORTED;case"imagebitmap":return IMAGE_BITMAP_SUPPORTED;case"image":return IMAGE_SUPPORTED;case"data":return DATA_SUPPORTED;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function getDefaultImageType(){if(IMAGE_BITMAP_SUPPORTED)return"imagebitmap";if(IMAGE_SUPPORTED)return"image";if(DATA_SUPPORTED)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function getImageType(t){const e=getImageTypeOrNull(t);if(!e)throw new Error("Not an image");return e}function getImageData(t){switch(getImageType(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function getImageTypeOrNull(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const SVG_DATA_URL_PATTERN=/^data:image\/svg\+xml/,SVG_URL_PATTERN=/\.svg((\?|#).*)?$/;function isSVG(t){return t&&(SVG_DATA_URL_PATTERN.test(t)||SVG_URL_PATTERN.test(t))}function getBlobOrSVGDataUrl(t,e){if(isSVG(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return getBlob(t,e)}function getBlob(t,e){if(isSVG(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function parseToImage(t,e,n){const r=getBlobOrSVGDataUrl(t,n),s=self.URL||self.webkitURL,o=typeof r!="string"&&s.createObjectURL(r);try{return await loadToImage(o||r,e)}finally{o&&s.revokeObjectURL(o)}}async function loadToImage(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,s)=>{try{n.onload=()=>r(n),n.onerror=o=>{const c=o instanceof Error?o.message:"error";s(new Error(c))}}catch(o){s(o)}})}const EMPTY_OBJECT={};let imagebitmapOptionsSupported=!0;async function parseToImageBitmap(t,e,n){let r;isSVG(n)?r=await parseToImage(t,e,n):r=getBlob(t,n);const s=e&&e.imagebitmap;return await safeCreateImageBitmap(r,s)}async function safeCreateImageBitmap(t,e=null){if((isEmptyObject(e)||!imagebitmapOptionsSupported)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),imagebitmapOptionsSupported=!1}return await createImageBitmap(t)}function isEmptyObject(t){for(const e in t||EMPTY_OBJECT)return!1;return!0}function getISOBMFFMediaType(t){return!checkString(t,"ftyp",4)||(t[8]&96)===0?null:decodeMajorBrand(t)}function decodeMajorBrand(t){switch(getUTF8String(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function getUTF8String(t,e,n){return String.fromCharCode(...t.slice(e,n))}function stringToBytes(t){return[...t].map(e=>e.charCodeAt(0))}function checkString(t,e,n=0){const r=stringToBytes(e);for(let s=0;s<r.length;++s)if(r[s]!==t[s+n])return!1;return!0}const BIG_ENDIAN=!1,LITTLE_ENDIAN$1=!0;function getBinaryImageMetadata(t){const e=toDataView(t);return getPngMetadata(e)||getJpegMetadata(e)||getGifMetadata(e)||getBmpMetadata(e)||getISOBMFFMetadata(e)}function getISOBMFFMetadata(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=getISOBMFFMediaType(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function getPngMetadata(t){const e=toDataView(t);return e.byteLength>=24&&e.getUint32(0,BIG_ENDIAN)===2303741511?{mimeType:"image/png",width:e.getUint32(16,BIG_ENDIAN),height:e.getUint32(20,BIG_ENDIAN)}:null}function getGifMetadata(t){const e=toDataView(t);return e.byteLength>=10&&e.getUint32(0,BIG_ENDIAN)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,LITTLE_ENDIAN$1),height:e.getUint16(8,LITTLE_ENDIAN$1)}:null}function getBmpMetadata(t){const e=toDataView(t);return e.byteLength>=14&&e.getUint16(0,BIG_ENDIAN)===16973&&e.getUint32(2,LITTLE_ENDIAN$1)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,LITTLE_ENDIAN$1),height:e.getUint32(22,LITTLE_ENDIAN$1)}:null}function getJpegMetadata(t){const e=toDataView(t);if(!(e.byteLength>=3&&e.getUint16(0,BIG_ENDIAN)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:s}=getJpegMarkers();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,BIG_ENDIAN);if(s.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,BIG_ENDIAN),width:e.getUint16(o+7,BIG_ENDIAN)};if(!r.has(c))return null;o+=2,o+=e.getUint16(o,BIG_ENDIAN)}return null}function getJpegMarkers(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function toDataView(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function parseToNodeImage(t,e){const{mimeType:n}=getBinaryImageMetadata(t)||{},r=globalThis.loaders?.parseImageNode;return assert$4(r),await r(t,n)}async function parseImage(t,e,n){e=e||{};const s=(e.image||{}).type||"auto",{url:o}=n||{},c=getLoadableImageType(s);let d;switch(c){case"imagebitmap":d=await parseToImageBitmap(t,e,o);break;case"image":d=await parseToImage(t,e,o);break;case"data":d=await parseToNodeImage(t);break;default:assert$4(!1)}return s==="data"&&(d=getImageData(d)),d}function getLoadableImageType(t){switch(t){case"auto":case"data":return getDefaultImageType();default:return isImageTypeSupported(t),t}}const EXTENSIONS$1=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],MIME_TYPES=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DEFAULT_IMAGE_LOADER_OPTIONS={image:{type:"auto",decode:!0}},ImageLoader={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:VERSION$3,mimeTypes:MIME_TYPES,extensions:EXTENSIONS$1,parse:parseImage,tests:[t=>!!getBinaryImageMetadata(new DataView(t))],options:DEFAULT_IMAGE_LOADER_OPTIONS},mimeTypeSupportedSync={};function isImageFormatSupported(t){if(mimeTypeSupportedSync[t]===void 0){const e=isBrowser$2?checkBrowserImageFormatSupport(t):checkNodeImageFormatSupport(t);mimeTypeSupportedSync[t]=e}return mimeTypeSupportedSync[t]}function checkNodeImageFormatSupport(t){const e=["image/png","image/jpeg","image/gif"],n=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&n.includes(t)}function checkBrowserImageFormatSupport(t){switch(t){case"image/avif":case"image/webp":return testBrowserImageFormatSupport(t);default:return!0}}function testBrowserImageFormatSupport(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}function assert$1(t,e){if(!t)throw new Error(e||"assert failed: gltf")}const COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},BYTES={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},TYPES=["SCALAR","VEC2","VEC3","VEC4"],ARRAY_CONSTRUCTOR_TO_WEBGL_CONSTANT=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ARRAY_TO_COMPONENT_TYPE=new Map(ARRAY_CONSTRUCTOR_TO_WEBGL_CONSTANT),ATTRIBUTE_TYPE_TO_COMPONENTS$1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE$1={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY$1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function getAccessorTypeFromSize(t){return TYPES[t-1]||TYPES[0]}function getComponentTypeFromArray(t){const e=ARRAY_TO_COMPONENT_TYPE.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function getAccessorArrayTypeAndLength(t,e){const n=ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY$1[t.componentType],r=ATTRIBUTE_TYPE_TO_COMPONENTS$1[t.type],s=ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE$1[t.componentType],o=t.count*r,c=t.count*r*s;assert$1(c>=0&&c<=e.byteLength);const d=BYTES[t.componentType],p=COMPONENTS[t.type];return{ArrayType:n,length:o,byteLength:c,componentByteSize:d,numberOfComponentsInElement:p}}function getTypedArrayForBufferView(t,e,n){const r=t.bufferViews[n];assert$1(r);const s=r.buffer,o=e[s];assert$1(o);const c=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,c,r.byteLength)}function getTypedArrayForAccessor(t,e,n){const r=typeof n=="number"?t.accessors?.[n]:n;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const s=t.bufferViews?.[r.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);const{arrayBuffer:o,byteOffset:c}=e[s.buffer],d=(c||0)+(r.byteOffset||0)+(s.byteOffset||0),{ArrayType:p,length:T,componentByteSize:I,numberOfComponentsInElement:D}=getAccessorArrayTypeAndLength(r,s),x=I*D,G=s.byteStride||x;if(typeof s.byteStride>"u"||s.byteStride===x)return new p(o,d,T);const P=new p(T);for(let U=0;U<r.count;U++){const H=new p(o,d+U*G,D);P.set(H,U*D)}return P}function makeDefaultGLTFJson(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class GLTFScenegraph{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||makeDefaultGLTFJson(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.getRequiredExtensions().find(s=>s===e);return typeof n=="string"||typeof r=="string"}getExtension(e){const n=this.getUsedExtensions().find(s=>s===e),r=this.json.extensions||{};return n?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,n){return(e.extensions||{})[n]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,n){if(typeof n=="object")return n;const r=this.json[e]&&this.json[e][n];if(!r)throw new Error(`glTF file error: Could not find ${e}[${n}]`);return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const n=e.buffer,r=this.gltf.buffers[n];assert$1(r);const s=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,s,e.byteLength)}getTypedArrayForAccessor(e){const n=this.getAccessor(e);return getTypedArrayForAccessor(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(e){e=this.getAccessor(e);const n=this.getBufferView(e.bufferView),s=this.getBuffer(n.buffer).data,o=n.byteOffset||0;return new Uint8Array(s,o,n.byteLength)}addApplicationData(e,n){return this.json[e]=n,this}addExtraData(e,n){return this.json.extras=this.json.extras||{},this.json.extras[e]=n,this}addObjectExtension(e,n,r){return e.extensions=e.extensions||{},e.extensions[n]=r,this.registerUsedExtension(n),this}setObjectExtension(e,n,r){const s=e.extensions||{};s[n]=r}removeObjectExtension(e,n){const r=e?.extensions||{};if(r[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(n)||s.push(n)}delete r[n]}addExtension(e,n={}){return assert$1(n),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=n,this.registerUsedExtension(e),n}addRequiredExtension(e,n={}){return assert$1(n),this.addExtension(e,n),this.registerRequiredExtension(e),n}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:n}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(e){const{meshIndex:n,matrix:r}=e;this.json.nodes=this.json.nodes||[];const s={mesh:n};return r&&(s.matrix=r),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(e){const{attributes:n,indices:r,material:s,mode:o=4}=e,d={primitives:[{attributes:this._addAttributes(n),mode:o}]};if(r){const p=this._addIndices(r);d.primitives[0].indices=p}return Number.isFinite(s)&&(d.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(d),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,n){const r=getBinaryImageMetadata(e),s=n||r?.mimeType,c={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(c),this.json.images.length-1}addBufferView(e,n=0,r=this.byteLength){const s=e.byteLength;assert$1(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const o={buffer:n,byteOffset:r,byteLength:s};return this.byteLength+=padToNBytes(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(o),this.json.bufferViews.length-1}addAccessor(e,n){const r={bufferView:e,type:getAccessorTypeFromSize(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,n={size:3}){const r=this.addBufferView(e);let s={min:n.min,max:n.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(e,n.size));const o={size:n.size,componentType:getComponentTypeFromArray(e),count:Math.round(e.length/n.size),min:s.min,max:s.max};return this.addAccessor(r,Object.assign(o,n))}addTexture(e){const{imageIndex:n}=e,r={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,n=new ArrayBuffer(e),r=new Uint8Array(n);let s=0;for(const o of this.sourceBuffers||[])s=copyToArray(o,r,s);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=n,this.sourceBuffers=[n],this.gltf.buffers=[{arrayBuffer:n,byteOffset:0,byteLength:n.byteLength}]}_removeStringFromArray(e,n){let r=!0;for(;r;){const s=e.indexOf(n);s>-1?e.splice(s,1):r=!1}}_addAttributes(e={}){const n={};for(const r in e){const s=e[r],o=this._getGltfAttributeName(r),c=this.addBinaryBuffer(s.value,s);n[o]=c}return n}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,n){const r={min:null,max:null};if(e.length<n)return r;r.min=[],r.max=[];const s=e.subarray(0,n);for(const o of s)r.min.push(o),r.max.push(o);for(let o=n;o<e.length;o+=n)for(let c=0;c<n;c++)r.min[0+c]=Math.min(r.min[0+c],e[o+c]),r.max[0+c]=Math.max(r.max[0+c],e[o+c]);return r}}function emod(t){return(t%1+1)%1}const ATTRIBUTE_TYPE_TO_COMPONENTS={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function getArrayElementByteSize(t,e){return ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[e]*ATTRIBUTE_TYPE_TO_COMPONENTS[t]}function getOffsetsForProperty(t,e,n,r){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const s=t.getTypedArrayForBufferView(e),o=convertRawBufferToMetadataArray(s,"SCALAR",n,r+1);return o instanceof BigInt64Array||o instanceof BigUint64Array?null:o}function convertRawBufferToMetadataArray(t,e,n,r=1){const s=ATTRIBUTE_TYPE_TO_COMPONENTS[e],o=ATTRIBUTE_COMPONENT_TYPE_TO_ARRAY[n],c=ATTRIBUTE_COMPONENT_TYPE_TO_BYTE_SIZE[n],d=r*s,p=d*c;let T=t.buffer,I=t.byteOffset;return I%c!==0&&(T=new Uint8Array(T).slice(I,I+p).buffer,I=0),new o(T,I,d)}function getPrimitiveTextureData(t,e,n){const r=`TEXCOORD_${e.texCoord||0}`,s=n.attributes[r],o=t.getTypedArrayForAccessor(s),c=t.gltf.json,d=e.index,p=c.textures?.[d]?.source;if(typeof p<"u"){const T=c.images?.[p]?.mimeType,I=t.gltf.images?.[p];if(I&&typeof I.width<"u"){const D=[];for(let x=0;x<o.length;x+=2){const G=getImageValueByCoordinates(I,T,o,x,e.channels);D.push(G)}return D}}return[]}function primitivePropertyDataToAttributes(t,e,n,r,s){if(!n?.length)return;const o=[];for(const I of n){let D=r.findIndex(x=>x===I);D===-1&&(D=r.push(I)-1),o.push(D)}const c=new Uint32Array(o),d=t.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength})-1,p=t.addBufferView(c,d,0),T=t.addAccessor(p,{size:1,componentType:getComponentTypeFromArray(c),count:c.length});s.attributes[e]=T}function getImageValueByCoordinates(t,e,n,r,s=[0]){const o={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},c=n[r],d=n[r+1];let p=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(p=4);const T=coordinatesToOffset(c,d,t,p);let I=0;for(const D of s){const x=typeof D=="number"?Object.values(o)[D]:o[D],G=T+x.offset,P=getImageData(t);if(P.data.length<=G)throw new Error(`${P.data.length} <= ${G}`);const U=P.data[G];I|=U<<x.shift}return I}function coordinatesToOffset(t,e,n,r=1){const s=n.width,o=emod(t)*(s-1),c=Math.round(o),d=n.height,p=emod(e)*(d-1),T=Math.round(p),I=n.components?n.components:r;return(T*s+c)*I}function parseVariableLengthArrayNumeric(t,e,n,r,s){const o=[];for(let c=0;c<e;c++){const d=n[c],p=n[c+1]-n[c];if(p+d>r)break;const T=d/s,I=p/s;o.push(t.slice(T,T+I))}return o}function parseFixedLengthArrayNumeric(t,e,n){const r=[];for(let s=0;s<e;s++){const o=s*n;r.push(t.slice(o,o+n))}return r}function getPropertyDataString(t,e,n,r){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){const s=[],o=new TextDecoder("utf8");let c=0;for(let d=0;d<t;d++){const p=r[d+1]-r[d];if(p+c<=e.length){const T=e.subarray(c,p+c),I=o.decode(T);s.push(I),c+=p}}return s}return[]}const EXT_MESH_FEATURES_NAME="EXT_mesh_features",name$a=EXT_MESH_FEATURES_NAME;async function decode$9(t,e){const n=new GLTFScenegraph(t);decodeExtMeshFeatures(n,e)}function encode$5(t,e){const n=new GLTFScenegraph(t);return encodeExtMeshFeatures(n),n.createBinaryChunk(),n.gltf}function decodeExtMeshFeatures(t,e){const n=t.gltf.json;if(n.meshes)for(const r of n.meshes)for(const s of r.primitives)processMeshPrimitiveFeatures(t,s,e)}function processMeshPrimitiveFeatures(t,e,n){if(!n?.gltf?.loadBuffers)return;const s=e.extensions?.[EXT_MESH_FEATURES_NAME]?.featureIds;if(s)for(const o of s){let c;if(typeof o.attribute<"u"){const d=`_FEATURE_ID_${o.attribute}`,p=e.attributes[d];c=t.getTypedArrayForAccessor(p)}else typeof o.texture<"u"&&n?.gltf?.loadImages?c=getPrimitiveTextureData(t,o.texture,e):c=[];o.data=c}}function encodeExtMeshFeatures(t,e){const n=t.gltf.json.meshes;if(n)for(const r of n)for(const s of r.primitives)encodeExtMeshFeaturesForPrimitive(t,s)}function createExtMeshFeatures(t,e,n,r){e.extensions||(e.extensions={});let s=e.extensions[EXT_MESH_FEATURES_NAME];s||(s={featureIds:[]},e.extensions[EXT_MESH_FEATURES_NAME]=s);const{featureIds:o}=s,c={featureCount:n.length,propertyTable:r,data:n};o.push(c),t.addObjectExtension(e,EXT_MESH_FEATURES_NAME,s)}function encodeExtMeshFeaturesForPrimitive(t,e){const n=e.extensions?.[EXT_MESH_FEATURES_NAME];if(!n)return;const r=n.featureIds;r.forEach((s,o)=>{if(s.data){const{accessorKey:c,index:d}=createAccessorKey(e.attributes),p=new Uint32Array(s.data);r[o]={featureCount:p.length,propertyTable:s.propertyTable,attribute:d},t.gltf.buffers.push({arrayBuffer:p.buffer,byteOffset:p.byteOffset,byteLength:p.byteLength});const T=t.addBufferView(p),I=t.addAccessor(T,{size:1,componentType:getComponentTypeFromArray(p),count:p.length});e.attributes[c]=I}})}function createAccessorKey(t){const e="_FEATURE_ID_",n=Object.keys(t).filter(o=>o.indexOf(e)===0);let r=-1;for(const o of n){const c=Number(o.substring(e.length));c>r&&(r=c)}return r++,{accessorKey:`${e}${r}`,index:r}}const EXT_mesh_features=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures,decode:decode$9,encode:encode$5,name:name$a},Symbol.toStringTag,{value:"Module"})),EXT_STRUCTURAL_METADATA_NAME="EXT_structural_metadata",name$9=EXT_STRUCTURAL_METADATA_NAME;async function decode$8(t,e){const n=new GLTFScenegraph(t);decodeExtStructuralMetadata(n,e)}function encode$4(t,e){const n=new GLTFScenegraph(t);return encodeExtStructuralMetadata(n),n.createBinaryChunk(),n.gltf}function decodeExtStructuralMetadata(t,e){if(!e.gltf?.loadBuffers)return;const n=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);n&&(e.gltf?.loadImages&&decodePropertyTextures$1(t,n),decodePropertyTables$1(t,n))}function decodePropertyTextures$1(t,e){const n=e.propertyTextures,r=t.gltf.json;if(n&&r.meshes)for(const s of r.meshes)for(const o of s.primitives)processPrimitivePropertyTextures(t,n,o,e)}function decodePropertyTables$1(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.propertyTables;if(r&&s)for(const o in r){const c=findPropertyTableByClass$1(s,o);c&&processPropertyTable$1(t,n,c)}}function findPropertyTableByClass$1(t,e){for(const n of t)if(n.class===e)return n;return null}function processPrimitivePropertyTextures(t,e,n,r){if(!e)return;const o=n.extensions?.[EXT_STRUCTURAL_METADATA_NAME]?.propertyTextures;if(o)for(const c of o){const d=e[c];processPrimitivePropertyTexture(t,d,n,r)}}function processPrimitivePropertyTexture(t,e,n,r){if(!e.properties)return;r.dataAttributeNames||(r.dataAttributeNames=[]);const s=e.class;for(const o in e.properties){const c=`${s}_${o}`,d=e.properties?.[o];if(!d)continue;d.data||(d.data=[]);const p=d.data,T=getPrimitiveTextureData(t,d,n);T!==null&&(primitivePropertyDataToAttributes(t,c,T,p,n),d.data=p,r.dataAttributeNames.push(c))}}function processPropertyTable$1(t,e,n){const r=e.classes?.[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const o in r.properties){const c=r.properties[o],d=n.properties?.[o];if(d){const p=getPropertyDataFromBinarySource$1(t,e,c,s,d);d.data=p}}}function getPropertyDataFromBinarySource$1(t,e,n,r,s){let o=[];const c=s.values,d=t.getTypedArrayForBufferView(c),p=getArrayOffsetsForProperty$1(t,n,s,r),T=getStringOffsetsForProperty$1(t,s,r);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{o=getPropertyDataNumeric$1(n,r,d,p);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{o=getPropertyDataString(r,d,p,T);break}case"ENUM":{o=getPropertyDataENUM(e,n,r,d,p);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return o}function getArrayOffsetsForProperty$1(t,e,n,r){return e.array&&typeof e.count>"u"&&typeof n.arrayOffsets<"u"?getOffsetsForProperty(t,n.arrayOffsets,n.arrayOffsetType||"UINT32",r):null}function getStringOffsetsForProperty$1(t,e,n){return typeof e.stringOffsets<"u"?getOffsetsForProperty(t,e.stringOffsets,e.stringOffsetType||"UINT32",n):null}function getPropertyDataNumeric$1(t,e,n,r){const s=t.array,o=t.count,c=getArrayElementByteSize(t.type,t.componentType),d=n.byteLength/c;let p;return t.componentType?p=convertRawBufferToMetadataArray(n,t.type,t.componentType,d):p=n,s?r?parseVariableLengthArrayNumeric(p,e,r,n.length,c):o?parseFixedLengthArrayNumeric(p,e,o):[]:p}function getPropertyDataENUM(t,e,n,r,s){const o=e.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const c=t.enums?.[o];if(!c)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const d=c.valueType||"UINT16",p=getArrayElementByteSize(e.type,d),T=r.byteLength/p;let I=convertRawBufferToMetadataArray(r,e.type,d,T);if(I||(I=r),e.array){if(s)return parseVariableLengthArrayENUM({valuesData:I,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r.length,elementSize:p,enumEntry:c});const D=e.count;return D?parseFixedLengthArrayENUM(I,n,D,c):[]}return getEnumsArray(I,0,n,c)}function parseVariableLengthArrayENUM(t){const{valuesData:e,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s,elementSize:o,enumEntry:c}=t,d=[];for(let p=0;p<n;p++){const T=r[p],I=r[p+1]-r[p];if(I+T>s)break;const D=T/o,x=I/o,G=getEnumsArray(e,D,x,c);d.push(G)}return d}function parseFixedLengthArrayENUM(t,e,n,r){const s=[];for(let o=0;o<e;o++){const c=n*o,d=getEnumsArray(t,c,n,r);s.push(d)}return s}function getEnumsArray(t,e,n,r){const s=[];for(let o=0;o<n;o++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)s.push("");else{const c=t[e+o],d=getEnumByValue(r,c);d?s.push(d.name):s.push("")}return s}function getEnumByValue(t,e){for(const n of t.values)if(n.value===e)return n;return null}const SCHEMA_CLASS_ID_DEFAULT="schemaClassId";function encodeExtStructuralMetadata(t,e){const n=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);if(n&&n.propertyTables)for(const r of n.propertyTables){const s=r.class,o=n.schema?.classes?.[s];r.properties&&o&&encodeProperties(r,o,t)}}function encodeProperties(t,e,n){for(const r in t.properties){const s=t.properties[r].data;if(s){const o=e.properties[r];if(o){const c=createPropertyTableProperty(s,o,n);t.properties[r]=c}}}}function createExtStructuralMetadata(t,e,n=SCHEMA_CLASS_ID_DEFAULT){let r=t.getExtension(EXT_STRUCTURAL_METADATA_NAME);r||(r=t.addExtension(EXT_STRUCTURAL_METADATA_NAME)),r.schema=createSchema(e,n,r.schema);const s=createPropertyTable(e,n,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(s)-1}function createSchema(t,e,n){const r=n??{id:"schema_id"},s={properties:{}};for(const o of t){const c={type:o.elementType,componentType:o.componentType};s.properties[o.name]=c}return r.classes={},r.classes[e]=s,r}function createPropertyTable(t,e,n){const r={class:e,count:0};let s=0;const o=n.classes?.[e];for(const c of t){if(s===0&&(s=c.values.length),s!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");o?.properties[c.name]&&(r.properties||(r.properties={}),r.properties[c.name]={values:0,data:c.values})}return r.count=s,r}function createPropertyTableProperty(t,e,n){const r={values:0};if(e.type==="STRING"){const{stringData:s,stringOffsets:o}=createPropertyDataString(t);r.stringOffsets=createBufferView(o,n),r.values=createBufferView(s,n)}else if(e.type==="SCALAR"&&e.componentType){const s=createPropertyDataScalar(t,e.componentType);r.values=createBufferView(s,n)}return r}const COMPONENT_TYPE_TO_ARRAY_CONSTRUCTOR={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function createPropertyDataScalar(t,e){const n=[];for(const s of t)n.push(Number(s));const r=COMPONENT_TYPE_TO_ARRAY_CONSTRUCTOR[e];if(!r)throw new Error("Illegal component type");return new r(n)}function createPropertyDataString(t){const e=new TextEncoder,n=[];let r=0;for(const p of t){const T=e.encode(p);r+=T.length,n.push(T)}const s=new Uint8Array(r),o=[];let c=0;for(const p of n)s.set(p,c),o.push(c),c+=p.length;o.push(c);const d=new Uint32Array(o);return{stringData:s,stringOffsets:d}}function createBufferView(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}const EXT_structural_metadata=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata,decode:decode$8,encode:encode$4,name:name$9},Symbol.toStringTag,{value:"Module"})),EXT_FEATURE_METADATA_NAME="EXT_feature_metadata",name$8=EXT_FEATURE_METADATA_NAME;async function decode$7(t,e){const n=new GLTFScenegraph(t);decodeExtFeatureMetadata(n,e)}function decodeExtFeatureMetadata(t,e){if(!e.gltf?.loadBuffers)return;const n=t.getExtension(EXT_FEATURE_METADATA_NAME);n&&(e.gltf?.loadImages&&decodePropertyTextures(t,n),decodePropertyTables(t,n))}function decodePropertyTextures(t,e){const n=e.schema;if(!n)return;const r=n.classes,{featureTextures:s}=e;if(r&&s)for(const o in r){const c=r[o],d=findFeatureTextureByClass(s,o);d&&handleFeatureTextureProperties(t,d,c)}}function decodePropertyTables(t,e){const n=e.schema;if(!n)return;const r=n.classes,s=e.featureTables;if(r&&s)for(const o in r){const c=findPropertyTableByClass(s,o);c&&processPropertyTable(t,n,c)}}function findPropertyTableByClass(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function findFeatureTextureByClass(t,e){for(const n in t){const r=t[n];if(r.class===e)return r}return null}function processPropertyTable(t,e,n){if(!n.class)return;const r=e.classes?.[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const s=n.count;for(const o in r.properties){const c=r.properties[o],d=n.properties?.[o];if(d){const p=getPropertyDataFromBinarySource(t,e,c,s,d);d.data=p}}}function handleFeatureTextureProperties(t,e,n){const r=e.class;for(const s in n.properties){const o=e?.properties?.[s];if(o){const c=getPropertyDataFromTexture(t,o,r);o.data=c}}}function getPropertyDataFromBinarySource(t,e,n,r,s){let o=[];const c=s.bufferView,d=t.getTypedArrayForBufferView(c),p=getArrayOffsetsForProperty(t,n,s,r),T=getStringOffsetsForProperty(t,n,s,r);return n.type==="STRING"||n.componentType==="STRING"?o=getPropertyDataString(r,d,p,T):isNumericProperty(n)&&(o=getPropertyDataNumeric(n,r,d,p)),o}function getArrayOffsetsForProperty(t,e,n,r){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?getOffsetsForProperty(t,n.arrayOffsetBufferView,n.offsetType||"UINT32",r):null}function getStringOffsetsForProperty(t,e,n,r){return typeof n.stringOffsetBufferView<"u"?getOffsetsForProperty(t,n.stringOffsetBufferView,n.offsetType||"UINT32",r):null}function isNumericProperty(t){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function getPropertyDataNumeric(t,e,n,r){const s=t.type==="ARRAY",o=t.componentCount,c="SCALAR",d=t.componentType||t.type,p=getArrayElementByteSize(c,d),T=n.byteLength/p,I=convertRawBufferToMetadataArray(n,c,d,T);return s?r?parseVariableLengthArrayNumeric(I,e,r,n.length,p):o?parseFixedLengthArrayNumeric(I,e,o):[]:I}function getPropertyDataFromTexture(t,e,n){const r=t.gltf.json;if(!r.meshes)return[];const s=[];for(const o of r.meshes)for(const c of o.primitives)processPrimitiveTextures(t,n,e,s,c);return s}function processPrimitiveTextures(t,e,n,r,s){const o={channels:n.channels,...n.texture},c=getPrimitiveTextureData(t,o,s);c&&primitivePropertyDataToAttributes(t,e,c,r,s)}const EXT_feature_metadata=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$7,name:name$8},Symbol.toStringTag,{value:"Module"})),VERSION$2="4.3.3",VERSION$1="4.3.3",BASIS_EXTERNAL_LIBRARIES={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let loadBasisTranscoderPromise;async function loadBasisTranscoderModule(t){registerJSModules(t.modules);const e=getJSModuleOrNull("basis");return e||(loadBasisTranscoderPromise||=loadBasisTranscoder(t),await loadBasisTranscoderPromise)}async function loadBasisTranscoder(t){let e=null,n=null;return[e,n]=await Promise.all([await loadLibrary(BASIS_EXTERNAL_LIBRARIES.TRANSCODER,"textures",t),await loadLibrary(BASIS_EXTERNAL_LIBRARIES.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await initializeBasisTranscoderModule(e,n)}function initializeBasisTranscoderModule(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:o,initializeBasis:c}=s;c(),r({BasisFile:o})})})}let loadBasisEncoderPromise;async function loadBasisEncoderModule(t){const e=t.modules||{};return e.basisEncoder?e.basisEncoder:(loadBasisEncoderPromise=loadBasisEncoderPromise||loadBasisEncoder(t),await loadBasisEncoderPromise)}async function loadBasisEncoder(t){let e=null,n=null;return[e,n]=await Promise.all([await loadLibrary(BASIS_EXTERNAL_LIBRARIES.ENCODER,"textures",t),await loadLibrary(BASIS_EXTERNAL_LIBRARIES.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await initializeBasisEncoderModule(e,n)}function initializeBasisEncoderModule(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t(n).then(s=>{const{BasisFile:o,KTX2File:c,initializeBasis:d,BasisEncoder:p}=s;d(),r({BasisFile:o,KTX2File:c,BasisEncoder:p})})})}const GL_EXTENSIONS_CONSTANTS={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},BROWSER_PREFIXES=["","WEBKIT_","MOZ_"],WEBGL_EXTENSIONS={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let formats=null;function getSupportedGPUTextureFormats(t){if(!formats){t=t||getWebGLContext()||void 0,formats=new Set;for(const e of BROWSER_PREFIXES)for(const n in WEBGL_EXTENSIONS)if(t&&t.getExtension(`${e}${n}`)){const r=WEBGL_EXTENSIONS[n];formats.add(r)}}return formats}function getWebGLContext(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const KTX2_ID=[171,75,84,88,32,50,48,187,13,10,26,10];function isKTX(t){const e=new Uint8Array(t);return!(e.byteLength<KTX2_ID.length||e[0]!==KTX2_ID[0]||e[1]!==KTX2_ID[1]||e[2]!==KTX2_ID[2]||e[3]!==KTX2_ID[3]||e[4]!==KTX2_ID[4]||e[5]!==KTX2_ID[5]||e[6]!==KTX2_ID[6]||e[7]!==KTX2_ID[7]||e[8]!==KTX2_ID[8]||e[9]!==KTX2_ID[9]||e[10]!==KTX2_ID[10]||e[11]!==KTX2_ID[11])}const OutputFormat={etc1:{basisFormat:0,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:GL_EXTENSIONS_CONSTANTS.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function parseBasis(t,e){if(e.basis.containerFormat==="auto"){if(isKTX(t)){const r=await loadBasisEncoderModule(e);return parseKTX2File(r.KTX2File,t,e)}const{BasisFile:n}=await loadBasisTranscoderModule(e);return parseBasisFile(n,t,e)}switch(e.basis.module){case"encoder":const n=await loadBasisEncoderModule(e);switch(e.basis.containerFormat){case"ktx2":return parseKTX2File(n.KTX2File,t,e);case"basis":default:return parseBasisFile(n.BasisFile,t,e)}case"transcoder":default:const{BasisFile:r}=await loadBasisTranscoderModule(e);return parseBasisFile(r,t,e)}}function parseBasisFile(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const s=r.getNumImages(),o=[];for(let c=0;c<s;c++){const d=r.getNumLevels(c),p=[];for(let T=0;T<d;T++)p.push(transcodeImage(r,c,T,n));o.push(p)}return o}finally{r.close(),r.delete()}}function transcodeImage(t,e,n,r){const s=t.getImageWidth(e,n),o=t.getImageHeight(e,n),c=t.getHasAlpha(),{compressed:d,format:p,basisFormat:T}=getBasisOptions(r,c),I=t.getImageTranscodedSizeInBytes(e,n,T),D=new Uint8Array(I);if(!t.transcodeImage(D,e,n,T,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:o,data:D,compressed:d,format:p,hasAlpha:c}}function parseKTX2File(t,e,n){const r=new t(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=r.getLevels(),o=[];for(let c=0;c<s;c++)o.push(transcodeKTX2Image(r,c,n));return[o]}finally{r.close(),r.delete()}}function transcodeKTX2Image(t,e,n){const{alphaFlag:r,height:s,width:o}=t.getImageLevelInfo(e,0,0),{compressed:c,format:d,basisFormat:p}=getBasisOptions(n,r),T=t.getImageTranscodedSizeInBytes(e,0,0,p),I=new Uint8Array(T);if(!t.transcodeImage(I,e,0,0,p,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:s,data:I,compressed:c,levelSize:T,hasAlpha:r,format:d}}function getBasisOptions(t,e){let n=t&&t.basis&&t.basis.format;return n==="auto"&&(n=selectSupportedBasisFormat()),typeof n=="object"&&(n=e?n.alpha:n.noAlpha),n=n.toLowerCase(),OutputFormat[n]}function selectSupportedBasisFormat(){const t=getSupportedGPUTextureFormats();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}const BasisWorkerLoader={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:VERSION$1,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},BasisLoader={...BasisWorkerLoader,parse:parseBasis},LITTLE_ENDIAN=!0,MAGIC_glTF=1735152710,GLB_FILE_HEADER_SIZE=12,GLB_CHUNK_HEADER_SIZE=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562,GLB_V1_CONTENT_FORMAT_JSON=0,GLB_CHUNK_TYPE_JSON_XVIZ_DEPRECATED=0,GLB_CHUNK_TYPE_BIX_XVIZ_DEPRECATED=1;function getMagicString(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function isGLB(t,e=0,n={}){const r=new DataView(t),{magic:s=MAGIC_glTF}=n,o=r.getUint32(e,!1);return o===s||o===MAGIC_glTF}function parseGLBSync(t,e,n=0,r={}){const s=new DataView(e),o=getMagicString(s,n+0),c=s.getUint32(n+4,LITTLE_ENDIAN),d=s.getUint32(n+8,LITTLE_ENDIAN);switch(Object.assign(t,{header:{byteOffset:n,byteLength:d,hasBinChunk:!1},type:o,version:c,json:{},binChunks:[]}),n+=GLB_FILE_HEADER_SIZE,t.version){case 1:return parseGLBV1(t,s,n);case 2:return parseGLBV2(t,s,n,r={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function parseGLBV1(t,e,n){assert$4(t.header.byteLength>GLB_FILE_HEADER_SIZE+GLB_CHUNK_HEADER_SIZE);const r=e.getUint32(n+0,LITTLE_ENDIAN),s=e.getUint32(n+4,LITTLE_ENDIAN);return n+=GLB_CHUNK_HEADER_SIZE,assert$4(s===GLB_V1_CONTENT_FORMAT_JSON),parseJSONChunk(t,e,n,r),n+=r,n+=parseBINChunk(t,e,n,t.header.byteLength),n}function parseGLBV2(t,e,n,r){return assert$4(t.header.byteLength>GLB_FILE_HEADER_SIZE+GLB_CHUNK_HEADER_SIZE),parseGLBChunksSync(t,e,n,r),n+t.header.byteLength}function parseGLBChunksSync(t,e,n,r){for(;n+8<=t.header.byteLength;){const s=e.getUint32(n+0,LITTLE_ENDIAN),o=e.getUint32(n+4,LITTLE_ENDIAN);switch(n+=GLB_CHUNK_HEADER_SIZE,o){case GLB_CHUNK_TYPE_JSON:parseJSONChunk(t,e,n,s);break;case GLB_CHUNK_TYPE_BIN:parseBINChunk(t,e,n,s);break;case GLB_CHUNK_TYPE_JSON_XVIZ_DEPRECATED:r.strict||parseJSONChunk(t,e,n,s);break;case GLB_CHUNK_TYPE_BIX_XVIZ_DEPRECATED:r.strict||parseBINChunk(t,e,n,s);break}n+=padToNBytes(s,4)}return n}function parseJSONChunk(t,e,n,r){const s=new Uint8Array(e.buffer,n,r),c=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(c),padToNBytes(r,4)}function parseBINChunk(t,e,n,r){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:e.buffer}),padToNBytes(r,4)}function resolveUrl(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;const r=e.baseUri||e.uri;if(!r)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return r.substr(0,r.lastIndexOf("/")+1)+t}const wasm_base="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",wasm_simd="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",detector=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),wasmpack=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),FILTERS={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},DECODERS={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function meshoptDecodeGltfBuffer(t,e,n,r,s,o="NONE"){const c=await loadWasmInstance();decode$6(c,c.exports[DECODERS[s]],t,e,n,r,c.exports[FILTERS[o||"NONE"]])}let wasmPromise;async function loadWasmInstance(){return wasmPromise||(wasmPromise=loadWasmModule()),wasmPromise}async function loadWasmModule(){let t=wasm_base;WebAssembly.validate(detector)&&(t=wasm_simd,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(unpack(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function unpack(t){const e=new Uint8Array(t.length);for(let r=0;r<t.length;++r){const s=t.charCodeAt(r);e[r]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let n=0;for(let r=0;r<t.length;++r)e[n++]=e[r]<60?wasmpack[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,n)}function decode$6(t,e,n,r,s,o,c){const d=t.exports.sbrk,p=r+3&-4,T=d(p*s),I=d(o.length),D=new Uint8Array(t.exports.memory.buffer);D.set(o,I);const x=e(T,r,s,I,o.length);if(x===0&&c&&c(T,p,s),n.set(D.subarray(T,T+r*s)),d(T-d(0)),x!==0)throw new Error(`Malformed buffer data: ${x}`)}const EXT_MESHOPT_COMPRESSION="EXT_meshopt_compression",name$7=EXT_MESHOPT_COMPRESSION;async function decode$5(t,e){const n=new GLTFScenegraph(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const r=[];for(const s of t.json.bufferViews||[])r.push(decodeMeshoptBufferView(n,s));await Promise.all(r),n.removeExtension(EXT_MESHOPT_COMPRESSION)}async function decodeMeshoptBufferView(t,e){const n=t.getObjectExtension(e,EXT_MESHOPT_COMPRESSION);if(n){const{byteOffset:r=0,byteLength:s=0,byteStride:o,count:c,mode:d,filter:p="NONE",buffer:T}=n,I=t.gltf.buffers[T],D=new Uint8Array(I.arrayBuffer,I.byteOffset+r,s),x=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await meshoptDecodeGltfBuffer(x,c,o,D,d,p),t.removeObjectExtension(e,EXT_MESHOPT_COMPRESSION)}}const EXT_meshopt_compression=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$5,name:name$7},Symbol.toStringTag,{value:"Module"})),EXT_TEXTURE_WEBP="EXT_texture_webp",name$6=EXT_TEXTURE_WEBP;function preprocess$3(t,e){const n=new GLTFScenegraph(t);if(!isImageFormatSupported("image/webp")){if(n.getRequiredExtensions().includes(EXT_TEXTURE_WEBP))throw new Error(`gltf: Required extension ${EXT_TEXTURE_WEBP} not supported by browser`);return}const{json:r}=n;for(const s of r.textures||[]){const o=n.getObjectExtension(s,EXT_TEXTURE_WEBP);o&&(s.source=o.source),n.removeObjectExtension(s,EXT_TEXTURE_WEBP)}n.removeExtension(EXT_TEXTURE_WEBP)}const EXT_texture_webp=Object.freeze(Object.defineProperty({__proto__:null,name:name$6,preprocess:preprocess$3},Symbol.toStringTag,{value:"Module"})),KHR_TEXTURE_BASISU="KHR_texture_basisu",name$5=KHR_TEXTURE_BASISU;function preprocess$2(t,e){const n=new GLTFScenegraph(t),{json:r}=n;for(const s of r.textures||[]){const o=n.getObjectExtension(s,KHR_TEXTURE_BASISU);o&&(s.source=o.source,n.removeObjectExtension(s,KHR_TEXTURE_BASISU))}n.removeExtension(KHR_TEXTURE_BASISU)}const KHR_texture_basisu=Object.freeze(Object.defineProperty({__proto__:null,name:name$5,preprocess:preprocess$2},Symbol.toStringTag,{value:"Module"})),VERSION="4.3.3",DracoLoader$1={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:VERSION,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function getDracoSchema(t,e,n){const r=makeMetadata(e.metadata),s=[],o=transformAttributesLoaderData(e.attributes);for(const c in t){const d=t[c],p=getArrowFieldFromAttribute(c,d,o[c]);s.push(p)}if(n){const c=getArrowFieldFromAttribute("indices",n);s.push(c)}return{fields:s,metadata:r}}function transformAttributesLoaderData(t){const e={};for(const n in t){const r=t[n];e[r.name||"undefined"]=r}return e}function getArrowFieldFromAttribute(t,e,n){const r=n?makeMetadata(n.metadata):void 0;return deduceMeshField(t,e,r)}function makeMetadata(t){Object.entries(t);const e={};for(const n in t)e[`${n}.string`]=JSON.stringify(t[n]);return e}const DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},INDEX_ITEM_SIZE=4;class DracoParser{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,n={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(n);const s=this.decoder.GetEncodedGeometryType(r),o=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let c;switch(s){case this.draco.TRIANGULAR_MESH:c=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:c=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!c.ok()||!o.ptr){const x=`DRACO decompression failed: ${c.error_msg()}`;throw new Error(x)}const d=this._getDracoLoaderData(o,s,n),p=this._getMeshData(o,d,n),T=getMeshBoundingBox(p.attributes),I=getDracoSchema(p.attributes,d,p.indices);return{loader:"draco",loaderData:d,header:{vertexCount:o.num_points(),boundingBox:T},...p,schema:I}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,n,r){const s=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:n,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:o}}_getDracoAttributes(e,n){const r={};for(let s=0;s<e.num_attributes();s++){const o=this.decoder.GetAttribute(e,s),c=this._getAttributeMetadata(e,s);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:s,metadata:c};const d=this._getQuantizationTransform(o,n);d&&(r[o.unique_id()].quantization_transform=d);const p=this._getOctahedronTransform(o,n);p&&(r[o.unique_id()].octahedron_transform=p)}return r}_getMeshData(e,n,r){const s=this._getMeshAttributes(n,e,r);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(e,n,r){const s={};for(const o of Object.values(e.attributes)){const c=this._deduceAttributeName(o,r);o.name=c;const d=this._getAttributeValues(n,o);if(d){const{value:p,size:T}=d;s[c]={value:p,size:T,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}}return s}_getTriangleListIndices(e){const r=e.num_faces()*3,s=r*INDEX_ITEM_SIZE,o=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,n),getUint32Array(n)}finally{this.draco.destroy(n)}}_getAttributeValues(e,n){const r=DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP[n.data_type];if(!r)return console.warn(`DRACO: Unsupported attribute type ${n.data_type}`),null;const s=n.num_components,c=e.num_points()*s,d=c*r.BYTES_PER_ELEMENT,p=getDracoDataType(this.draco,r);let T;const I=this.draco._malloc(d);try{const D=this.decoder.GetAttribute(e,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,D,p,d,I),T=new r(this.draco.HEAPF32.buffer,I,c).slice()}finally{this.draco._free(I)}return{value:T,size:s}}_deduceAttributeName(e,n){const r=e.unique_id;for(const[c,d]of Object.entries(n.extraAttributes||{}))if(d===r)return c;const s=e.attribute_type;for(const c in DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP)if(this.draco[c]===s)return DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP[c];const o=n.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){const n=this.decoder.GetMetadata(e);return this._getDracoMetadata(n)}_getAttributeMetadata(e,n){const r=this.decoder.GetAttributeMetadata(e,n);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const n={},r=this.metadataQuerier.NumEntries(e);for(let s=0;s<r;s++){const o=this.metadataQuerier.GetEntryName(e,s);n[o]=this._getDracoMetadataField(e,o)}return n}_getDracoMetadataField(e,n){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,n,r);const s=getInt32Array(r);return{int:this.metadataQuerier.GetIntEntry(e,n),string:this.metadataQuerier.GetStringEntry(e,n),double:this.metadataQuerier.GetDoubleEntry(e,n),intArray:s}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:n=[],octahedronAttributes:r=[]}=e,s=[...n,...r];for(const o of s)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,n){const{quantizedAttributes:r=[]}=n,s=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(s)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits(),range:c.range(),min_values:new Float32Array([1,2,3]).map(d=>c.min_value(d))}}finally{this.draco.destroy(c)}}return null}_getOctahedronTransform(e,n){const{octahedronAttributes:r=[]}=n,s=e.attribute_type();if(r.map(c=>this.decoder[c]).includes(s)){const c=new this.draco.AttributeQuantizationTransform;try{if(c.InitFromAttribute(e))return{quantization_bits:c.quantization_bits()}}finally{this.draco.destroy(c)}}return null}}function getDracoDataType(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function getInt32Array(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}function getUint32Array(t){const e=t.size(),n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=t.GetValue(r);return n}const DRACO_DECODER_VERSION="1.5.6",DRACO_ENCODER_VERSION="1.4.1",STATIC_DECODER_URL=`https://www.gstatic.com/draco/versioned/decoders/${DRACO_DECODER_VERSION}`,DRACO_EXTERNAL_LIBRARIES={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},DRACO_EXTERNAL_LIBRARY_URLS={[DRACO_EXTERNAL_LIBRARIES.DECODER]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.DECODER}`,[DRACO_EXTERNAL_LIBRARIES.DECODER_WASM]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.DECODER_WASM}`,[DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER]:`${STATIC_DECODER_URL}/${DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER}`,[DRACO_EXTERNAL_LIBRARIES.ENCODER]:`https://raw.githubusercontent.com/google/draco/${DRACO_ENCODER_VERSION}/javascript/${DRACO_EXTERNAL_LIBRARIES.ENCODER}`};let loadDecoderPromise;async function loadDracoDecoderModule(t){const e=t.modules||{};return e.draco3d?loadDecoderPromise||=e.draco3d.createDecoderModule({}).then(n=>({draco:n})):loadDecoderPromise||=loadDracoDecoder(t),await loadDecoderPromise}async function loadDracoDecoder(t){let e,n;switch(t.draco&&t.draco.decoderType){case"js":e=await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER],"draco",t,DRACO_EXTERNAL_LIBRARIES.FALLBACK_DECODER);break;case"wasm":default:[e,n]=await Promise.all([await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.DECODER],"draco",t,DRACO_EXTERNAL_LIBRARIES.DECODER),await loadLibrary(DRACO_EXTERNAL_LIBRARY_URLS[DRACO_EXTERNAL_LIBRARIES.DECODER_WASM],"draco",t,DRACO_EXTERNAL_LIBRARIES.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await initializeDracoDecoder(e,n)}function initializeDracoDecoder(t,e){const n={};return e&&(n.wasmBinary=e),new Promise(r=>{t({...n,onModuleLoaded:s=>r({draco:s})})})}const DracoLoader={...DracoLoader$1,parse:parse$1};async function parse$1(t,e){const{draco:n}=await loadDracoDecoderModule(e),r=new DracoParser(n);try{return r.parseSync(t,e?.draco)}finally{r.destroy()}}function getGLTFAccessors(t){const e={};for(const n in t){const r=t[n];if(n!=="indices"){const s=getGLTFAccessor(r);e[n]=s}}return e}function getGLTFAccessor(t){const{buffer:e,size:n,count:r}=getAccessorData(t);return{value:e,size:n,byteOffset:0,count:r,type:getAccessorTypeFromSize(n),componentType:getComponentTypeFromArray(e)}}function getAccessorData(t){let e=t,n=1,r=0;return t&&t.value&&(e=t.value,n=t.size||1),e&&(ArrayBuffer.isView(e)||(e=toTypedArray(e,Float32Array)),r=e.length/n),{buffer:e,size:n,count:r}}function toTypedArray(t,e,n=!1){return t?Array.isArray(t)?new e(t):n&&!(t instanceof e)?new e(t):t:null}const KHR_DRACO_MESH_COMPRESSION="KHR_draco_mesh_compression",name$4=KHR_DRACO_MESH_COMPRESSION;function preprocess$1(t,e,n){const r=new GLTFScenegraph(t);for(const s of makeMeshPrimitiveIterator(r))r.getObjectExtension(s,KHR_DRACO_MESH_COMPRESSION)}async function decode$4(t,e,n){if(!e?.gltf?.decompressMeshes)return;const r=new GLTFScenegraph(t),s=[];for(const o of makeMeshPrimitiveIterator(r))r.getObjectExtension(o,KHR_DRACO_MESH_COMPRESSION)&&s.push(decompressPrimitive(r,o,e,n));await Promise.all(s),r.removeExtension(KHR_DRACO_MESH_COMPRESSION)}function encode$3(t,e={}){const n=new GLTFScenegraph(t);for(const r of n.json.meshes||[])compressMesh(r),n.addRequiredExtension(KHR_DRACO_MESH_COMPRESSION)}async function decompressPrimitive(t,e,n,r){const s=t.getObjectExtension(e,KHR_DRACO_MESH_COMPRESSION);if(!s)return;const o=t.getTypedArrayForBufferView(s.bufferView),c=sliceArrayBuffer(o.buffer,o.byteOffset),d={...n};delete d["3d-tiles"];const p=await parseFromContext(c,DracoLoader,d,r),T=getGLTFAccessors(p.attributes);for(const[I,D]of Object.entries(T))if(I in e.attributes){const x=e.attributes[I],G=t.getAccessor(x);G?.min&&G?.max&&(D.min=G.min,D.max=G.max)}e.attributes=T,p.indices&&(e.indices=getGLTFAccessor(p.indices)),t.removeObjectExtension(e,KHR_DRACO_MESH_COMPRESSION),checkPrimitive(e)}function compressMesh(t,e,n=4,r,s){if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:t}),c=s?.parseSync?.({attributes:t}),d=r._addFauxAttributes(c.attributes),p=r.addBufferView(o);return{primitives:[{attributes:d,mode:n,extensions:{[KHR_DRACO_MESH_COMPRESSION]:{bufferView:p,attributes:d}}}]}}function checkPrimitive(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*makeMeshPrimitiveIterator(t){for(const e of t.json.meshes||[])for(const n of e.primitives)yield n}const KHR_draco_mesh_compression=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$4,encode:encode$3,name:name$4,preprocess:preprocess$1},Symbol.toStringTag,{value:"Module"})),DEFAULT_CONFIG={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...DEFAULT_CONFIG}};const config=globalThis.mathgl.config;function formatValue(t,{precision:e=config.precision}={}){return t=round(t),`${parseFloat(t.toPrecision(e))}`}function isArray(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function equals(t,e,n){const r=config.EPSILON;try{if(t===e)return!0;if(isArray(t)&&isArray(e)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;++s)if(!equals(t[s],e[s]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=config.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{config.EPSILON=r}}function round(t){return Math.round(t/config.EPSILON)*config.EPSILON}class MathArray extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:isArray(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+formatValue(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!equals(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let s=0;s<this.ELEMENTS;++s){const o=e[s],c=typeof n=="number"?n:n[s];this[s]=o+r*(c-o)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(config.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function validateVector(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function checkNumber(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function checkVector(t,e,n=""){if(config.debug&&!validateVector(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function assert(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Vector extends MathArray{get x(){return this[0]}set x(e){this[0]=checkNumber(e)}get y(){return this[1]}set y(e){this[1]=checkNumber(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const s=this[r]-e[r];n+=s*s}return checkNumber(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return checkNumber(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return assert(e>=0&&e<this.ELEMENTS,"index is out of range"),checkNumber(this[e])}setComponent(e,n){return assert(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}let ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;function create$1(){const t=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function transformMat3$1(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[3]*s+n[6],t[1]=n[1]*r+n[4]*s+n[7],t}(function(){const t=create$1();return function(e,n,r,s,o,c){let d,p;for(n||(n=2),r||(r=0),s?p=Math.min(s*n+r,e.length):p=e.length,d=r;d<p;d+=n)t[0]=e[d],t[1]=e[d+1],o(t,t,c),e[d]=t[0],e[d+1]=t[1];return e}})();function vec3_transformMat4AsVector(t,e,n){const r=e[0],s=e[1],o=e[2],c=n[3]*r+n[7]*s+n[11]*o||1;return t[0]=(n[0]*r+n[4]*s+n[8]*o)/c,t[1]=(n[1]*r+n[5]*s+n[9]*o)/c,t[2]=(n[2]*r+n[6]*s+n[10]*o)/c,t}function vec3_transformMat2(t,e,n){const r=e[0],s=e[1];return t[0]=n[0]*r+n[2]*s,t[1]=n[1]*r+n[3]*s,t[2]=e[2],t}function vec4_transformMat3(t,e,n){const r=e[0],s=e[1],o=e[2];return t[0]=n[0]*r+n[3]*s+n[6]*o,t[1]=n[1]*r+n[4]*s+n[7]*o,t[2]=n[2]*r+n[5]*s+n[8]*o,t[3]=e[3],t}function create(){const t=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cross(t,e,n){const r=e[0],s=e[1],o=e[2],c=n[0],d=n[1],p=n[2];return t[0]=s*p-o*d,t[1]=o*c-r*p,t[2]=r*d-s*c,t}function transformMat4(t,e,n){const r=e[0],s=e[1],o=e[2];let c=n[3]*r+n[7]*s+n[11]*o+n[15];return c=c||1,t[0]=(n[0]*r+n[4]*s+n[8]*o+n[12])/c,t[1]=(n[1]*r+n[5]*s+n[9]*o+n[13])/c,t[2]=(n[2]*r+n[6]*s+n[10]*o+n[14])/c,t}function transformMat3(t,e,n){const r=e[0],s=e[1],o=e[2];return t[0]=r*n[0]+s*n[3]+o*n[6],t[1]=r*n[1]+s*n[4]+o*n[7],t[2]=r*n[2]+s*n[5]+o*n[8],t}function transformQuat(t,e,n){const r=n[0],s=n[1],o=n[2],c=n[3],d=e[0],p=e[1],T=e[2];let I=s*T-o*p,D=o*d-r*T,x=r*p-s*d,G=s*x-o*D,P=o*I-r*x,U=r*D-s*I;const H=c*2;return I*=H,D*=H,x*=H,G*=2,P*=2,U*=2,t[0]=d+I+G,t[1]=p+D+P,t[2]=T+x+U,t}function rotateX(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0],o[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),o[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function rotateY(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),o[1]=s[1],o[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function rotateZ(t,e,n,r){const s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),o[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),o[2]=s[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function angle(t,e){const n=t[0],r=t[1],s=t[2],o=e[0],c=e[1],d=e[2],p=Math.sqrt((n*n+r*r+s*s)*(o*o+c*c+d*d)),T=p&&dot(t,e)/p;return Math.acos(Math.min(Math.max(T,-1),1))}(function(){const t=create();return function(e,n,r,s,o,c){let d,p;for(n||(n=3),r||(r=0),s?p=Math.min(s*n+r,e.length):p=e.length,d=r;d<p;d+=n)t[0]=e[d],t[1]=e[d+1],t[2]=e[d+2],o(t,t,c),e[d]=t[0],e[d+1]=t[1],e[d+2]=t[2];return e}})();const ORIGIN=[0,0,0];let ZERO;class Vector3 extends Vector{static get ZERO(){return ZERO||(ZERO=new Vector3(0,0,0),Object.freeze(ZERO)),ZERO}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&isArray(e)?this.copy(e):(config.debug&&(checkNumber(e),checkNumber(n),checkNumber(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return config.debug&&(checkNumber(e.x),checkNumber(e.y),checkNumber(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=checkNumber(e)}angle(e){return angle(this,e)}cross(e){return cross(this,this,e),this.check()}rotateX({radians:e,origin:n=ORIGIN}){return rotateX(this,this,n,e),this.check()}rotateY({radians:e,origin:n=ORIGIN}){return rotateY(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=ORIGIN}){return rotateZ(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return transformMat4(this,this,e),this.check()}transformAsVector(e){return vec3_transformMat4AsVector(this,this,e),this.check()}transformByMatrix3(e){return transformMat3(this,this,e),this.check()}transformByMatrix2(e){return vec3_transformMat2(this,this,e),this.check()}transformByQuaternion(e){return transformQuat(this,this,e),this.check()}}class Matrix extends MathArray{toString(){let e="[";if(config.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=checkNumber(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)n[s]=this[r+s];return n}setColumn(e,n){const r=e*this.RANK;for(let s=0;s<this.RANK;++s)this[r+s]=n[s];return this}}function transpose(t,e){if(t===e){const n=e[1],r=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function invert(t,e){const n=e[0],r=e[1],s=e[2],o=e[3],c=e[4],d=e[5],p=e[6],T=e[7],I=e[8],D=I*c-d*T,x=-I*o+d*p,G=T*o-c*p;let P=n*D+r*x+s*G;return P?(P=1/P,t[0]=D*P,t[1]=(-I*r+s*T)*P,t[2]=(d*r-s*c)*P,t[3]=x*P,t[4]=(I*n-s*p)*P,t[5]=(-d*n+s*o)*P,t[6]=G*P,t[7]=(-T*n+r*p)*P,t[8]=(c*n-r*o)*P,t):null}function determinant(t){const e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],c=t[5],d=t[6],p=t[7],T=t[8];return e*(T*o-c*p)+n*(-T*s+c*d)+r*(p*s-o*d)}function multiply(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],p=e[5],T=e[6],I=e[7],D=e[8],x=n[0],G=n[1],P=n[2],U=n[3],H=n[4],X=n[5],j=n[6],K=n[7],q=n[8];return t[0]=x*r+G*c+P*T,t[1]=x*s+G*d+P*I,t[2]=x*o+G*p+P*D,t[3]=U*r+H*c+X*T,t[4]=U*s+H*d+X*I,t[5]=U*o+H*p+X*D,t[6]=j*r+K*c+q*T,t[7]=j*s+K*d+q*I,t[8]=j*o+K*p+q*D,t}function translate(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],p=e[5],T=e[6],I=e[7],D=e[8],x=n[0],G=n[1];return t[0]=r,t[1]=s,t[2]=o,t[3]=c,t[4]=d,t[5]=p,t[6]=x*r+G*c+T,t[7]=x*s+G*d+I,t[8]=x*o+G*p+D,t}function rotate(t,e,n){const r=e[0],s=e[1],o=e[2],c=e[3],d=e[4],p=e[5],T=e[6],I=e[7],D=e[8],x=Math.sin(n),G=Math.cos(n);return t[0]=G*r+x*c,t[1]=G*s+x*d,t[2]=G*o+x*p,t[3]=G*c-x*r,t[4]=G*d-x*s,t[5]=G*p-x*o,t[6]=T,t[7]=I,t[8]=D,t}function scale(t,e,n){const r=n[0],s=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function fromQuat(t,e){const n=e[0],r=e[1],s=e[2],o=e[3],c=n+n,d=r+r,p=s+s,T=n*c,I=r*c,D=r*d,x=s*c,G=s*d,P=s*p,U=o*c,H=o*d,X=o*p;return t[0]=1-D-P,t[3]=I-X,t[6]=x+H,t[1]=I+X,t[4]=1-T-P,t[7]=G-U,t[2]=x-H,t[5]=G+U,t[8]=1-T-D,t}var INDICES;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(INDICES||(INDICES={}));const IDENTITY_MATRIX=Object.freeze([1,0,0,0,1,0,0,0,1]);class Matrix3 extends Matrix{static get IDENTITY(){return getIdentityMatrix()}static get ZERO(){return getZeroMatrix()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return INDICES}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(IDENTITY_MATRIX)}fromObject(e){return this.check()}fromQuaternion(e){return fromQuat(this,e),this.check()}set(e,n,r,s,o,c,d,p,T){return this[0]=e,this[1]=n,this[2]=r,this[3]=s,this[4]=o,this[5]=c,this[6]=d,this[7]=p,this[8]=T,this.check()}setRowMajor(e,n,r,s,o,c,d,p,T){return this[0]=e,this[1]=s,this[2]=d,this[3]=n,this[4]=o,this[5]=p,this[6]=r,this[7]=c,this[8]=T,this.check()}determinant(){return determinant(this)}transpose(){return transpose(this,this),this.check()}invert(){return invert(this,this),this.check()}multiplyLeft(e){return multiply(this,e,this),this.check()}multiplyRight(e){return multiply(this,this,e),this.check()}rotate(e){return rotate(this,this,e),this.check()}scale(e){return Array.isArray(e)?scale(this,this,e):scale(this,this,[e,e]),this.check()}translate(e){return translate(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=transformMat3$1(n||[-0,-0],e,this);break;case 3:r=transformMat3(n||[-0,-0,-0],e,this);break;case 4:r=vec4_transformMat3(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return checkVector(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let ZERO_MATRIX3,IDENTITY_MATRIX3=null;function getZeroMatrix(){return ZERO_MATRIX3||(ZERO_MATRIX3=new Matrix3([0,0,0,0,0,0,0,0,0]),Object.freeze(ZERO_MATRIX3)),ZERO_MATRIX3}function getIdentityMatrix(){return IDENTITY_MATRIX3||(IDENTITY_MATRIX3=new Matrix3,Object.freeze(IDENTITY_MATRIX3)),IDENTITY_MATRIX3}const KHR_TEXTURE_TRANSFORM="KHR_texture_transform",name$3=KHR_TEXTURE_TRANSFORM,scratchVector=new Vector3,scratchRotationMatrix=new Matrix3,scratchScaleMatrix=new Matrix3;async function decode$3(t,e){if(!new GLTFScenegraph(t).hasExtension(KHR_TEXTURE_TRANSFORM)||!e.gltf?.loadBuffers)return;const s=t.json.materials||[];for(let o=0;o<s.length;o++)transformTexCoords(o,t)}function transformTexCoords(t,e){const n=e.json.materials?.[t],r=[n?.pbrMetallicRoughness?.baseColorTexture,n?.emissiveTexture,n?.normalTexture,n?.occlusionTexture,n?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(const o of r)o&&o?.extensions?.[KHR_TEXTURE_TRANSFORM]&&transformPrimitives(e,t,o,s)}function transformPrimitives(t,e,n,r){const s=getTransformParameters(n,r);if(!s)return;const o=t.json.meshes||[];for(const c of o)for(const d of c.primitives){const p=d.material;Number.isFinite(p)&&e===p&&transformPrimitive(t,d,s)}}function getTransformParameters(t,e){const n=t.extensions?.[KHR_TEXTURE_TRANSFORM],{texCoord:r=0}=t,{texCoord:s=r}=n;if(!(e.findIndex(([c,d])=>c===r&&d===s)!==-1)){const c=makeTransformationMatrix(n);return r!==s&&(t.texCoord=s),e.push([r,s]),{originalTexCoord:r,texCoord:s,matrix:c}}return null}function transformPrimitive(t,e,n){const{originalTexCoord:r,texCoord:s,matrix:o}=n,c=e.attributes[`TEXCOORD_${r}`];if(Number.isFinite(c)){const d=t.json.accessors?.[c];if(d&&d.bufferView){const p=t.json.bufferViews?.[d.bufferView];if(p){const{arrayBuffer:T,byteOffset:I}=t.buffers[p.buffer],D=(I||0)+(d.byteOffset||0)+(p.byteOffset||0),{ArrayType:x,length:G}=getAccessorArrayTypeAndLength(d,p),P=BYTES[d.componentType],U=COMPONENTS[d.type],H=p.byteStride||P*U,X=new Float32Array(G);for(let j=0;j<d.count;j++){const K=new x(T,D+j*H,2);scratchVector.set(K[0],K[1],1),scratchVector.transformByMatrix3(o),X.set([scratchVector[0],scratchVector[1]],j*U)}r===s?updateGltf(d,p,t.buffers,X):createAttribute(s,d,e,t,X)}}}}function updateGltf(t,e,n,r){t.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=n.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function createAttribute(t,e,n,r,s){r.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const c=r.json.accessors;c&&(c.push({bufferView:o?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),n.attributes[`TEXCOORD_${t}`]=c.length-1)}function makeTransformationMatrix(t){const{offset:e=[0,0],rotation:n=0,scale:r=[1,1]}=t,s=new Matrix3().set(1,0,0,0,1,0,e[0],e[1],1),o=scratchRotationMatrix.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),c=scratchScaleMatrix.set(r[0],0,0,0,r[1],0,0,0,1);return s.multiplyRight(o).multiplyRight(c)}const KHR_texture_transform=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$3,name:name$3},Symbol.toStringTag,{value:"Module"})),KHR_LIGHTS_PUNCTUAL="KHR_lights_punctual",name$2=KHR_LIGHTS_PUNCTUAL;async function decode$2(t){const e=new GLTFScenegraph(t),{json:n}=e,r=e.getExtension(KHR_LIGHTS_PUNCTUAL);r&&(e.json.lights=r.lights,e.removeExtension(KHR_LIGHTS_PUNCTUAL));for(const s of n.nodes||[]){const o=e.getObjectExtension(s,KHR_LIGHTS_PUNCTUAL);o&&(s.light=o.light),e.removeObjectExtension(s,KHR_LIGHTS_PUNCTUAL)}}async function encode$2(t){const e=new GLTFScenegraph(t),{json:n}=e;if(n.lights){const r=e.addExtension(KHR_LIGHTS_PUNCTUAL);assert$1(!r.lights),r.lights=n.lights,delete n.lights}if(e.json.lights){for(const r of e.json.lights){const s=r.node;e.addObjectExtension(s,KHR_LIGHTS_PUNCTUAL,r)}delete e.json.lights}}const KHR_lights_punctual=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$2,encode:encode$2,name:name$2},Symbol.toStringTag,{value:"Module"})),KHR_MATERIALS_UNLIT="KHR_materials_unlit",name$1=KHR_MATERIALS_UNLIT;async function decode$1(t){const e=new GLTFScenegraph(t),{json:n}=e;for(const r of n.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,KHR_MATERIALS_UNLIT);e.removeExtension(KHR_MATERIALS_UNLIT)}function encode$1(t){const e=new GLTFScenegraph(t),{json:n}=e;if(e.materials)for(const r of n.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,KHR_MATERIALS_UNLIT,{}),e.addExtension(KHR_MATERIALS_UNLIT))}const KHR_materials_unlit=Object.freeze(Object.defineProperty({__proto__:null,decode:decode$1,encode:encode$1,name:name$1},Symbol.toStringTag,{value:"Module"})),KHR_TECHNIQUES_WEBGL="KHR_techniques_webgl",name=KHR_TECHNIQUES_WEBGL;async function decode(t){const e=new GLTFScenegraph(t),{json:n}=e,r=e.getExtension(KHR_TECHNIQUES_WEBGL);if(r){const s=resolveTechniques(r,e);for(const o of n.materials||[]){const c=e.getObjectExtension(o,KHR_TECHNIQUES_WEBGL);c&&(o.technique=Object.assign({},c,s[c.technique]),o.technique.values=resolveValues(o.technique,e)),e.removeObjectExtension(o,KHR_TECHNIQUES_WEBGL)}e.removeExtension(KHR_TECHNIQUES_WEBGL)}}async function encode(t,e){}function resolveTechniques(t,e){const{programs:n=[],shaders:r=[],techniques:s=[]}=t,o=new TextDecoder;return r.forEach(c=>{if(Number.isFinite(c.bufferView))c.code=o.decode(e.getTypedArrayForBufferView(c.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(c=>{c.fragmentShader=r[c.fragmentShader],c.vertexShader=r[c.vertexShader]}),s.forEach(c=>{c.program=n[c.program]}),s}function resolveValues(t,e){const n=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(r=>{t.uniforms[r].value&&!(r in n)&&(n[r]=t.uniforms[r].value)}),Object.keys(n).forEach(r=>{typeof n[r]=="object"&&n[r].index!==void 0&&(n[r].texture=e.getTexture(n[r].index))}),n}const KHR_techniques_webgl=Object.freeze(Object.defineProperty({__proto__:null,decode,encode,name},Symbol.toStringTag,{value:"Module"})),EXTENSIONS=[EXT_structural_metadata,EXT_mesh_features,EXT_meshopt_compression,EXT_texture_webp,KHR_texture_basisu,KHR_draco_mesh_compression,KHR_lights_punctual,KHR_materials_unlit,KHR_techniques_webgl,KHR_texture_transform,EXT_feature_metadata];function preprocessExtensions(t,e={},n){const r=EXTENSIONS.filter(s=>useExtension(s.name,e));for(const s of r)s.preprocess?.(t,e,n)}async function decodeExtensions(t,e={},n){const r=EXTENSIONS.filter(s=>useExtension(s.name,e));for(const s of r)await s.decode?.(t,e,n)}function useExtension(t,e){const n=e?.gltf?.excludeExtensions||{};return!(t in n&&!n[t])}const KHR_BINARY_GLTF="KHR_binary_glTF";function preprocess(t){const e=new GLTFScenegraph(t),{json:n}=e;for(const r of n.images||[]){const s=e.getObjectExtension(r,KHR_BINARY_GLTF);s&&Object.assign(r,s),e.removeObjectExtension(r,KHR_BINARY_GLTF)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,e.removeExtension(KHR_BINARY_GLTF)}const GLTF_ARRAYS={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},GLTF_KEYS={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class GLTFV1Normalizer{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,n){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),preprocess(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const n in GLTF_ARRAYS)this._convertTopLevelObjectToArray(e,n)}_convertTopLevelObjectToArray(e,n){const r=e[n];if(!(!r||Array.isArray(r))){e[n]=[];for(const s in r){const o=r[s];o.id=o.id||s;const c=e[n].length;e[n].push(o),this.idToIndexMap[n][s]=c}}}_convertObjectIdsToArrayIndices(e){for(const n in GLTF_ARRAYS)this._convertIdsToIndices(e,n);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const n of e.textures)this._convertTextureIds(n);for(const n of e.meshes)this._convertMeshIds(n);for(const n of e.nodes)this._convertNodeIds(n);for(const n of e.scenes)this._convertSceneIds(n)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const n of e.primitives){const{attributes:r,indices:s,material:o}=n;for(const c in r)r[c]=this._convertIdToIndex(r[c],"accessor");s&&(n.indices=this._convertIdToIndex(s,"accessor")),o&&(n.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(n=>this._convertIdToIndex(n,"node"))),e.meshes&&(e.meshes=e.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(e,n){e[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),e[n]=[]);for(const r of e[n])for(const s in r){const o=r[s],c=this._convertIdToIndex(o,s);r[s]=c}}_convertIdToIndex(e,n){const r=GLTF_KEYS[n];if(r in this.idToIndexMap){const s=this.idToIndexMap[r][e];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${n} with id ${e}`);return s}return e}_updateObjects(e){for(const n of this.json.buffers)delete n.type}_updateMaterial(e){for(const n of e.materials){n.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=n.values?.tex||n.values?.texture2d_0||n.values?.diffuseTex,s=e.textures.findIndex(o=>o.id===r);s!==-1&&(n.pbrMetallicRoughness.baseColorTexture={index:s})}}}function normalizeGLTFV1(t,e={}){return new GLTFV1Normalizer().normalize(t,e)}async function parseGLTF(t,e,n=0,r,s){return parseGLTFContainerSync(t,e,n,r),normalizeGLTFV1(t,{normalize:r?.gltf?.normalize}),preprocessExtensions(t,r,s),r?.gltf?.loadBuffers&&t.json.buffers&&await loadBuffers(t,r,s),r?.gltf?.loadImages&&await loadImages(t,r,s),await decodeExtensions(t,r,s),t}function parseGLTFContainerSync(t,e,n,r){if(r.uri&&(t.baseUri=r.uri),e instanceof ArrayBuffer&&!isGLB(e,n,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=parseJSON(e);else if(e instanceof ArrayBuffer){const c={};n=parseGLBSync(c,e,n,r.glb),assert$1(c.type==="glTF",`Invalid GLB magic string ${c.type}`),t._glb=c,t.json=c.json}else assert$1(!1,"GLTF: must be ArrayBuffer or string");const s=t.json.buffers||[];if(t.buffers=new Array(s.length).fill(null),t._glb&&t._glb.header.hasBinChunk){const{binChunks:c}=t._glb;t.buffers[0]={arrayBuffer:c[0].arrayBuffer,byteOffset:c[0].byteOffset,byteLength:c[0].byteLength}}const o=t.json.images||[];t.images=new Array(o.length).fill({})}async function loadBuffers(t,e,n){const r=t.json.buffers||[];for(let s=0;s<r.length;++s){const o=r[s];if(o.uri){const{fetch:c}=n;assert$1(c);const d=resolveUrl(o.uri,e),T=await(await n?.fetch?.(d))?.arrayBuffer?.();t.buffers[s]={arrayBuffer:T,byteOffset:0,byteLength:T.byteLength},delete o.uri}else t.buffers[s]===null&&(t.buffers[s]={arrayBuffer:new ArrayBuffer(o.byteLength),byteOffset:0,byteLength:o.byteLength})}}async function loadImages(t,e,n){const r=getReferencesImageIndices(t),s=t.json.images||[],o=[];for(const c of r)o.push(loadImage(t,s[c],c,e,n));return await Promise.all(o)}function getReferencesImageIndices(t){const e=new Set,n=t.json.textures||[];for(const r of n)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function loadImage(t,e,n,r,s){let o;if(e.uri&&!e.hasOwnProperty("bufferView")){const d=resolveUrl(e.uri,r),{fetch:p}=s;o=await(await p(d)).arrayBuffer(),e.bufferView={data:o}}if(Number.isFinite(e.bufferView)){const d=getTypedArrayForBufferView(t.json,t.buffers,e.bufferView);o=sliceArrayBuffer(d.buffer,d.byteOffset,d.byteLength)}assert$1(o,"glTF image has no data");let c=await parseFromContext(o,[ImageLoader,BasisLoader],{...r,mimeType:e.mimeType,basis:r.basis||{format:selectSupportedBasisFormat()}},s);c&&c[0]&&(c={compressed:!0,mipmaps:!1,width:c[0].width,height:c[0].height,data:c[0]}),t.images=t.images||[],t.images[n]=c}const GLTFLoader={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:VERSION$2,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function parse(t,e={},n){e={...GLTFLoader.options,...e},e.gltf={...GLTFLoader.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await parseGLTF({},t,r,e,n)}function wrapConstructor(t,e){return class extends t{constructor(...n){super(...n),e(this)}}}const ZeroArray=wrapConstructor(Array,t=>t.fill(0));let EPSILON=1e-6;function getAPIImpl$5(t){function e(C=0,b=0){const w=new t(2);return C!==void 0&&(w[0]=C,b!==void 0&&(w[1]=b)),w}const n=e;function r(C,b,w){const i=w??new t(2);return i[0]=C,i[1]=b,i}function s(C,b){const w=b??new t(2);return w[0]=Math.ceil(C[0]),w[1]=Math.ceil(C[1]),w}function o(C,b){const w=b??new t(2);return w[0]=Math.floor(C[0]),w[1]=Math.floor(C[1]),w}function c(C,b){const w=b??new t(2);return w[0]=Math.round(C[0]),w[1]=Math.round(C[1]),w}function d(C,b=0,w=1,i){const g=i??new t(2);return g[0]=Math.min(w,Math.max(b,C[0])),g[1]=Math.min(w,Math.max(b,C[1])),g}function p(C,b,w){const i=w??new t(2);return i[0]=C[0]+b[0],i[1]=C[1]+b[1],i}function T(C,b,w,i){const g=i??new t(2);return g[0]=C[0]+b[0]*w,g[1]=C[1]+b[1]*w,g}function I(C,b){const w=C[0],i=C[1],g=b[0],f=b[1],h=Math.sqrt(w*w+i*i),u=Math.sqrt(g*g+f*f),A=h*u,y=A&&Te(C,b)/A;return Math.acos(y)}function D(C,b,w){const i=w??new t(2);return i[0]=C[0]-b[0],i[1]=C[1]-b[1],i}const x=D;function G(C,b){return Math.abs(C[0]-b[0])<EPSILON&&Math.abs(C[1]-b[1])<EPSILON}function P(C,b){return C[0]===b[0]&&C[1]===b[1]}function U(C,b,w,i){const g=i??new t(2);return g[0]=C[0]+w*(b[0]-C[0]),g[1]=C[1]+w*(b[1]-C[1]),g}function H(C,b,w,i){const g=i??new t(2);return g[0]=C[0]+w[0]*(b[0]-C[0]),g[1]=C[1]+w[1]*(b[1]-C[1]),g}function X(C,b,w){const i=w??new t(2);return i[0]=Math.max(C[0],b[0]),i[1]=Math.max(C[1],b[1]),i}function j(C,b,w){const i=w??new t(2);return i[0]=Math.min(C[0],b[0]),i[1]=Math.min(C[1],b[1]),i}function K(C,b,w){const i=w??new t(2);return i[0]=C[0]*b,i[1]=C[1]*b,i}const q=K;function te(C,b,w){const i=w??new t(2);return i[0]=C[0]/b,i[1]=C[1]/b,i}function Ce(C,b){const w=b??new t(2);return w[0]=1/C[0],w[1]=1/C[1],w}const Se=Ce;function be(C,b,w){const i=w??new t(3),g=C[0]*b[1]-C[1]*b[0];return i[0]=0,i[1]=0,i[2]=g,i}function Te(C,b){return C[0]*b[0]+C[1]*b[1]}function oe(C){const b=C[0],w=C[1];return Math.sqrt(b*b+w*w)}const ve=oe;function Ae(C){const b=C[0],w=C[1];return b*b+w*w}const xe=Ae;function ae(C,b){const w=C[0]-b[0],i=C[1]-b[1];return Math.sqrt(w*w+i*i)}const Q=ae;function W(C,b){const w=C[0]-b[0],i=C[1]-b[1];return w*w+i*i}const Y=W;function me(C,b){const w=b??new t(2),i=C[0],g=C[1],f=Math.sqrt(i*i+g*g);return f>1e-5?(w[0]=i/f,w[1]=g/f):(w[0]=0,w[1]=0),w}function Fe(C,b){const w=b??new t(2);return w[0]=-C[0],w[1]=-C[1],w}function ee(C,b){const w=b??new t(2);return w[0]=C[0],w[1]=C[1],w}const Ge=ee;function Ee(C,b,w){const i=w??new t(2);return i[0]=C[0]*b[0],i[1]=C[1]*b[1],i}const Le=Ee;function ye(C,b,w){const i=w??new t(2);return i[0]=C[0]/b[0],i[1]=C[1]/b[1],i}const De=ye;function Re(C=1,b){const w=b??new t(2),i=Math.random()*2*Math.PI;return w[0]=Math.cos(i)*C,w[1]=Math.sin(i)*C,w}function M(C){const b=C??new t(2);return b[0]=0,b[1]=0,b}function F(C,b,w){const i=w??new t(2),g=C[0],f=C[1];return i[0]=g*b[0]+f*b[4]+b[12],i[1]=g*b[1]+f*b[5]+b[13],i}function E(C,b,w){const i=w??new t(2),g=C[0],f=C[1];return i[0]=b[0]*g+b[4]*f+b[8],i[1]=b[1]*g+b[5]*f+b[9],i}function a(C,b,w,i){const g=i??new t(2),f=C[0]-b[0],h=C[1]-b[1],u=Math.sin(w),A=Math.cos(w);return g[0]=f*A-h*u+b[0],g[1]=f*u+h*A+b[1],g}function m(C,b,w){const i=w??new t(2);return me(C,i),K(i,b,i)}function l(C,b,w){const i=w??new t(2);return oe(C)>b?m(C,b,i):ee(C,i)}function B(C,b,w){const i=w??new t(2);return U(C,b,.5,i)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:p,addScaled:T,angle:I,subtract:D,sub:x,equalsApproximately:G,equals:P,lerp:U,lerpV:H,max:X,min:j,mulScalar:K,scale:q,divScalar:te,inverse:Ce,invert:Se,cross:be,dot:Te,length:oe,len:ve,lengthSq:Ae,lenSq:xe,distance:ae,dist:Q,distanceSq:W,distSq:Y,normalize:me,negate:Fe,copy:ee,clone:Ge,multiply:Ee,mul:Le,divide:ye,div:De,random:Re,zero:M,transformMat4:F,transformMat3:E,rotate:a,setLength:m,truncate:l,midpoint:B}}const cache$5=new Map;function getAPI$5(t){let e=cache$5.get(t);return e||(e=getAPIImpl$5(t),cache$5.set(t,e)),e}function getAPIImpl$4(t){function e(u,A,y){const _=new t(3);return u!==void 0&&(_[0]=u,A!==void 0&&(_[1]=A,y!==void 0&&(_[2]=y))),_}const n=e;function r(u,A,y,_){const S=_??new t(3);return S[0]=u,S[1]=A,S[2]=y,S}function s(u,A){const y=A??new t(3);return y[0]=Math.ceil(u[0]),y[1]=Math.ceil(u[1]),y[2]=Math.ceil(u[2]),y}function o(u,A){const y=A??new t(3);return y[0]=Math.floor(u[0]),y[1]=Math.floor(u[1]),y[2]=Math.floor(u[2]),y}function c(u,A){const y=A??new t(3);return y[0]=Math.round(u[0]),y[1]=Math.round(u[1]),y[2]=Math.round(u[2]),y}function d(u,A=0,y=1,_){const S=_??new t(3);return S[0]=Math.min(y,Math.max(A,u[0])),S[1]=Math.min(y,Math.max(A,u[1])),S[2]=Math.min(y,Math.max(A,u[2])),S}function p(u,A,y){const _=y??new t(3);return _[0]=u[0]+A[0],_[1]=u[1]+A[1],_[2]=u[2]+A[2],_}function T(u,A,y,_){const S=_??new t(3);return S[0]=u[0]+A[0]*y,S[1]=u[1]+A[1]*y,S[2]=u[2]+A[2]*y,S}function I(u,A){const y=u[0],_=u[1],S=u[2],R=A[0],v=A[1],N=A[2],L=Math.sqrt(y*y+_*_+S*S),O=Math.sqrt(R*R+v*v+N*N),k=L*O,$=k&&Te(u,A)/k;return Math.acos($)}function D(u,A,y){const _=y??new t(3);return _[0]=u[0]-A[0],_[1]=u[1]-A[1],_[2]=u[2]-A[2],_}const x=D;function G(u,A){return Math.abs(u[0]-A[0])<EPSILON&&Math.abs(u[1]-A[1])<EPSILON&&Math.abs(u[2]-A[2])<EPSILON}function P(u,A){return u[0]===A[0]&&u[1]===A[1]&&u[2]===A[2]}function U(u,A,y,_){const S=_??new t(3);return S[0]=u[0]+y*(A[0]-u[0]),S[1]=u[1]+y*(A[1]-u[1]),S[2]=u[2]+y*(A[2]-u[2]),S}function H(u,A,y,_){const S=_??new t(3);return S[0]=u[0]+y[0]*(A[0]-u[0]),S[1]=u[1]+y[1]*(A[1]-u[1]),S[2]=u[2]+y[2]*(A[2]-u[2]),S}function X(u,A,y){const _=y??new t(3);return _[0]=Math.max(u[0],A[0]),_[1]=Math.max(u[1],A[1]),_[2]=Math.max(u[2],A[2]),_}function j(u,A,y){const _=y??new t(3);return _[0]=Math.min(u[0],A[0]),_[1]=Math.min(u[1],A[1]),_[2]=Math.min(u[2],A[2]),_}function K(u,A,y){const _=y??new t(3);return _[0]=u[0]*A,_[1]=u[1]*A,_[2]=u[2]*A,_}const q=K;function te(u,A,y){const _=y??new t(3);return _[0]=u[0]/A,_[1]=u[1]/A,_[2]=u[2]/A,_}function Ce(u,A){const y=A??new t(3);return y[0]=1/u[0],y[1]=1/u[1],y[2]=1/u[2],y}const Se=Ce;function be(u,A,y){const _=y??new t(3),S=u[2]*A[0]-u[0]*A[2],R=u[0]*A[1]-u[1]*A[0];return _[0]=u[1]*A[2]-u[2]*A[1],_[1]=S,_[2]=R,_}function Te(u,A){return u[0]*A[0]+u[1]*A[1]+u[2]*A[2]}function oe(u){const A=u[0],y=u[1],_=u[2];return Math.sqrt(A*A+y*y+_*_)}const ve=oe;function Ae(u){const A=u[0],y=u[1],_=u[2];return A*A+y*y+_*_}const xe=Ae;function ae(u,A){const y=u[0]-A[0],_=u[1]-A[1],S=u[2]-A[2];return Math.sqrt(y*y+_*_+S*S)}const Q=ae;function W(u,A){const y=u[0]-A[0],_=u[1]-A[1],S=u[2]-A[2];return y*y+_*_+S*S}const Y=W;function me(u,A){const y=A??new t(3),_=u[0],S=u[1],R=u[2],v=Math.sqrt(_*_+S*S+R*R);return v>1e-5?(y[0]=_/v,y[1]=S/v,y[2]=R/v):(y[0]=0,y[1]=0,y[2]=0),y}function Fe(u,A){const y=A??new t(3);return y[0]=-u[0],y[1]=-u[1],y[2]=-u[2],y}function ee(u,A){const y=A??new t(3);return y[0]=u[0],y[1]=u[1],y[2]=u[2],y}const Ge=ee;function Ee(u,A,y){const _=y??new t(3);return _[0]=u[0]*A[0],_[1]=u[1]*A[1],_[2]=u[2]*A[2],_}const Le=Ee;function ye(u,A,y){const _=y??new t(3);return _[0]=u[0]/A[0],_[1]=u[1]/A[1],_[2]=u[2]/A[2],_}const De=ye;function Re(u=1,A){const y=A??new t(3),_=Math.random()*2*Math.PI,S=Math.random()*2-1,R=Math.sqrt(1-S*S)*u;return y[0]=Math.cos(_)*R,y[1]=Math.sin(_)*R,y[2]=S*u,y}function M(u){const A=u??new t(3);return A[0]=0,A[1]=0,A[2]=0,A}function F(u,A,y){const _=y??new t(3),S=u[0],R=u[1],v=u[2],N=A[3]*S+A[7]*R+A[11]*v+A[15]||1;return _[0]=(A[0]*S+A[4]*R+A[8]*v+A[12])/N,_[1]=(A[1]*S+A[5]*R+A[9]*v+A[13])/N,_[2]=(A[2]*S+A[6]*R+A[10]*v+A[14])/N,_}function E(u,A,y){const _=y??new t(3),S=u[0],R=u[1],v=u[2];return _[0]=S*A[0]+R*A[4]+v*A[8],_[1]=S*A[1]+R*A[5]+v*A[9],_[2]=S*A[2]+R*A[6]+v*A[10],_}function a(u,A,y){const _=y??new t(3),S=u[0],R=u[1],v=u[2];return _[0]=S*A[0]+R*A[4]+v*A[8],_[1]=S*A[1]+R*A[5]+v*A[9],_[2]=S*A[2]+R*A[6]+v*A[10],_}function m(u,A,y){const _=y??new t(3),S=A[0],R=A[1],v=A[2],N=A[3]*2,L=u[0],O=u[1],k=u[2],$=R*k-v*O,J=v*L-S*k,V=S*O-R*L;return _[0]=L+$*N+(R*V-v*J)*2,_[1]=O+J*N+(v*$-S*V)*2,_[2]=k+V*N+(S*J-R*$)*2,_}function l(u,A){const y=A??new t(3);return y[0]=u[12],y[1]=u[13],y[2]=u[14],y}function B(u,A,y){const _=y??new t(3),S=A*4;return _[0]=u[S+0],_[1]=u[S+1],_[2]=u[S+2],_}function C(u,A){const y=A??new t(3),_=u[0],S=u[1],R=u[2],v=u[4],N=u[5],L=u[6],O=u[8],k=u[9],$=u[10];return y[0]=Math.sqrt(_*_+S*S+R*R),y[1]=Math.sqrt(v*v+N*N+L*L),y[2]=Math.sqrt(O*O+k*k+$*$),y}function b(u,A,y,_){const S=_??new t(3),R=[],v=[];return R[0]=u[0]-A[0],R[1]=u[1]-A[1],R[2]=u[2]-A[2],v[0]=R[0],v[1]=R[1]*Math.cos(y)-R[2]*Math.sin(y),v[2]=R[1]*Math.sin(y)+R[2]*Math.cos(y),S[0]=v[0]+A[0],S[1]=v[1]+A[1],S[2]=v[2]+A[2],S}function w(u,A,y,_){const S=_??new t(3),R=[],v=[];return R[0]=u[0]-A[0],R[1]=u[1]-A[1],R[2]=u[2]-A[2],v[0]=R[2]*Math.sin(y)+R[0]*Math.cos(y),v[1]=R[1],v[2]=R[2]*Math.cos(y)-R[0]*Math.sin(y),S[0]=v[0]+A[0],S[1]=v[1]+A[1],S[2]=v[2]+A[2],S}function i(u,A,y,_){const S=_??new t(3),R=[],v=[];return R[0]=u[0]-A[0],R[1]=u[1]-A[1],R[2]=u[2]-A[2],v[0]=R[0]*Math.cos(y)-R[1]*Math.sin(y),v[1]=R[0]*Math.sin(y)+R[1]*Math.cos(y),v[2]=R[2],S[0]=v[0]+A[0],S[1]=v[1]+A[1],S[2]=v[2]+A[2],S}function g(u,A,y){const _=y??new t(3);return me(u,_),K(_,A,_)}function f(u,A,y){const _=y??new t(3);return oe(u)>A?g(u,A,_):ee(u,_)}function h(u,A,y){const _=y??new t(3);return U(u,A,.5,_)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:p,addScaled:T,angle:I,subtract:D,sub:x,equalsApproximately:G,equals:P,lerp:U,lerpV:H,max:X,min:j,mulScalar:K,scale:q,divScalar:te,inverse:Ce,invert:Se,cross:be,dot:Te,length:oe,len:ve,lengthSq:Ae,lenSq:xe,distance:ae,dist:Q,distanceSq:W,distSq:Y,normalize:me,negate:Fe,copy:ee,clone:Ge,multiply:Ee,mul:Le,divide:ye,div:De,random:Re,zero:M,transformMat4:F,transformMat4Upper3x3:E,transformMat3:a,transformQuat:m,getTranslation:l,getAxis:B,getScaling:C,rotateX:b,rotateY:w,rotateZ:i,setLength:g,truncate:f,midpoint:h}}const cache$4=new Map;function getAPI$4(t){let e=cache$4.get(t);return e||(e=getAPIImpl$4(t),cache$4.set(t,e)),e}function getAPIImpl$3(t){const e=getAPI$5(t),n=getAPI$4(t);function r(a,m,l,B,C,b,w,i,g){const f=new t(12);return f[3]=0,f[7]=0,f[11]=0,a!==void 0&&(f[0]=a,m!==void 0&&(f[1]=m,l!==void 0&&(f[2]=l,B!==void 0&&(f[4]=B,C!==void 0&&(f[5]=C,b!==void 0&&(f[6]=b,w!==void 0&&(f[8]=w,i!==void 0&&(f[9]=i,g!==void 0&&(f[10]=g))))))))),f}function s(a,m,l,B,C,b,w,i,g,f){const h=f??new t(12);return h[0]=a,h[1]=m,h[2]=l,h[3]=0,h[4]=B,h[5]=C,h[6]=b,h[7]=0,h[8]=w,h[9]=i,h[10]=g,h[11]=0,h}function o(a,m){const l=m??new t(12);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=0,l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=0,l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=0,l}function c(a,m){const l=m??new t(12),B=a[0],C=a[1],b=a[2],w=a[3],i=B+B,g=C+C,f=b+b,h=B*i,u=C*i,A=C*g,y=b*i,_=b*g,S=b*f,R=w*i,v=w*g,N=w*f;return l[0]=1-A-S,l[1]=u+N,l[2]=y-v,l[3]=0,l[4]=u-N,l[5]=1-h-S,l[6]=_+R,l[7]=0,l[8]=y+v,l[9]=_-R,l[10]=1-h-A,l[11]=0,l}function d(a,m){const l=m??new t(12);return l[0]=-a[0],l[1]=-a[1],l[2]=-a[2],l[4]=-a[4],l[5]=-a[5],l[6]=-a[6],l[8]=-a[8],l[9]=-a[9],l[10]=-a[10],l}function p(a,m,l){const B=l??new t(12);return B[0]=a[0]*m,B[1]=a[1]*m,B[2]=a[2]*m,B[4]=a[4]*m,B[5]=a[5]*m,B[6]=a[6]*m,B[8]=a[8]*m,B[9]=a[9]*m,B[10]=a[10]*m,B}const T=p;function I(a,m,l){const B=l??new t(12);return B[0]=a[0]+m[0],B[1]=a[1]+m[1],B[2]=a[2]+m[2],B[4]=a[4]+m[4],B[5]=a[5]+m[5],B[6]=a[6]+m[6],B[8]=a[8]+m[8],B[9]=a[9]+m[9],B[10]=a[10]+m[10],B}function D(a,m){const l=m??new t(12);return l[0]=a[0],l[1]=a[1],l[2]=a[2],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[8]=a[8],l[9]=a[9],l[10]=a[10],l}const x=D;function G(a,m){return Math.abs(a[0]-m[0])<EPSILON&&Math.abs(a[1]-m[1])<EPSILON&&Math.abs(a[2]-m[2])<EPSILON&&Math.abs(a[4]-m[4])<EPSILON&&Math.abs(a[5]-m[5])<EPSILON&&Math.abs(a[6]-m[6])<EPSILON&&Math.abs(a[8]-m[8])<EPSILON&&Math.abs(a[9]-m[9])<EPSILON&&Math.abs(a[10]-m[10])<EPSILON}function P(a,m){return a[0]===m[0]&&a[1]===m[1]&&a[2]===m[2]&&a[4]===m[4]&&a[5]===m[5]&&a[6]===m[6]&&a[8]===m[8]&&a[9]===m[9]&&a[10]===m[10]}function U(a){const m=a??new t(12);return m[0]=1,m[1]=0,m[2]=0,m[4]=0,m[5]=1,m[6]=0,m[8]=0,m[9]=0,m[10]=1,m}function H(a,m){const l=m??new t(12);if(l===a){let A;return A=a[1],a[1]=a[4],a[4]=A,A=a[2],a[2]=a[8],a[8]=A,A=a[6],a[6]=a[9],a[9]=A,l}const B=a[0],C=a[1],b=a[2],w=a[4],i=a[5],g=a[6],f=a[8],h=a[9],u=a[10];return l[0]=B,l[1]=w,l[2]=f,l[4]=C,l[5]=i,l[6]=h,l[8]=b,l[9]=g,l[10]=u,l}function X(a,m){const l=m??new t(12),B=a[0],C=a[1],b=a[2],w=a[4],i=a[5],g=a[6],f=a[8],h=a[9],u=a[10],A=u*i-g*h,y=-u*w+g*f,_=h*w-i*f,S=1/(B*A+C*y+b*_);return l[0]=A*S,l[1]=(-u*C+b*h)*S,l[2]=(g*C-b*i)*S,l[4]=y*S,l[5]=(u*B-b*f)*S,l[6]=(-g*B+b*w)*S,l[8]=_*S,l[9]=(-h*B+C*f)*S,l[10]=(i*B-C*w)*S,l}function j(a){const m=a[0],l=a[1],B=a[2],C=a[4],b=a[5],w=a[6],i=a[8],g=a[9],f=a[10];return m*(b*f-g*w)-C*(l*f-g*B)+i*(l*w-b*B)}const K=X;function q(a,m,l){const B=l??new t(12),C=a[0],b=a[1],w=a[2],i=a[4],g=a[5],f=a[6],h=a[8],u=a[9],A=a[10],y=m[0],_=m[1],S=m[2],R=m[4],v=m[5],N=m[6],L=m[8],O=m[9],k=m[10];return B[0]=C*y+i*_+h*S,B[1]=b*y+g*_+u*S,B[2]=w*y+f*_+A*S,B[4]=C*R+i*v+h*N,B[5]=b*R+g*v+u*N,B[6]=w*R+f*v+A*N,B[8]=C*L+i*O+h*k,B[9]=b*L+g*O+u*k,B[10]=w*L+f*O+A*k,B}const te=q;function Ce(a,m,l){const B=l??U();return a!==B&&(B[0]=a[0],B[1]=a[1],B[2]=a[2],B[4]=a[4],B[5]=a[5],B[6]=a[6]),B[8]=m[0],B[9]=m[1],B[10]=1,B}function Se(a,m){const l=m??e.create();return l[0]=a[8],l[1]=a[9],l}function be(a,m,l){const B=l??e.create(),C=m*4;return B[0]=a[C+0],B[1]=a[C+1],B}function Te(a,m,l,B){const C=B===a?a:D(a,B),b=l*4;return C[b+0]=m[0],C[b+1]=m[1],C}function oe(a,m){const l=m??e.create(),B=a[0],C=a[1],b=a[4],w=a[5];return l[0]=Math.sqrt(B*B+C*C),l[1]=Math.sqrt(b*b+w*w),l}function ve(a,m){const l=m??n.create(),B=a[0],C=a[1],b=a[2],w=a[4],i=a[5],g=a[6],f=a[8],h=a[9],u=a[10];return l[0]=Math.sqrt(B*B+C*C+b*b),l[1]=Math.sqrt(w*w+i*i+g*g),l[2]=Math.sqrt(f*f+h*h+u*u),l}function Ae(a,m){const l=m??new t(12);return l[0]=1,l[1]=0,l[2]=0,l[4]=0,l[5]=1,l[6]=0,l[8]=a[0],l[9]=a[1],l[10]=1,l}function xe(a,m,l){const B=l??new t(12),C=m[0],b=m[1],w=a[0],i=a[1],g=a[2],f=a[4],h=a[5],u=a[6],A=a[8],y=a[9],_=a[10];return a!==B&&(B[0]=w,B[1]=i,B[2]=g,B[4]=f,B[5]=h,B[6]=u),B[8]=w*C+f*b+A,B[9]=i*C+h*b+y,B[10]=g*C+u*b+_,B}function ae(a,m){const l=m??new t(12),B=Math.cos(a),C=Math.sin(a);return l[0]=B,l[1]=C,l[2]=0,l[4]=-C,l[5]=B,l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function Q(a,m,l){const B=l??new t(12),C=a[0],b=a[1],w=a[2],i=a[4],g=a[5],f=a[6],h=Math.cos(m),u=Math.sin(m);return B[0]=h*C+u*i,B[1]=h*b+u*g,B[2]=h*w+u*f,B[4]=h*i-u*C,B[5]=h*g-u*b,B[6]=h*f-u*w,a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function W(a,m){const l=m??new t(12),B=Math.cos(a),C=Math.sin(a);return l[0]=1,l[1]=0,l[2]=0,l[4]=0,l[5]=B,l[6]=C,l[8]=0,l[9]=-C,l[10]=B,l}function Y(a,m,l){const B=l??new t(12),C=a[4],b=a[5],w=a[6],i=a[8],g=a[9],f=a[10],h=Math.cos(m),u=Math.sin(m);return B[4]=h*C+u*i,B[5]=h*b+u*g,B[6]=h*w+u*f,B[8]=h*i-u*C,B[9]=h*g-u*b,B[10]=h*f-u*w,a!==B&&(B[0]=a[0],B[1]=a[1],B[2]=a[2]),B}function me(a,m){const l=m??new t(12),B=Math.cos(a),C=Math.sin(a);return l[0]=B,l[1]=0,l[2]=-C,l[4]=0,l[5]=1,l[6]=0,l[8]=C,l[9]=0,l[10]=B,l}function Fe(a,m,l){const B=l??new t(12),C=a[0],b=a[1],w=a[2],i=a[8],g=a[9],f=a[10],h=Math.cos(m),u=Math.sin(m);return B[0]=h*C-u*i,B[1]=h*b-u*g,B[2]=h*w-u*f,B[8]=h*i+u*C,B[9]=h*g+u*b,B[10]=h*f+u*w,a!==B&&(B[4]=a[4],B[5]=a[5],B[6]=a[6]),B}const ee=ae,Ge=Q;function Ee(a,m){const l=m??new t(12);return l[0]=a[0],l[1]=0,l[2]=0,l[4]=0,l[5]=a[1],l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function Le(a,m,l){const B=l??new t(12),C=m[0],b=m[1];return B[0]=C*a[0],B[1]=C*a[1],B[2]=C*a[2],B[4]=b*a[4],B[5]=b*a[5],B[6]=b*a[6],a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function ye(a,m){const l=m??new t(12);return l[0]=a[0],l[1]=0,l[2]=0,l[4]=0,l[5]=a[1],l[6]=0,l[8]=0,l[9]=0,l[10]=a[2],l}function De(a,m,l){const B=l??new t(12),C=m[0],b=m[1],w=m[2];return B[0]=C*a[0],B[1]=C*a[1],B[2]=C*a[2],B[4]=b*a[4],B[5]=b*a[5],B[6]=b*a[6],B[8]=w*a[8],B[9]=w*a[9],B[10]=w*a[10],B}function Re(a,m){const l=m??new t(12);return l[0]=a,l[1]=0,l[2]=0,l[4]=0,l[5]=a,l[6]=0,l[8]=0,l[9]=0,l[10]=1,l}function M(a,m,l){const B=l??new t(12);return B[0]=m*a[0],B[1]=m*a[1],B[2]=m*a[2],B[4]=m*a[4],B[5]=m*a[5],B[6]=m*a[6],a!==B&&(B[8]=a[8],B[9]=a[9],B[10]=a[10]),B}function F(a,m){const l=m??new t(12);return l[0]=a,l[1]=0,l[2]=0,l[4]=0,l[5]=a,l[6]=0,l[8]=0,l[9]=0,l[10]=a,l}function E(a,m,l){const B=l??new t(12);return B[0]=m*a[0],B[1]=m*a[1],B[2]=m*a[2],B[4]=m*a[4],B[5]=m*a[5],B[6]=m*a[6],B[8]=m*a[8],B[9]=m*a[9],B[10]=m*a[10],B}return{add:I,clone:x,copy:D,create:r,determinant:j,equals:P,equalsApproximately:G,fromMat4:o,fromQuat:c,get3DScaling:ve,getAxis:be,getScaling:oe,getTranslation:Se,identity:U,inverse:X,invert:K,mul:te,mulScalar:T,multiply:q,multiplyScalar:p,negate:d,rotate:Q,rotateX:Y,rotateY:Fe,rotateZ:Ge,rotation:ae,rotationX:W,rotationY:me,rotationZ:ee,scale:Le,scale3D:De,scaling:Ee,scaling3D:ye,set:s,setAxis:Te,setTranslation:Ce,translate:xe,translation:Ae,transpose:H,uniformScale:M,uniformScale3D:E,uniformScaling:Re,uniformScaling3D:F}}const cache$3=new Map;function getAPI$3(t){let e=cache$3.get(t);return e||(e=getAPIImpl$3(t),cache$3.set(t,e)),e}function getAPIImpl$2(t){const e=getAPI$4(t);function n(i,g,f,h,u,A,y,_,S,R,v,N,L,O,k,$){const J=new t(16);return i!==void 0&&(J[0]=i,g!==void 0&&(J[1]=g,f!==void 0&&(J[2]=f,h!==void 0&&(J[3]=h,u!==void 0&&(J[4]=u,A!==void 0&&(J[5]=A,y!==void 0&&(J[6]=y,_!==void 0&&(J[7]=_,S!==void 0&&(J[8]=S,R!==void 0&&(J[9]=R,v!==void 0&&(J[10]=v,N!==void 0&&(J[11]=N,L!==void 0&&(J[12]=L,O!==void 0&&(J[13]=O,k!==void 0&&(J[14]=k,$!==void 0&&(J[15]=$)))))))))))))))),J}function r(i,g,f,h,u,A,y,_,S,R,v,N,L,O,k,$,J){const V=J??new t(16);return V[0]=i,V[1]=g,V[2]=f,V[3]=h,V[4]=u,V[5]=A,V[6]=y,V[7]=_,V[8]=S,V[9]=R,V[10]=v,V[11]=N,V[12]=L,V[13]=O,V[14]=k,V[15]=$,V}function s(i,g){const f=g??new t(16);return f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=0,f[4]=i[4],f[5]=i[5],f[6]=i[6],f[7]=0,f[8]=i[8],f[9]=i[9],f[10]=i[10],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function o(i,g){const f=g??new t(16),h=i[0],u=i[1],A=i[2],y=i[3],_=h+h,S=u+u,R=A+A,v=h*_,N=u*_,L=u*S,O=A*_,k=A*S,$=A*R,J=y*_,V=y*S,Z=y*R;return f[0]=1-L-$,f[1]=N+Z,f[2]=O-V,f[3]=0,f[4]=N-Z,f[5]=1-v-$,f[6]=k+J,f[7]=0,f[8]=O+V,f[9]=k-J,f[10]=1-v-L,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function c(i,g){const f=g??new t(16);return f[0]=-i[0],f[1]=-i[1],f[2]=-i[2],f[3]=-i[3],f[4]=-i[4],f[5]=-i[5],f[6]=-i[6],f[7]=-i[7],f[8]=-i[8],f[9]=-i[9],f[10]=-i[10],f[11]=-i[11],f[12]=-i[12],f[13]=-i[13],f[14]=-i[14],f[15]=-i[15],f}function d(i,g,f){const h=f??new t(16);return h[0]=i[0]+g[0],h[1]=i[1]+g[1],h[2]=i[2]+g[2],h[3]=i[3]+g[3],h[4]=i[4]+g[4],h[5]=i[5]+g[5],h[6]=i[6]+g[6],h[7]=i[7]+g[7],h[8]=i[8]+g[8],h[9]=i[9]+g[9],h[10]=i[10]+g[10],h[11]=i[11]+g[11],h[12]=i[12]+g[12],h[13]=i[13]+g[13],h[14]=i[14]+g[14],h[15]=i[15]+g[15],h}function p(i,g,f){const h=f??new t(16);return h[0]=i[0]*g,h[1]=i[1]*g,h[2]=i[2]*g,h[3]=i[3]*g,h[4]=i[4]*g,h[5]=i[5]*g,h[6]=i[6]*g,h[7]=i[7]*g,h[8]=i[8]*g,h[9]=i[9]*g,h[10]=i[10]*g,h[11]=i[11]*g,h[12]=i[12]*g,h[13]=i[13]*g,h[14]=i[14]*g,h[15]=i[15]*g,h}const T=p;function I(i,g){const f=g??new t(16);return f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=i[3],f[4]=i[4],f[5]=i[5],f[6]=i[6],f[7]=i[7],f[8]=i[8],f[9]=i[9],f[10]=i[10],f[11]=i[11],f[12]=i[12],f[13]=i[13],f[14]=i[14],f[15]=i[15],f}const D=I;function x(i,g){return Math.abs(i[0]-g[0])<EPSILON&&Math.abs(i[1]-g[1])<EPSILON&&Math.abs(i[2]-g[2])<EPSILON&&Math.abs(i[3]-g[3])<EPSILON&&Math.abs(i[4]-g[4])<EPSILON&&Math.abs(i[5]-g[5])<EPSILON&&Math.abs(i[6]-g[6])<EPSILON&&Math.abs(i[7]-g[7])<EPSILON&&Math.abs(i[8]-g[8])<EPSILON&&Math.abs(i[9]-g[9])<EPSILON&&Math.abs(i[10]-g[10])<EPSILON&&Math.abs(i[11]-g[11])<EPSILON&&Math.abs(i[12]-g[12])<EPSILON&&Math.abs(i[13]-g[13])<EPSILON&&Math.abs(i[14]-g[14])<EPSILON&&Math.abs(i[15]-g[15])<EPSILON}function G(i,g){return i[0]===g[0]&&i[1]===g[1]&&i[2]===g[2]&&i[3]===g[3]&&i[4]===g[4]&&i[5]===g[5]&&i[6]===g[6]&&i[7]===g[7]&&i[8]===g[8]&&i[9]===g[9]&&i[10]===g[10]&&i[11]===g[11]&&i[12]===g[12]&&i[13]===g[13]&&i[14]===g[14]&&i[15]===g[15]}function P(i){const g=i??new t(16);return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function U(i,g){const f=g??new t(16);if(f===i){let z;return z=i[1],i[1]=i[4],i[4]=z,z=i[2],i[2]=i[8],i[8]=z,z=i[3],i[3]=i[12],i[12]=z,z=i[6],i[6]=i[9],i[9]=z,z=i[7],i[7]=i[13],i[13]=z,z=i[11],i[11]=i[14],i[14]=z,f}const h=i[0],u=i[1],A=i[2],y=i[3],_=i[4],S=i[5],R=i[6],v=i[7],N=i[8],L=i[9],O=i[10],k=i[11],$=i[12],J=i[13],V=i[14],Z=i[15];return f[0]=h,f[1]=_,f[2]=N,f[3]=$,f[4]=u,f[5]=S,f[6]=L,f[7]=J,f[8]=A,f[9]=R,f[10]=O,f[11]=V,f[12]=y,f[13]=v,f[14]=k,f[15]=Z,f}function H(i,g){const f=g??new t(16),h=i[0],u=i[1],A=i[2],y=i[3],_=i[4],S=i[5],R=i[6],v=i[7],N=i[8],L=i[9],O=i[10],k=i[11],$=i[12],J=i[13],V=i[14],Z=i[15],z=O*Z,ne=V*k,re=R*Z,se=V*v,ie=R*k,ce=O*v,ue=A*Z,fe=V*y,le=A*k,de=O*y,ge=A*v,pe=R*y,Be=N*J,_e=$*L,we=_*J,Ie=$*S,Me=_*L,Oe=N*S,Pe=h*J,Ue=$*u,Ne=h*L,He=N*u,ke=h*S,Je=_*u,Ke=z*S+se*L+ie*J-(ne*S+re*L+ce*J),Ve=ne*u+ue*L+de*J-(z*u+fe*L+le*J),Xe=re*u+fe*S+ge*J-(se*u+ue*S+pe*J),$e=ce*u+le*S+pe*L-(ie*u+de*S+ge*L),he=1/(h*Ke+_*Ve+N*Xe+$*$e);return f[0]=he*Ke,f[1]=he*Ve,f[2]=he*Xe,f[3]=he*$e,f[4]=he*(ne*_+re*N+ce*$-(z*_+se*N+ie*$)),f[5]=he*(z*h+fe*N+le*$-(ne*h+ue*N+de*$)),f[6]=he*(se*h+ue*_+pe*$-(re*h+fe*_+ge*$)),f[7]=he*(ie*h+de*_+ge*N-(ce*h+le*_+pe*N)),f[8]=he*(Be*v+Ie*k+Me*Z-(_e*v+we*k+Oe*Z)),f[9]=he*(_e*y+Pe*k+He*Z-(Be*y+Ue*k+Ne*Z)),f[10]=he*(we*y+Ue*v+ke*Z-(Ie*y+Pe*v+Je*Z)),f[11]=he*(Oe*y+Ne*v+Je*k-(Me*y+He*v+ke*k)),f[12]=he*(we*O+Oe*V+_e*R-(Me*V+Be*R+Ie*O)),f[13]=he*(Ne*V+Be*A+Ue*O-(Pe*O+He*V+_e*A)),f[14]=he*(Pe*R+Je*V+Ie*A-(ke*V+we*A+Ue*R)),f[15]=he*(ke*O+Me*A+He*R-(Ne*R+Je*O+Oe*A)),f}function X(i){const g=i[0],f=i[1],h=i[2],u=i[3],A=i[4],y=i[5],_=i[6],S=i[7],R=i[8],v=i[9],N=i[10],L=i[11],O=i[12],k=i[13],$=i[14],J=i[15],V=N*J,Z=$*L,z=_*J,ne=$*S,re=_*L,se=N*S,ie=h*J,ce=$*u,ue=h*L,fe=N*u,le=h*S,de=_*u,ge=V*y+ne*v+re*k-(Z*y+z*v+se*k),pe=Z*f+ie*v+fe*k-(V*f+ce*v+ue*k),Be=z*f+ce*y+le*k-(ne*f+ie*y+de*k),_e=se*f+ue*y+de*v-(re*f+fe*y+le*v);return g*ge+A*pe+R*Be+O*_e}const j=H;function K(i,g,f){const h=f??new t(16),u=i[0],A=i[1],y=i[2],_=i[3],S=i[4],R=i[5],v=i[6],N=i[7],L=i[8],O=i[9],k=i[10],$=i[11],J=i[12],V=i[13],Z=i[14],z=i[15],ne=g[0],re=g[1],se=g[2],ie=g[3],ce=g[4],ue=g[5],fe=g[6],le=g[7],de=g[8],ge=g[9],pe=g[10],Be=g[11],_e=g[12],we=g[13],Ie=g[14],Me=g[15];return h[0]=u*ne+S*re+L*se+J*ie,h[1]=A*ne+R*re+O*se+V*ie,h[2]=y*ne+v*re+k*se+Z*ie,h[3]=_*ne+N*re+$*se+z*ie,h[4]=u*ce+S*ue+L*fe+J*le,h[5]=A*ce+R*ue+O*fe+V*le,h[6]=y*ce+v*ue+k*fe+Z*le,h[7]=_*ce+N*ue+$*fe+z*le,h[8]=u*de+S*ge+L*pe+J*Be,h[9]=A*de+R*ge+O*pe+V*Be,h[10]=y*de+v*ge+k*pe+Z*Be,h[11]=_*de+N*ge+$*pe+z*Be,h[12]=u*_e+S*we+L*Ie+J*Me,h[13]=A*_e+R*we+O*Ie+V*Me,h[14]=y*_e+v*we+k*Ie+Z*Me,h[15]=_*_e+N*we+$*Ie+z*Me,h}const q=K;function te(i,g,f){const h=f??P();return i!==h&&(h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3],h[4]=i[4],h[5]=i[5],h[6]=i[6],h[7]=i[7],h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11]),h[12]=g[0],h[13]=g[1],h[14]=g[2],h[15]=1,h}function Ce(i,g){const f=g??e.create();return f[0]=i[12],f[1]=i[13],f[2]=i[14],f}function Se(i,g,f){const h=f??e.create(),u=g*4;return h[0]=i[u+0],h[1]=i[u+1],h[2]=i[u+2],h}function be(i,g,f,h){const u=h===i?h:I(i,h),A=f*4;return u[A+0]=g[0],u[A+1]=g[1],u[A+2]=g[2],u}function Te(i,g){const f=g??e.create(),h=i[0],u=i[1],A=i[2],y=i[4],_=i[5],S=i[6],R=i[8],v=i[9],N=i[10];return f[0]=Math.sqrt(h*h+u*u+A*A),f[1]=Math.sqrt(y*y+_*_+S*S),f[2]=Math.sqrt(R*R+v*v+N*N),f}function oe(i,g,f,h,u){const A=u??new t(16),y=Math.tan(Math.PI*.5-.5*i);if(A[0]=y/g,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=y,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,Number.isFinite(h)){const _=1/(f-h);A[10]=h*_,A[14]=h*f*_}else A[10]=-1,A[14]=-f;return A}function ve(i,g,f,h=1/0,u){const A=u??new t(16),y=1/Math.tan(i*.5);if(A[0]=y/g,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=y,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,h===1/0)A[10]=0,A[14]=f;else{const _=1/(h-f);A[10]=f*_,A[14]=h*f*_}return A}function Ae(i,g,f,h,u,A,y){const _=y??new t(16);return _[0]=2/(g-i),_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2/(h-f),_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1/(u-A),_[11]=0,_[12]=(g+i)/(i-g),_[13]=(h+f)/(f-h),_[14]=u/(u-A),_[15]=1,_}function xe(i,g,f,h,u,A,y){const _=y??new t(16),S=g-i,R=h-f,v=u-A;return _[0]=2*u/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*u/R,_[6]=0,_[7]=0,_[8]=(i+g)/S,_[9]=(h+f)/R,_[10]=A/v,_[11]=-1,_[12]=0,_[13]=0,_[14]=u*A/v,_[15]=0,_}function ae(i,g,f,h,u,A=1/0,y){const _=y??new t(16),S=g-i,R=h-f;if(_[0]=2*u/S,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*u/R,_[6]=0,_[7]=0,_[8]=(i+g)/S,_[9]=(h+f)/R,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,A===1/0)_[10]=0,_[14]=u;else{const v=1/(A-u);_[10]=u*v,_[14]=A*u*v}return _}const Q=e.create(),W=e.create(),Y=e.create();function me(i,g,f,h){const u=h??new t(16);return e.normalize(e.subtract(g,i,Y),Y),e.normalize(e.cross(f,Y,Q),Q),e.normalize(e.cross(Y,Q,W),W),u[0]=Q[0],u[1]=Q[1],u[2]=Q[2],u[3]=0,u[4]=W[0],u[5]=W[1],u[6]=W[2],u[7]=0,u[8]=Y[0],u[9]=Y[1],u[10]=Y[2],u[11]=0,u[12]=i[0],u[13]=i[1],u[14]=i[2],u[15]=1,u}function Fe(i,g,f,h){const u=h??new t(16);return e.normalize(e.subtract(i,g,Y),Y),e.normalize(e.cross(f,Y,Q),Q),e.normalize(e.cross(Y,Q,W),W),u[0]=Q[0],u[1]=Q[1],u[2]=Q[2],u[3]=0,u[4]=W[0],u[5]=W[1],u[6]=W[2],u[7]=0,u[8]=Y[0],u[9]=Y[1],u[10]=Y[2],u[11]=0,u[12]=i[0],u[13]=i[1],u[14]=i[2],u[15]=1,u}function ee(i,g,f,h){const u=h??new t(16);return e.normalize(e.subtract(i,g,Y),Y),e.normalize(e.cross(f,Y,Q),Q),e.normalize(e.cross(Y,Q,W),W),u[0]=Q[0],u[1]=W[0],u[2]=Y[0],u[3]=0,u[4]=Q[1],u[5]=W[1],u[6]=Y[1],u[7]=0,u[8]=Q[2],u[9]=W[2],u[10]=Y[2],u[11]=0,u[12]=-(Q[0]*i[0]+Q[1]*i[1]+Q[2]*i[2]),u[13]=-(W[0]*i[0]+W[1]*i[1]+W[2]*i[2]),u[14]=-(Y[0]*i[0]+Y[1]*i[1]+Y[2]*i[2]),u[15]=1,u}function Ge(i,g){const f=g??new t(16);return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=i[0],f[13]=i[1],f[14]=i[2],f[15]=1,f}function Ee(i,g,f){const h=f??new t(16),u=g[0],A=g[1],y=g[2],_=i[0],S=i[1],R=i[2],v=i[3],N=i[4],L=i[5],O=i[6],k=i[7],$=i[8],J=i[9],V=i[10],Z=i[11],z=i[12],ne=i[13],re=i[14],se=i[15];return i!==h&&(h[0]=_,h[1]=S,h[2]=R,h[3]=v,h[4]=N,h[5]=L,h[6]=O,h[7]=k,h[8]=$,h[9]=J,h[10]=V,h[11]=Z),h[12]=_*u+N*A+$*y+z,h[13]=S*u+L*A+J*y+ne,h[14]=R*u+O*A+V*y+re,h[15]=v*u+k*A+Z*y+se,h}function Le(i,g){const f=g??new t(16),h=Math.cos(i),u=Math.sin(i);return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=h,f[6]=u,f[7]=0,f[8]=0,f[9]=-u,f[10]=h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function ye(i,g,f){const h=f??new t(16),u=i[4],A=i[5],y=i[6],_=i[7],S=i[8],R=i[9],v=i[10],N=i[11],L=Math.cos(g),O=Math.sin(g);return h[4]=L*u+O*S,h[5]=L*A+O*R,h[6]=L*y+O*v,h[7]=L*_+O*N,h[8]=L*S-O*u,h[9]=L*R-O*A,h[10]=L*v-O*y,h[11]=L*N-O*_,i!==h&&(h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function De(i,g){const f=g??new t(16),h=Math.cos(i),u=Math.sin(i);return f[0]=h,f[1]=0,f[2]=-u,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=u,f[9]=0,f[10]=h,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Re(i,g,f){const h=f??new t(16),u=i[0],A=i[1],y=i[2],_=i[3],S=i[8],R=i[9],v=i[10],N=i[11],L=Math.cos(g),O=Math.sin(g);return h[0]=L*u-O*S,h[1]=L*A-O*R,h[2]=L*y-O*v,h[3]=L*_-O*N,h[8]=L*S+O*u,h[9]=L*R+O*A,h[10]=L*v+O*y,h[11]=L*N+O*_,i!==h&&(h[4]=i[4],h[5]=i[5],h[6]=i[6],h[7]=i[7],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function M(i,g){const f=g??new t(16),h=Math.cos(i),u=Math.sin(i);return f[0]=h,f[1]=u,f[2]=0,f[3]=0,f[4]=-u,f[5]=h,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function F(i,g,f){const h=f??new t(16),u=i[0],A=i[1],y=i[2],_=i[3],S=i[4],R=i[5],v=i[6],N=i[7],L=Math.cos(g),O=Math.sin(g);return h[0]=L*u+O*S,h[1]=L*A+O*R,h[2]=L*y+O*v,h[3]=L*_+O*N,h[4]=L*S-O*u,h[5]=L*R-O*A,h[6]=L*v-O*y,h[7]=L*N-O*_,i!==h&&(h[8]=i[8],h[9]=i[9],h[10]=i[10],h[11]=i[11],h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function E(i,g,f){const h=f??new t(16);let u=i[0],A=i[1],y=i[2];const _=Math.sqrt(u*u+A*A+y*y);u/=_,A/=_,y/=_;const S=u*u,R=A*A,v=y*y,N=Math.cos(g),L=Math.sin(g),O=1-N;return h[0]=S+(1-S)*N,h[1]=u*A*O+y*L,h[2]=u*y*O-A*L,h[3]=0,h[4]=u*A*O-y*L,h[5]=R+(1-R)*N,h[6]=A*y*O+u*L,h[7]=0,h[8]=u*y*O+A*L,h[9]=A*y*O-u*L,h[10]=v+(1-v)*N,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}const a=E;function m(i,g,f,h){const u=h??new t(16);let A=g[0],y=g[1],_=g[2];const S=Math.sqrt(A*A+y*y+_*_);A/=S,y/=S,_/=S;const R=A*A,v=y*y,N=_*_,L=Math.cos(f),O=Math.sin(f),k=1-L,$=R+(1-R)*L,J=A*y*k+_*O,V=A*_*k-y*O,Z=A*y*k-_*O,z=v+(1-v)*L,ne=y*_*k+A*O,re=A*_*k+y*O,se=y*_*k-A*O,ie=N+(1-N)*L,ce=i[0],ue=i[1],fe=i[2],le=i[3],de=i[4],ge=i[5],pe=i[6],Be=i[7],_e=i[8],we=i[9],Ie=i[10],Me=i[11];return u[0]=$*ce+J*de+V*_e,u[1]=$*ue+J*ge+V*we,u[2]=$*fe+J*pe+V*Ie,u[3]=$*le+J*Be+V*Me,u[4]=Z*ce+z*de+ne*_e,u[5]=Z*ue+z*ge+ne*we,u[6]=Z*fe+z*pe+ne*Ie,u[7]=Z*le+z*Be+ne*Me,u[8]=re*ce+se*de+ie*_e,u[9]=re*ue+se*ge+ie*we,u[10]=re*fe+se*pe+ie*Ie,u[11]=re*le+se*Be+ie*Me,i!==u&&(u[12]=i[12],u[13]=i[13],u[14]=i[14],u[15]=i[15]),u}const l=m;function B(i,g){const f=g??new t(16);return f[0]=i[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=i[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=i[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function C(i,g,f){const h=f??new t(16),u=g[0],A=g[1],y=g[2];return h[0]=u*i[0],h[1]=u*i[1],h[2]=u*i[2],h[3]=u*i[3],h[4]=A*i[4],h[5]=A*i[5],h[6]=A*i[6],h[7]=A*i[7],h[8]=y*i[8],h[9]=y*i[9],h[10]=y*i[10],h[11]=y*i[11],i!==h&&(h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}function b(i,g){const f=g??new t(16);return f[0]=i,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=i,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=i,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function w(i,g,f){const h=f??new t(16);return h[0]=g*i[0],h[1]=g*i[1],h[2]=g*i[2],h[3]=g*i[3],h[4]=g*i[4],h[5]=g*i[5],h[6]=g*i[6],h[7]=g*i[7],h[8]=g*i[8],h[9]=g*i[9],h[10]=g*i[10],h[11]=g*i[11],i!==h&&(h[12]=i[12],h[13]=i[13],h[14]=i[14],h[15]=i[15]),h}return{add:d,aim:me,axisRotate:m,axisRotation:E,cameraAim:Fe,clone:D,copy:I,create:n,determinant:X,equals:G,equalsApproximately:x,fromMat3:s,fromQuat:o,frustum:xe,frustumReverseZ:ae,getAxis:Se,getScaling:Te,getTranslation:Ce,identity:P,inverse:H,invert:j,lookAt:ee,mul:q,mulScalar:T,multiply:K,multiplyScalar:p,negate:c,ortho:Ae,perspective:oe,perspectiveReverseZ:ve,rotate:l,rotateX:ye,rotateY:Re,rotateZ:F,rotation:a,rotationX:Le,rotationY:De,rotationZ:M,scale:C,scaling:B,set:r,setAxis:be,setTranslation:te,translate:Ee,translation:Ge,transpose:U,uniformScale:w,uniformScaling:b}}const cache$2=new Map;function getAPI$2(t){let e=cache$2.get(t);return e||(e=getAPIImpl$2(t),cache$2.set(t,e)),e}function getAPIImpl$1(t){const e=getAPI$4(t);function n(M,F,E,a){const m=new t(4);return M!==void 0&&(m[0]=M,F!==void 0&&(m[1]=F,E!==void 0&&(m[2]=E,a!==void 0&&(m[3]=a)))),m}const r=n;function s(M,F,E,a,m){const l=m??new t(4);return l[0]=M,l[1]=F,l[2]=E,l[3]=a,l}function o(M,F,E){const a=E??new t(4),m=F*.5,l=Math.sin(m);return a[0]=l*M[0],a[1]=l*M[1],a[2]=l*M[2],a[3]=Math.cos(m),a}function c(M,F){const E=F??e.create(3),a=Math.acos(M[3])*2,m=Math.sin(a*.5);return m>EPSILON?(E[0]=M[0]/m,E[1]=M[1]/m,E[2]=M[2]/m):(E[0]=1,E[1]=0,E[2]=0),{angle:a,axis:E}}function d(M,F){const E=oe(M,F);return Math.acos(2*E*E-1)}function p(M,F,E){const a=E??new t(4),m=M[0],l=M[1],B=M[2],C=M[3],b=F[0],w=F[1],i=F[2],g=F[3];return a[0]=m*g+C*b+l*i-B*w,a[1]=l*g+C*w+B*b-m*i,a[2]=B*g+C*i+m*w-l*b,a[3]=C*g-m*b-l*w-B*i,a}const T=p;function I(M,F,E){const a=E??new t(4),m=F*.5,l=M[0],B=M[1],C=M[2],b=M[3],w=Math.sin(m),i=Math.cos(m);return a[0]=l*i+b*w,a[1]=B*i+C*w,a[2]=C*i-B*w,a[3]=b*i-l*w,a}function D(M,F,E){const a=E??new t(4),m=F*.5,l=M[0],B=M[1],C=M[2],b=M[3],w=Math.sin(m),i=Math.cos(m);return a[0]=l*i-C*w,a[1]=B*i+b*w,a[2]=C*i+l*w,a[3]=b*i-B*w,a}function x(M,F,E){const a=E??new t(4),m=F*.5,l=M[0],B=M[1],C=M[2],b=M[3],w=Math.sin(m),i=Math.cos(m);return a[0]=l*i+B*w,a[1]=B*i-l*w,a[2]=C*i+b*w,a[3]=b*i-C*w,a}function G(M,F,E,a){const m=a??new t(4),l=M[0],B=M[1],C=M[2],b=M[3];let w=F[0],i=F[1],g=F[2],f=F[3],h=l*w+B*i+C*g+b*f;h<0&&(h=-h,w=-w,i=-i,g=-g,f=-f);let u,A;if(1-h>EPSILON){const y=Math.acos(h),_=Math.sin(y);u=Math.sin((1-E)*y)/_,A=Math.sin(E*y)/_}else u=1-E,A=E;return m[0]=u*l+A*w,m[1]=u*B+A*i,m[2]=u*C+A*g,m[3]=u*b+A*f,m}function P(M,F){const E=F??new t(4),a=M[0],m=M[1],l=M[2],B=M[3],C=a*a+m*m+l*l+B*B,b=C?1/C:0;return E[0]=-a*b,E[1]=-m*b,E[2]=-l*b,E[3]=B*b,E}function U(M,F){const E=F??new t(4);return E[0]=-M[0],E[1]=-M[1],E[2]=-M[2],E[3]=M[3],E}function H(M,F){const E=F??new t(4),a=M[0]+M[5]+M[10];if(a>0){const m=Math.sqrt(a+1);E[3]=.5*m;const l=.5/m;E[0]=(M[6]-M[9])*l,E[1]=(M[8]-M[2])*l,E[2]=(M[1]-M[4])*l}else{let m=0;M[5]>M[0]&&(m=1),M[10]>M[m*4+m]&&(m=2);const l=(m+1)%3,B=(m+2)%3,C=Math.sqrt(M[m*4+m]-M[l*4+l]-M[B*4+B]+1);E[m]=.5*C;const b=.5/C;E[3]=(M[l*4+B]-M[B*4+l])*b,E[l]=(M[l*4+m]+M[m*4+l])*b,E[B]=(M[B*4+m]+M[m*4+B])*b}return E}function X(M,F,E,a,m){const l=m??new t(4),B=M*.5,C=F*.5,b=E*.5,w=Math.sin(B),i=Math.cos(B),g=Math.sin(C),f=Math.cos(C),h=Math.sin(b),u=Math.cos(b);switch(a){case"xyz":l[0]=w*f*u+i*g*h,l[1]=i*g*u-w*f*h,l[2]=i*f*h+w*g*u,l[3]=i*f*u-w*g*h;break;case"xzy":l[0]=w*f*u-i*g*h,l[1]=i*g*u-w*f*h,l[2]=i*f*h+w*g*u,l[3]=i*f*u+w*g*h;break;case"yxz":l[0]=w*f*u+i*g*h,l[1]=i*g*u-w*f*h,l[2]=i*f*h-w*g*u,l[3]=i*f*u+w*g*h;break;case"yzx":l[0]=w*f*u+i*g*h,l[1]=i*g*u+w*f*h,l[2]=i*f*h-w*g*u,l[3]=i*f*u-w*g*h;break;case"zxy":l[0]=w*f*u-i*g*h,l[1]=i*g*u+w*f*h,l[2]=i*f*h+w*g*u,l[3]=i*f*u-w*g*h;break;case"zyx":l[0]=w*f*u-i*g*h,l[1]=i*g*u+w*f*h,l[2]=i*f*h-w*g*u,l[3]=i*f*u+w*g*h;break;default:throw new Error(`Unknown rotation order: ${a}`)}return l}function j(M,F){const E=F??new t(4);return E[0]=M[0],E[1]=M[1],E[2]=M[2],E[3]=M[3],E}const K=j;function q(M,F,E){const a=E??new t(4);return a[0]=M[0]+F[0],a[1]=M[1]+F[1],a[2]=M[2]+F[2],a[3]=M[3]+F[3],a}function te(M,F,E){const a=E??new t(4);return a[0]=M[0]-F[0],a[1]=M[1]-F[1],a[2]=M[2]-F[2],a[3]=M[3]-F[3],a}const Ce=te;function Se(M,F,E){const a=E??new t(4);return a[0]=M[0]*F,a[1]=M[1]*F,a[2]=M[2]*F,a[3]=M[3]*F,a}const be=Se;function Te(M,F,E){const a=E??new t(4);return a[0]=M[0]/F,a[1]=M[1]/F,a[2]=M[2]/F,a[3]=M[3]/F,a}function oe(M,F){return M[0]*F[0]+M[1]*F[1]+M[2]*F[2]+M[3]*F[3]}function ve(M,F,E,a){const m=a??new t(4);return m[0]=M[0]+E*(F[0]-M[0]),m[1]=M[1]+E*(F[1]-M[1]),m[2]=M[2]+E*(F[2]-M[2]),m[3]=M[3]+E*(F[3]-M[3]),m}function Ae(M){const F=M[0],E=M[1],a=M[2],m=M[3];return Math.sqrt(F*F+E*E+a*a+m*m)}const xe=Ae;function ae(M){const F=M[0],E=M[1],a=M[2],m=M[3];return F*F+E*E+a*a+m*m}const Q=ae;function W(M,F){const E=F??new t(4),a=M[0],m=M[1],l=M[2],B=M[3],C=Math.sqrt(a*a+m*m+l*l+B*B);return C>1e-5?(E[0]=a/C,E[1]=m/C,E[2]=l/C,E[3]=B/C):(E[0]=0,E[1]=0,E[2]=0,E[3]=1),E}function Y(M,F){return Math.abs(M[0]-F[0])<EPSILON&&Math.abs(M[1]-F[1])<EPSILON&&Math.abs(M[2]-F[2])<EPSILON&&Math.abs(M[3]-F[3])<EPSILON}function me(M,F){return M[0]===F[0]&&M[1]===F[1]&&M[2]===F[2]&&M[3]===F[3]}function Fe(M){const F=M??new t(4);return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F}const ee=e.create(),Ge=e.create(),Ee=e.create();function Le(M,F,E){const a=E??new t(4),m=e.dot(M,F);return m<-.999999?(e.cross(Ge,M,ee),e.len(ee)<1e-6&&e.cross(Ee,M,ee),e.normalize(ee,ee),o(ee,Math.PI,a),a):m>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(e.cross(M,F,ee),a[0]=ee[0],a[1]=ee[1],a[2]=ee[2],a[3]=1+m,W(a,a))}const ye=new t(4),De=new t(4);function Re(M,F,E,a,m,l){const B=l??new t(4);return G(M,a,m,ye),G(F,E,m,De),G(ye,De,2*m*(1-m),B),B}return{create:n,fromValues:r,set:s,fromAxisAngle:o,toAxisAngle:c,angle:d,multiply:p,mul:T,rotateX:I,rotateY:D,rotateZ:x,slerp:G,inverse:P,conjugate:U,fromMat:H,fromEuler:X,copy:j,clone:K,add:q,subtract:te,sub:Ce,mulScalar:Se,scale:be,divScalar:Te,dot:oe,lerp:ve,length:Ae,len:xe,lengthSq:ae,lenSq:Q,normalize:W,equalsApproximately:Y,equals:me,identity:Fe,rotationTo:Le,sqlerp:Re}}const cache$1=new Map;function getAPI$1(t){let e=cache$1.get(t);return e||(e=getAPIImpl$1(t),cache$1.set(t,e)),e}function getAPIImpl(t){function e(E,a,m,l){const B=new t(4);return E!==void 0&&(B[0]=E,a!==void 0&&(B[1]=a,m!==void 0&&(B[2]=m,l!==void 0&&(B[3]=l)))),B}const n=e;function r(E,a,m,l,B){const C=B??new t(4);return C[0]=E,C[1]=a,C[2]=m,C[3]=l,C}function s(E,a){const m=a??new t(4);return m[0]=Math.ceil(E[0]),m[1]=Math.ceil(E[1]),m[2]=Math.ceil(E[2]),m[3]=Math.ceil(E[3]),m}function o(E,a){const m=a??new t(4);return m[0]=Math.floor(E[0]),m[1]=Math.floor(E[1]),m[2]=Math.floor(E[2]),m[3]=Math.floor(E[3]),m}function c(E,a){const m=a??new t(4);return m[0]=Math.round(E[0]),m[1]=Math.round(E[1]),m[2]=Math.round(E[2]),m[3]=Math.round(E[3]),m}function d(E,a=0,m=1,l){const B=l??new t(4);return B[0]=Math.min(m,Math.max(a,E[0])),B[1]=Math.min(m,Math.max(a,E[1])),B[2]=Math.min(m,Math.max(a,E[2])),B[3]=Math.min(m,Math.max(a,E[3])),B}function p(E,a,m){const l=m??new t(4);return l[0]=E[0]+a[0],l[1]=E[1]+a[1],l[2]=E[2]+a[2],l[3]=E[3]+a[3],l}function T(E,a,m,l){const B=l??new t(4);return B[0]=E[0]+a[0]*m,B[1]=E[1]+a[1]*m,B[2]=E[2]+a[2]*m,B[3]=E[3]+a[3]*m,B}function I(E,a,m){const l=m??new t(4);return l[0]=E[0]-a[0],l[1]=E[1]-a[1],l[2]=E[2]-a[2],l[3]=E[3]-a[3],l}const D=I;function x(E,a){return Math.abs(E[0]-a[0])<EPSILON&&Math.abs(E[1]-a[1])<EPSILON&&Math.abs(E[2]-a[2])<EPSILON&&Math.abs(E[3]-a[3])<EPSILON}function G(E,a){return E[0]===a[0]&&E[1]===a[1]&&E[2]===a[2]&&E[3]===a[3]}function P(E,a,m,l){const B=l??new t(4);return B[0]=E[0]+m*(a[0]-E[0]),B[1]=E[1]+m*(a[1]-E[1]),B[2]=E[2]+m*(a[2]-E[2]),B[3]=E[3]+m*(a[3]-E[3]),B}function U(E,a,m,l){const B=l??new t(4);return B[0]=E[0]+m[0]*(a[0]-E[0]),B[1]=E[1]+m[1]*(a[1]-E[1]),B[2]=E[2]+m[2]*(a[2]-E[2]),B[3]=E[3]+m[3]*(a[3]-E[3]),B}function H(E,a,m){const l=m??new t(4);return l[0]=Math.max(E[0],a[0]),l[1]=Math.max(E[1],a[1]),l[2]=Math.max(E[2],a[2]),l[3]=Math.max(E[3],a[3]),l}function X(E,a,m){const l=m??new t(4);return l[0]=Math.min(E[0],a[0]),l[1]=Math.min(E[1],a[1]),l[2]=Math.min(E[2],a[2]),l[3]=Math.min(E[3],a[3]),l}function j(E,a,m){const l=m??new t(4);return l[0]=E[0]*a,l[1]=E[1]*a,l[2]=E[2]*a,l[3]=E[3]*a,l}const K=j;function q(E,a,m){const l=m??new t(4);return l[0]=E[0]/a,l[1]=E[1]/a,l[2]=E[2]/a,l[3]=E[3]/a,l}function te(E,a){const m=a??new t(4);return m[0]=1/E[0],m[1]=1/E[1],m[2]=1/E[2],m[3]=1/E[3],m}const Ce=te;function Se(E,a){return E[0]*a[0]+E[1]*a[1]+E[2]*a[2]+E[3]*a[3]}function be(E){const a=E[0],m=E[1],l=E[2],B=E[3];return Math.sqrt(a*a+m*m+l*l+B*B)}const Te=be;function oe(E){const a=E[0],m=E[1],l=E[2],B=E[3];return a*a+m*m+l*l+B*B}const ve=oe;function Ae(E,a){const m=E[0]-a[0],l=E[1]-a[1],B=E[2]-a[2],C=E[3]-a[3];return Math.sqrt(m*m+l*l+B*B+C*C)}const xe=Ae;function ae(E,a){const m=E[0]-a[0],l=E[1]-a[1],B=E[2]-a[2],C=E[3]-a[3];return m*m+l*l+B*B+C*C}const Q=ae;function W(E,a){const m=a??new t(4),l=E[0],B=E[1],C=E[2],b=E[3],w=Math.sqrt(l*l+B*B+C*C+b*b);return w>1e-5?(m[0]=l/w,m[1]=B/w,m[2]=C/w,m[3]=b/w):(m[0]=0,m[1]=0,m[2]=0,m[3]=0),m}function Y(E,a){const m=a??new t(4);return m[0]=-E[0],m[1]=-E[1],m[2]=-E[2],m[3]=-E[3],m}function me(E,a){const m=a??new t(4);return m[0]=E[0],m[1]=E[1],m[2]=E[2],m[3]=E[3],m}const Fe=me;function ee(E,a,m){const l=m??new t(4);return l[0]=E[0]*a[0],l[1]=E[1]*a[1],l[2]=E[2]*a[2],l[3]=E[3]*a[3],l}const Ge=ee;function Ee(E,a,m){const l=m??new t(4);return l[0]=E[0]/a[0],l[1]=E[1]/a[1],l[2]=E[2]/a[2],l[3]=E[3]/a[3],l}const Le=Ee;function ye(E){const a=E??new t(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a}function De(E,a,m){const l=m??new t(4),B=E[0],C=E[1],b=E[2],w=E[3];return l[0]=a[0]*B+a[4]*C+a[8]*b+a[12]*w,l[1]=a[1]*B+a[5]*C+a[9]*b+a[13]*w,l[2]=a[2]*B+a[6]*C+a[10]*b+a[14]*w,l[3]=a[3]*B+a[7]*C+a[11]*b+a[15]*w,l}function Re(E,a,m){const l=m??new t(4);return W(E,l),j(l,a,l)}function M(E,a,m){const l=m??new t(4);return be(E)>a?Re(E,a,l):me(E,l)}function F(E,a,m){const l=m??new t(4);return P(E,a,.5,l)}return{create:e,fromValues:n,set:r,ceil:s,floor:o,round:c,clamp:d,add:p,addScaled:T,subtract:I,sub:D,equalsApproximately:x,equals:G,lerp:P,lerpV:U,max:H,min:X,mulScalar:j,scale:K,divScalar:q,inverse:te,invert:Ce,dot:Se,length:be,len:Te,lengthSq:oe,lenSq:ve,distance:Ae,dist:xe,distanceSq:ae,distSq:Q,normalize:W,negate:Y,copy:me,clone:Fe,multiply:ee,mul:Ge,divide:Ee,div:Le,zero:ye,transformMat4:De,setLength:Re,truncate:M,midpoint:F}}const cache=new Map;function getAPI(t){let e=cache.get(t);return e||(e=getAPIImpl(t),cache.set(t,e)),e}function wgpuMatrixAPI(t,e,n,r,s,o){return{mat3:getAPI$3(t),mat4:getAPI$2(e),quat:getAPI$1(n),vec2:getAPI$5(r),vec3:getAPI$4(s),vec4:getAPI(o)}}const{mat4,vec3}=wgpuMatrixAPI(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);wgpuMatrixAPI(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);wgpuMatrixAPI(ZeroArray,Array,Array,Array,Array,Array);function setupLoaders(){registerLoaders([GLTFLoader,ImageLoader])}function getFloatArray(t,e){const n=t.json,r=n.accessors[e],s=n.bufferViews[r.bufferView],o=t.buffers[s.buffer],c=(r.byteOffset??0)+(s.byteOffset??0)+o.byteOffset;return new Float32Array(o.arrayBuffer,c,s.byteLength/4)}class Texture{image;sampler;constructor(e,n){this.image=e,this.sampler=n}}class Material{static nextId=0;id;materialBindGroup;constructor(e,n){this.id=Material.nextId++;const r=n[e.pbrMetallicRoughness.baseColorTexture.index];this.materialBindGroup=device.createBindGroup({label:"material bind group",layout:materialBindGroupLayout,entries:[{binding:0,resource:r.image.createView()},{binding:1,resource:r.sampler}]})}}class Primitive{vertexBuffer;indexBuffer;numIndices=-1;material;constructor(e,n,r){this.material=r;const s=n.json,o=s.accessors[e.indices],c=s.bufferViews[o.bufferView],d=o.componentType,p=n.buffers[c.buffer],T=(o.byteOffset??0)+(c.byteOffset??0)+p.byteOffset;let I;switch(d){case 5123:I=Uint32Array.from(new Uint16Array(p.arrayBuffer,T,o.count));break;case 5125:I=new Uint32Array(p.arrayBuffer,T,o.count);break;default:throw new Error(`unsupported index buffer element component type: 0x${d.toString(16)}`)}const D=getFloatArray(n,e.attributes.POSITION),x=getFloatArray(n,e.attributes.NORMAL),G=getFloatArray(n,e.attributes.TEXCOORD_0),P=8,U=D.length/3,H=new Float32Array(U*P);for(let X=0;X<U;++X){const j=X*P;H[j]=D[X*3],H[j+1]=D[X*3+1],H[j+2]=D[X*3+2],H[j+3]=x[X*3],H[j+4]=x[X*3+1],H[j+5]=x[X*3+2],H[j+6]=G[X*2],H[j+7]=G[X*2+1]}this.indexBuffer=device.createBuffer({label:"index buffer",size:I.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.indexBuffer,0,I),this.vertexBuffer=device.createBuffer({label:"vertex buffer",size:H.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.vertexBuffer,0,H),this.numIndices=I.length}}class Mesh{primitives=[];constructor(e,n,r){e.primitives.forEach(s=>{this.primitives.push(new Primitive(s,n,r[s.material]))}),this.primitives.sort((s,o)=>s.material.id-o.material.id)}}class Node{name="node";parent;children=new Set;transform=mat4.identity();modelMatUniformBuffer;modelBindGroup;mesh;setName(e){this.name=e}setParent(e){this.parent!=null&&this.parent.children.delete(this),this.parent=e,e.children.add(this)}propagateTransformations(){this.parent!=null&&(this.transform=mat4.mul(this.parent.transform,this.transform)),this.mesh!=null&&(this.modelMatUniformBuffer=device.createBuffer({label:"model mat uniform",size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),device.queue.writeBuffer(this.modelMatUniformBuffer,0,this.transform),this.modelBindGroup=device.createBindGroup({label:"model bind group",layout:modelBindGroupLayout,entries:[{binding:0,resource:{buffer:this.modelMatUniformBuffer}}]}));for(let e of this.children)e.propagateTransformations()}}function createTexture(t){let e=device.createTexture({size:[t.width,t.height],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return device.queue.copyExternalImageToTexture({source:t},{texture:e},{width:t.width,height:t.height}),e}function convertWrapModeEnum(t){switch(t){case 10497:return"repeat";case 33071:return"clamp-to-edge";case 33648:return"mirror-repeat";default:throw new Error(`unsupported wrap mode: 0x${t.toString(16)}`)}}function createSampler(t){let e={};switch(t.magFilter){case 9728:e.magFilter="nearest";break;case 9729:e.magFilter="linear";break;default:throw new Error(`unsupported magFilter: 0x${t.magFilter.toString(16)}`)}switch(t.minFilter){case 9728:e.minFilter="nearest";break;case 9729:e.minFilter="linear";break;case 9984:e.minFilter="nearest",e.mipmapFilter="nearest";break;case 9985:e.minFilter="linear",e.mipmapFilter="nearest";break;case 9986:e.minFilter="nearest",e.mipmapFilter="linear";break;case 9987:e.minFilter="linear",e.mipmapFilter="linear";break;default:throw new Error(`unsupported minFilter: 0x${t.minFilter.toString(16)}`)}return e.addressModeU=convertWrapModeEnum(t.wrapS),e.addressModeV=convertWrapModeEnum(t.wrapT),device.createSampler(e)}class Scene{root=new Node;constructor(){this.root.setName("root")}async loadGltf(e){const n=await load(e),r=n.json;let s=[];{let T=[];for(let D of n.images)T.push(createTexture(D));let I=[];for(let D of r.samplers)I.push(createSampler(D));for(let D of r.textures)s.push(new Texture(T[D.source],I[D.sampler]))}let o=[];for(let T of r.materials)o.push(new Material(T,s));let c=[];for(let T of r.meshes)c.push(new Mesh(T,n,o));let d=new Node;d.setName("scene root"),d.setParent(this.root);let p=[];for(let T of r.nodes){let I=new Node;I.setName(T.name),I.setParent(d),T.mesh!=null&&(I.mesh=c[T.mesh]),T.matrix!=null?I.transform=new Float32Array(T.matrix):(T.translation!=null&&(I.transform=mat4.mul(I.transform,mat4.translation(T.translation))),T.rotation!=null&&(I.transform=mat4.mul(I.transform,mat4.fromQuat(T.rotation))),T.scale!=null&&(I.transform=mat4.mul(I.transform,mat4.scaling(T.scale)))),p.push(I)}for(let T in r.nodes){const I=r.nodes[T];if(I.children!=null)for(let D of I.children)p[D].setParent(p[T])}d.propagateTransformations()}iterate(e,n,r){let s=[this.root],o;for(;s.length>0;){let c=s.pop();if(c.mesh!=null){e(c);for(let d of c.mesh.primitives)d.material.id!=o&&(n(d.material),o=d.material.id),r(d)}for(let d of c.children)s.push(d)}}}function hueToRgb(t){let e=(n,r=(n+t*6)%6)=>1-Math.max(Math.min(r,4-r,1),0);return vec3.lerp(vec3.create(1,1,1),vec3.create(e(5),e(3),e(1)),.8)}class Lights{camera;numLights=500;static maxNumLights=5e3;static numFloatsPerLight=8;static lightIntensity=.1;lightsArray=new Float32Array(Lights.maxNumLights*Lights.numFloatsPerLight);lightSetStorageBuffer;timeUniformBuffer;moveLightsComputeBindGroupLayout;moveLightsComputeBindGroup;moveLightsComputePipeline;clusterBuffer;clusteringComputeBindGroupLayout;clusteringComputeBindGroup;clusteringComputePipeline;constructor(e){this.camera=e,this.lightSetStorageBuffer=device.createBuffer({label:"lights",size:16+this.lightsArray.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.populateLightsBuffer(),this.updateLightSetUniformNumLights(),this.timeUniformBuffer=device.createBuffer({label:"time uniform",size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.moveLightsComputeBindGroupLayout=device.createBindGroupLayout({label:"move lights compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.moveLightsComputeBindGroup=device.createBindGroup({label:"move lights compute bind group",layout:this.moveLightsComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.lightSetStorageBuffer}},{binding:1,resource:{buffer:this.timeUniformBuffer}}]}),this.moveLightsComputePipeline=device.createComputePipeline({label:"move lights compute pipeline",layout:device.createPipelineLayout({label:"move lights compute pipeline layout",bindGroupLayouts:[this.moveLightsComputeBindGroupLayout]}),compute:{module:device.createShaderModule({label:"move lights compute shader",code:moveLightsComputeSrc}),entryPoint:"main"}});const n=constants.clusterWidth*constants.clusterHeight*constants.clusterDepth,r=36+4*constants.maxLightsPerCluster;this.clusterBuffer=device.createBuffer({label:"cluster buffer",size:n*r,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.clusteringComputeBindGroupLayout=device.createBindGroupLayout({label:"clustering compute bind group layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),this.clusteringComputeBindGroup=device.createBindGroup({label:"clustering compute bind group",layout:this.clusteringComputeBindGroupLayout,entries:[{binding:0,resource:{buffer:this.camera.uniformsBuffer}},{binding:1,resource:{buffer:this.lightSetStorageBuffer}},{binding:2,resource:{buffer:this.clusterBuffer}}]}),this.clusteringComputePipeline=device.createComputePipeline({label:"clustering compute pipeline",layout:device.createPipelineLayout({label:"clustering compute pipeline layout",bindGroupLayouts:[this.clusteringComputeBindGroupLayout]}),compute:{module:device.createShaderModule({label:"clustering compute shader",code:clusteringComputeSrc}),entryPoint:"main"}})}populateLightsBuffer(){for(let e=0;e<Lights.maxNumLights;++e){const n=vec3.scale(hueToRgb(Math.random()),Lights.lightIntensity);this.lightsArray.set(n,e*Lights.numFloatsPerLight+4)}device.queue.writeBuffer(this.lightSetStorageBuffer,16,this.lightsArray)}updateLightSetUniformNumLights(){device.queue.writeBuffer(this.lightSetStorageBuffer,0,new Uint32Array([this.numLights]))}doLightClustering(e){const n=e.beginComputePass();n.setPipeline(this.clusteringComputePipeline),n.setBindGroup(0,this.clusteringComputeBindGroup);const r=Math.ceil(constants.clusterWidth/constants.clusteringWorkgroupSize),s=Math.ceil(constants.clusterHeight/constants.clusteringWorkgroupSize),o=Math.ceil(constants.clusterDepth/constants.clusteringWorkgroupSize);n.dispatchWorkgroups(r,s,o),n.end()}onFrame(e){device.queue.writeBuffer(this.timeUniformBuffer,0,new Float32Array([e]));const n=device.createCommandEncoder(),r=n.beginComputePass();r.setPipeline(this.moveLightsComputePipeline),r.setBindGroup(0,this.moveLightsComputeBindGroup);const s=Math.ceil(this.numLights/constants.moveLightsWorkgroupSize);r.dispatchWorkgroups(s),r.end(),device.queue.submit([n.finish()])}}function toRadians(t){return t*Math.PI/180}class CameraUniforms{buffer=new ArrayBuffer(288);floatView=new Float32Array(this.buffer);set viewProjMat(e){this.floatView.set(e.subarray(0,16),0)}set invViewProjMat(e){this.floatView.set(e.subarray(0,16),16)}set viewMat(e){this.floatView.set(e.subarray(0,16),32)}set invProjMat(e){this.floatView.set(e.subarray(0,16),48)}set cameraPos(e){this.floatView[64]=e[0],this.floatView[65]=e[1],this.floatView[66]=e[2]}set nearPlane(e){this.floatView[67]=e}set farPlane(e){this.floatView[68]=e}set screenWidth(e){this.floatView[69]=e}set screenHeight(e){this.floatView[70]=e}}class Camera{uniforms=new CameraUniforms;uniformsBuffer;projMat=mat4.create();cameraPos=vec3.create(-7,2,0);cameraFront=vec3.create(0,0,-1);cameraUp=vec3.create(0,1,0);cameraRight=vec3.create(1,0,0);yaw=0;pitch=0;moveSpeed=.004;sensitivity=.15;static nearPlane=.1;static farPlane=1e3;keys={};constructor(){this.uniformsBuffer=device.createBuffer({size:this.uniforms.buffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,mappedAtCreation:!1,label:"Camera Uniforms Buffer"}),this.projMat=mat4.perspective(toRadians(fovYDegrees),aspectRatio,Camera.nearPlane,Camera.farPlane),this.rotateCamera(0,0),window.addEventListener("keydown",e=>this.onKeyEvent(e,!0)),window.addEventListener("keyup",e=>this.onKeyEvent(e,!1)),window.onblur=()=>this.keys={},canvas.addEventListener("mousedown",()=>canvas.requestPointerLock()),canvas.addEventListener("mouseup",()=>document.exitPointerLock()),canvas.addEventListener("mousemove",e=>this.onMouseMove(e))}onKeyEvent(e,n){this.keys[e.key.toLowerCase()]=n,this.keys.alt&&e.preventDefault()}rotateCamera(e,n){this.yaw+=e,this.pitch-=n,this.pitch>89&&(this.pitch=89),this.pitch<-89&&(this.pitch=-89);const r=mat4.create();r[0]=Math.cos(toRadians(this.yaw))*Math.cos(toRadians(this.pitch)),r[1]=Math.sin(toRadians(this.pitch)),r[2]=Math.sin(toRadians(this.yaw))*Math.cos(toRadians(this.pitch)),this.cameraFront=vec3.normalize(r),this.cameraRight=vec3.normalize(vec3.cross(this.cameraFront,[0,1,0])),this.cameraUp=vec3.normalize(vec3.cross(this.cameraRight,this.cameraFront))}onMouseMove(e){document.pointerLockElement===canvas&&this.rotateCamera(e.movementX*this.sensitivity,e.movementY*this.sensitivity)}processInput(e){let n=vec3.create(0,0,0);this.keys.w&&(n=vec3.add(n,this.cameraFront)),this.keys.s&&(n=vec3.sub(n,this.cameraFront)),this.keys.a&&(n=vec3.sub(n,this.cameraRight)),this.keys.d&&(n=vec3.add(n,this.cameraRight)),this.keys.q&&(n=vec3.sub(n,this.cameraUp)),this.keys.e&&(n=vec3.add(n,this.cameraUp));let r=this.moveSpeed*e;const s=3;if(this.keys.shift&&(r*=s),this.keys.alt&&(r/=s),vec3.length(n)>0){const o=vec3.scale(vec3.normalize(n),r);this.cameraPos=vec3.add(this.cameraPos,o)}}onFrame(e){this.processInput(e);const n=vec3.add(this.cameraPos,vec3.scale(this.cameraFront,1)),r=mat4.lookAt(this.cameraPos,n,[0,1,0]),s=mat4.mul(this.projMat,r);this.uniforms.viewProjMat=s;const o=mat4.invert(s),c=mat4.invert(this.projMat);this.uniforms.invViewProjMat=o,this.uniforms.viewMat=r,this.uniforms.invProjMat=c,this.uniforms.cameraPos=this.cameraPos,this.uniforms.nearPlane=Camera.nearPlane,this.uniforms.farPlane=Camera.farPlane,this.uniforms.screenWidth=canvas.width,this.uniforms.screenHeight=canvas.height,device.queue.writeBuffer(this.uniformsBuffer,0,this.uniforms.buffer)}}class Stage{scene;lights;camera;stats;constructor(e,n,r,s){this.scene=e,this.lights=n,this.camera=r,this.stats=s}}await initWebGPU();setupLoaders();let scene=new Scene;await scene.loadGltf("./scenes/sponza/Sponza.gltf");const camera=new Camera,lights=new Lights(camera),stats=new Stats;stats.showPanel(0);document.body.appendChild(stats.dom);const gui=new GUI$1;gui.add(lights,"numLights").min(1).max(Lights.maxNumLights).step(1).onChange(()=>{lights.updateLightSetUniformNumLights()});const stage=new Stage(scene,lights,camera,stats);var renderer;function setRenderer(t){switch(renderer?.stop(),t){case renderModes.naive:renderer=new NaiveRenderer(stage);break;case renderModes.forwardPlus:renderer=new ForwardPlusRenderer(stage);break;case renderModes.clusteredDeferred:renderer=new ClusteredDeferredRenderer(stage);break}}const renderModes={naive:"naive",forwardPlus:"forward+",clusteredDeferred:"clustered deferred"};let renderModeController=gui.add({mode:renderModes.naive},"mode",renderModes);renderModeController.onChange(setRenderer);setRenderer(renderModeController.getValue());
